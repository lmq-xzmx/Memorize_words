# ä¼˜åŒ–åçš„ç³»ç»Ÿæ¶æ„æ¸…å•

## 1. æ¨¡å‹åˆ—è¡¨ (Models)

### 1.1 ç”¨æˆ·ç®¡ç†æ¨¡å‹

#### CustomUser (è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `username`: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
  - `real_name`: çœŸå®å§“å
  - `email`: é‚®ç®±åœ°å€
  - `phone`: æ‰‹æœºå·ç 
  - `role`: ç”¨æˆ·è§’è‰²ï¼ˆæšä¸¾ï¼‰
  - `grade`: å¹´çº§
  - `english_level`: è‹±è¯­æ°´å¹³
  - `is_active`: æ˜¯å¦æ¿€æ´»
  - `date_joined`: æ³¨å†Œæ—¶é—´
  - `last_login`: æœ€åç™»å½•æ—¶é—´
- **å…³ç³»**:
  - ä¸€å¯¹ä¸€å…³ç³»ï¼š`LearningProfile`
  - ä¸€å¯¹å¤šå…³ç³»ï¼š`UserExtensionData`, `UserLoginLog`

#### UserRole (ç”¨æˆ·è§’è‰²æšä¸¾)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **è§’è‰²ç±»å‹**:
  - `STUDENT`: å­¦ç”Ÿ
  - `TEACHER`: æ•™å¸ˆ
  - `ADMIN`: ç®¡ç†å‘˜
  - `PARENT`: å®¶é•¿

#### LearningProfile (å­¦ä¹ æ¡£æ¡ˆ)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `user`: å…³è”ç”¨æˆ·ï¼ˆä¸€å¯¹ä¸€ï¼‰
  - `learning_goals`: å­¦ä¹ ç›®æ ‡
  - `interests`: å…´è¶£çˆ±å¥½
  - `learning_style`: å­¦ä¹ é£æ ¼
  - `progress_data`: è¿›åº¦æ•°æ®ï¼ˆJSONï¼‰
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `updated_at`: æ›´æ–°æ—¶é—´

#### UserLoginLog (ç”¨æˆ·ç™»å½•æ—¥å¿—)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `user`: å…³è”ç”¨æˆ·
  - `login_time`: ç™»å½•æ—¶é—´
  - `ip_address`: IPåœ°å€
  - `user_agent`: ç”¨æˆ·ä»£ç†
  - `login_method`: ç™»å½•æ–¹å¼
  - `is_successful`: æ˜¯å¦æˆåŠŸ

### 1.2 è§’è‰²å¢é¡¹æ¨¡å‹

#### RoleExtension (è§’è‰²å¢é¡¹é…ç½®)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `role`: è§’è‰²ç±»å‹
  - `name`: å¢é¡¹åç§°
  - `description`: æè¿°
  - `fields`: å­—æ®µé…ç½®ï¼ˆJSONï¼‰
  - `required_fields`: å¿…å¡«å­—æ®µåˆ—è¡¨
  - `field_order`: å­—æ®µæ’åº
  - `is_active`: æ˜¯å¦æ¿€æ´»
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `updated_at`: æ›´æ–°æ—¶é—´

#### UserExtensionData (ç”¨æˆ·å¢é¡¹æ•°æ®)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `user`: å…³è”ç”¨æˆ·
  - `role_extension`: å…³è”è§’è‰²å¢é¡¹
  - `data`: å¢é¡¹æ•°æ®ï¼ˆJSONï¼‰
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `updated_at`: æ›´æ–°æ—¶é—´

#### RoleTemplate (è§’è‰²æ¨¡æ¿)
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `name`: æ¨¡æ¿åç§°
  - `role`: ç›®æ ‡è§’è‰²
  - `template_data`: æ¨¡æ¿æ•°æ®ï¼ˆJSONï¼‰
  - `description`: æè¿°
  - `is_active`: æ˜¯å¦æ¿€æ´»
  - `created_by`: åˆ›å»ºè€…
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `updated_at`: æ›´æ–°æ—¶é—´

### 1.3 æƒé™ç®¡ç†æ¨¡å‹

#### MenuModuleConfig (èœå•æ¨¡å—é…ç½®)
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `name`: èœå•åç§°
  - `key`: èœå•é”®å€¼
  - `url`: èœå•URL
  - `icon`: å›¾æ ‡
  - `sort_order`: æ’åº
  - `parent`: çˆ¶èœå•
  - `allowed_roles`: å…è®¸çš„è§’è‰²åˆ—è¡¨
  - `is_active`: æ˜¯å¦æ¿€æ´»

#### RoleMenuPermission (è§’è‰²èœå•æƒé™)
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `role`: è§’è‰²
  - `menu_module`: èœå•æ¨¡å—
  - `can_access`: æ˜¯å¦å¯è®¿é—®
  - `can_create`: æ˜¯å¦å¯åˆ›å»º
  - `can_edit`: æ˜¯å¦å¯ç¼–è¾‘
  - `can_delete`: æ˜¯å¦å¯åˆ é™¤
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `updated_at`: æ›´æ–°æ—¶é—´

#### RoleGroupMapping (è§’è‰²ç»„æ˜ å°„)
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `role`: è§’è‰²
  - `group`: Djangoç»„
  - `is_active`: æ˜¯å¦æ¿€æ´»
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `sync_time`: åŒæ­¥æ—¶é—´

#### PermissionSyncLog (æƒé™åŒæ­¥æ—¥å¿—)
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `sync_type`: åŒæ­¥ç±»å‹
  - `target_type`: ç›®æ ‡ç±»å‹
  - `target_id`: ç›®æ ‡ID
  - `operation`: æ“ä½œç±»å‹
  - `details`: è¯¦ç»†ä¿¡æ¯ï¼ˆJSONï¼‰
  - `is_successful`: æ˜¯å¦æˆåŠŸ
  - `error_message`: é”™è¯¯ä¿¡æ¯
  - `created_at`: åˆ›å»ºæ—¶é—´

#### RoleManagement (è§’è‰²ç®¡ç†)
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/models.py`
- **ä¸»è¦å­—æ®µ**:
  - `role`: è§’è‰²
  - `name`: è§’è‰²åç§°
  - `description`: æè¿°
  - `permissions`: æƒé™åˆ—è¡¨
  - `parent_roles`: çˆ¶è§’è‰²
  - `is_active`: æ˜¯å¦æ¿€æ´»
  - `created_at`: åˆ›å»ºæ—¶é—´
  - `updated_at`: æ›´æ–°æ—¶é—´

## 2. APIæ¥å£åˆ—è¡¨ (API Endpoints)

### 2.1 ç”¨æˆ·ç®¡ç†API

#### UserViewSet
- **åŸºç¡€è·¯å¾„**: `/api/users/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `GET /api/users/statistics/` - ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
  - `GET /api/users/students/` - å­¦ç”Ÿåˆ—è¡¨
  - `POST /api/users/change_password/` - ä¿®æ”¹å¯†ç 
  - `POST /api/users/reset_password/` - é‡ç½®å¯†ç 

#### LearningProfileViewSet
- **åŸºç¡€è·¯å¾„**: `/api/learning-profiles/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `GET /api/learning-profiles/my_profile/` - è·å–å½“å‰ç”¨æˆ·æ¡£æ¡ˆ
  - `POST /api/learning-profiles/update_progress/` - æ›´æ–°å­¦ä¹ è¿›åº¦

#### UserLoginLogViewSet
- **åŸºç¡€è·¯å¾„**: `/api/login-logs/`
- **æ”¯æŒæ–¹æ³•**: GET
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `GET /api/login-logs/my_logs/` - è·å–å½“å‰ç”¨æˆ·ç™»å½•æ—¥å¿—
  - `GET /api/login-logs/statistics/` - ç™»å½•ç»Ÿè®¡

### 2.2 è§’è‰²å¢é¡¹API

#### RoleExtensionViewSet
- **åŸºç¡€è·¯å¾„**: `/api/role-extensions/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `GET /api/role-extensions/by_role/{role}/` - æŒ‰è§’è‰²è·å–å¢é¡¹
  - `POST /api/role-extensions/validate_data/` - éªŒè¯å¢é¡¹æ•°æ®

#### UserExtensionDataViewSet (åŸEnhancedUserExtensionDataViewSet)
- **åŸºç¡€è·¯å¾„**: `/api/user-extensions/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `POST /api/user-extensions/batch_create/` - æ‰¹é‡åˆ›å»º
  - `POST /api/user-extensions/batch_update/` - æ‰¹é‡æ›´æ–°
  - `GET /api/user-extensions/template_usage/` - æ¨¡æ¿ä½¿ç”¨ç»Ÿè®¡

#### RoleTemplateViewSet
- **åŸºç¡€è·¯å¾„**: `/api/role-templates/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `POST /api/role-templates/{id}/clone/` - å…‹éš†æ¨¡æ¿
  - `POST /api/role-templates/{id}/apply_to_users/` - åº”ç”¨åˆ°ç”¨æˆ·
  - `GET /api/role-templates/usage_statistics/` - ä½¿ç”¨ç»Ÿè®¡

### 2.3 æ‰¹é‡æ“ä½œAPI

#### BulkOperationsViewSet (æ–°å¢)
- **åŸºç¡€è·¯å¾„**: `/api/bulk-operations/`
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `POST /api/bulk-operations/create_users/` - æ‰¹é‡åˆ›å»ºç”¨æˆ·
  - `POST /api/bulk-operations/assign_roles/` - æ‰¹é‡åˆ†é…è§’è‰²
  - `POST /api/bulk-operations/update_extensions/` - æ‰¹é‡æ›´æ–°å¢é¡¹
  - `POST /api/bulk-operations/apply_templates/` - æ‰¹é‡åº”ç”¨æ¨¡æ¿
  - `GET /api/bulk-operations/system_statistics/` - ç³»ç»Ÿç»Ÿè®¡

### 2.4 æƒé™ç®¡ç†API

#### MenuModuleConfigViewSet
- **åŸºç¡€è·¯å¾„**: `/api/menu-modules/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `GET /api/menu-modules/user_menus/` - ç”¨æˆ·å¯è®¿é—®èœå•
  - `POST /api/menu-modules/{id}/check_permission/` - æ£€æŸ¥æƒé™

#### RoleMenuPermissionViewSet
- **åŸºç¡€è·¯å¾„**: `/api/role-menu-permissions/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `POST /api/role-menu-permissions/batch_update/` - æ‰¹é‡æ›´æ–°æƒé™
  - `GET /api/role-menu-permissions/check_access/` - æ£€æŸ¥è®¿é—®æƒé™

#### GroupViewSet
- **åŸºç¡€è·¯å¾„**: `/api/groups/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE

#### PermissionViewSet
- **åŸºç¡€è·¯å¾„**: `/api/permissions/`
- **æ”¯æŒæ–¹æ³•**: GET

#### RoleGroupMappingViewSet
- **åŸºç¡€è·¯å¾„**: `/api/role-group-mappings/`
- **æ”¯æŒæ–¹æ³•**: GET, POST, PUT, PATCH, DELETE
- **ç‰¹æ®Šç«¯ç‚¹**:
  - `POST /api/role-group-mappings/sync_users/` - åŒæ­¥ç”¨æˆ·ç»„

#### PermissionSyncLogViewSet
- **åŸºç¡€è·¯å¾„**: `/api/permission-sync-logs/`
- **æ”¯æŒæ–¹æ³•**: GET

### 2.5 è®¤è¯API

#### ç™»å½•è®¤è¯
- `POST /api/auth/login/` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/logout/` - ç”¨æˆ·ç™»å‡º
- `POST /api/auth/refresh/` - åˆ·æ–°Token
- `GET /api/auth/user/` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

## 3. è§†å›¾åˆ—è¡¨ (Views)

### 3.1 Webè§†å›¾ (ä¼ ç»ŸDjangoè§†å›¾)

#### ç”¨æˆ·è®¤è¯è§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/views.py`
- **è§†å›¾åˆ—è¡¨**:
  - `LoginView` - ç™»å½•é¡µé¢
  - `LogoutView` - ç™»å‡ºå¤„ç†
  - `RegisterView` - æ³¨å†Œé¡µé¢
  - `PasswordChangeView` - å¯†ç ä¿®æ”¹
  - `PasswordResetView` - å¯†ç é‡ç½®

#### ç”¨æˆ·ç®¡ç†è§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/views.py`
- **è§†å›¾åˆ—è¡¨**:
  - `UserProfileView` - ç”¨æˆ·èµ„æ–™é¡µé¢
  - `UserListView` - ç”¨æˆ·åˆ—è¡¨é¡µé¢
  - `UserDetailView` - ç”¨æˆ·è¯¦æƒ…é¡µé¢
  - `UserEditView` - ç”¨æˆ·ç¼–è¾‘é¡µé¢

#### è§’è‰²ç®¡ç†è§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/views.py`
- **è§†å›¾åˆ—è¡¨**:
  - `RoleManagementView` - è§’è‰²ç®¡ç†é¡µé¢
  - `RoleExtensionView` - è§’è‰²å¢é¡¹ç®¡ç†
  - `RoleTemplateView` - è§’è‰²æ¨¡æ¿ç®¡ç†

#### è§’è‰²å±‚çº§ç®¡ç†è§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/views_role_hierarchy.py`
- **è§†å›¾åˆ—è¡¨**:
  - `RoleLevelListView` - è§’è‰²çº§åˆ«åˆ—è¡¨
  - `RoleUserListView` - è§’è‰²ç”¨æˆ·åˆ—è¡¨
  - `UserExtensionDetailView` - ç”¨æˆ·å¢é¡¹è¯¦æƒ…
  - `UpdateUserExtensionView` - æ›´æ–°ç”¨æˆ·å¢é¡¹
  - `SyncRoleDataView` - åŒæ­¥è§’è‰²æ•°æ®

### 3.2 APIè§†å›¾ (DRF ViewSets)

#### ç”¨æˆ·ç®¡ç†APIè§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/api_views.py`
- **ViewSetåˆ—è¡¨**:
  - `UserViewSet` - ç”¨æˆ·CRUDæ“ä½œ
  - `LearningProfileViewSet` - å­¦ä¹ æ¡£æ¡ˆç®¡ç†
  - `UserLoginLogViewSet` - ç™»å½•æ—¥å¿—æŸ¥çœ‹
  - `StudentListViewSet` - å­¦ç”Ÿåˆ—è¡¨ï¼ˆå·²æ•´åˆåˆ°UserViewSetï¼‰

#### è§’è‰²å¢é¡¹APIè§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/template_api_views.py`
- **ViewSetåˆ—è¡¨**:
  - `RoleExtensionViewSet` - è§’è‰²å¢é¡¹é…ç½®
  - `EnhancedUserExtensionDataViewSet` - å¢å¼ºç”¨æˆ·å¢é¡¹æ•°æ®
  - `RoleTemplateViewSet` - è§’è‰²æ¨¡æ¿ç®¡ç†

#### æ‰¹é‡æ“ä½œAPIè§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/bulk_api_views.py`
- **ViewSetåˆ—è¡¨**:
  - `BulkOperationsViewSet` - ç»Ÿä¸€æ‰¹é‡æ“ä½œæ¥å£

#### æƒé™ç®¡ç†APIè§†å›¾
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/api_views.py`
- **ViewSetåˆ—è¡¨**:
  - `MenuModuleConfigViewSet` - èœå•æ¨¡å—é…ç½®
  - `RoleMenuPermissionViewSet` - è§’è‰²èœå•æƒé™
  - `GroupViewSet` - Djangoç»„ç®¡ç†
  - `PermissionViewSet` - æƒé™æŸ¥çœ‹
  - `RoleGroupMappingViewSet` - è§’è‰²ç»„æ˜ å°„
  - `PermissionSyncLogViewSet` - æƒé™åŒæ­¥æ—¥å¿—

### 3.3 AJAXè§†å›¾

#### ç”¨æˆ·ç›¸å…³AJAX
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/ajax_views.py`
- **è§†å›¾åˆ—è¡¨**:
  - `get_user_info` - è·å–ç”¨æˆ·ä¿¡æ¯
  - `update_user_status` - æ›´æ–°ç”¨æˆ·çŠ¶æ€
  - `search_users` - æœç´¢ç”¨æˆ·
  - `get_role_extensions` - è·å–è§’è‰²å¢é¡¹

## 4. æ–°å¢ä¼˜åŒ–ç»„ä»¶

### 4.1 æ•°æ®éªŒè¯å™¨
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/validators.py`
- **ç»„ä»¶åˆ—è¡¨**:
  - `EnhancedUserValidator` - å¢å¼ºç”¨æˆ·æ•°æ®éªŒè¯
  - `RoleExtensionValidator` - è§’è‰²å¢é¡¹æ•°æ®éªŒè¯
  - `BulkOperationValidator` - æ‰¹é‡æ“ä½œæ•°æ®éªŒè¯

### 4.2 æ€§èƒ½ä¼˜åŒ–å™¨
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/performance.py`
- **ç»„ä»¶åˆ—è¡¨**:
  - `UserQueryOptimizer` - ç”¨æˆ·æŸ¥è¯¢ä¼˜åŒ–
  - `RoleExtensionCacheManager` - è§’è‰²å¢é¡¹ç¼“å­˜ç®¡ç†
  - `QueryCacheManager` - æŸ¥è¯¢ç¼“å­˜ç®¡ç†
  - `BulkOperationOptimizer` - æ‰¹é‡æ“ä½œä¼˜åŒ–

### 4.3 æƒé™ä¸­é—´ä»¶
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/middleware.py`
- **ä¸­é—´ä»¶åˆ—è¡¨**:
  - `EnhancedRBACMiddleware` - å¢å¼ºRBACä¸­é—´ä»¶
  - `ObjectPermissionMiddleware` - å¯¹è±¡çº§æƒé™ä¸­é—´ä»¶
  - `RoleBasedPermissionMiddleware` - åŸºäºè§’è‰²çš„æƒé™ä¸­é—´ä»¶
  - `APIAccessLogMiddleware` - APIè®¿é—®æ—¥å¿—ä¸­é—´ä»¶

## 5. åºåˆ—åŒ–å™¨åˆ—è¡¨ (Serializers)

### 5.1 ç”¨æˆ·ç®¡ç†åºåˆ—åŒ–å™¨
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/serializers.py`
- **åºåˆ—åŒ–å™¨åˆ—è¡¨**:
  - `UserSerializer` - ç”¨æˆ·åŸºç¡€åºåˆ—åŒ–
  - `UserDetailSerializer` - ç”¨æˆ·è¯¦ç»†ä¿¡æ¯åºåˆ—åŒ–
  - `LearningProfileSerializer` - å­¦ä¹ æ¡£æ¡ˆåºåˆ—åŒ–
  - `UserLoginLogSerializer` - ç™»å½•æ—¥å¿—åºåˆ—åŒ–
  - `UserCreateSerializer` - ç”¨æˆ·åˆ›å»ºåºåˆ—åŒ–
  - `PasswordChangeSerializer` - å¯†ç ä¿®æ”¹åºåˆ—åŒ–

### 5.2 è§’è‰²å¢é¡¹åºåˆ—åŒ–å™¨
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/template_api_views.py`
- **åºåˆ—åŒ–å™¨åˆ—è¡¨**:
  - `RoleExtensionSerializer` - è§’è‰²å¢é¡¹åºåˆ—åŒ–
  - `UserExtensionDataSerializer` - ç”¨æˆ·å¢é¡¹æ•°æ®åºåˆ—åŒ–
  - `RoleTemplateSerializer` - è§’è‰²æ¨¡æ¿åºåˆ—åŒ–
  - `RoleTemplateDetailSerializer` - è§’è‰²æ¨¡æ¿è¯¦ç»†åºåˆ—åŒ–
  - `BatchUserExtensionSerializer` - æ‰¹é‡ç”¨æˆ·å¢é¡¹åºåˆ—åŒ–

### 5.3 æƒé™ç®¡ç†åºåˆ—åŒ–å™¨
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/serializers.py`
- **åºåˆ—åŒ–å™¨åˆ—è¡¨**:
  - `MenuModuleConfigSerializer` - èœå•æ¨¡å—é…ç½®åºåˆ—åŒ–
  - `RoleMenuPermissionSerializer` - è§’è‰²èœå•æƒé™åºåˆ—åŒ–
  - `GroupSerializer` - Djangoç»„åºåˆ—åŒ–
  - `PermissionSerializer` - æƒé™åºåˆ—åŒ–
  - `RoleGroupMappingSerializer` - è§’è‰²ç»„æ˜ å°„åºåˆ—åŒ–
  - `PermissionSyncLogSerializer` - æƒé™åŒæ­¥æ—¥å¿—åºåˆ—åŒ–

## 6. URLé…ç½®

### 6.1 ä¸»è¦URLé…ç½®
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/urls.py`
- **åŒ…å«å†…å®¹**:
  - APIè·¯ç”±é…ç½®
  - Webè§†å›¾è·¯ç”±
  - AJAXæ¥å£è·¯ç”±

### 6.2 è§’è‰²å±‚çº§URLé…ç½®
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/urls_role_hierarchy.py`
- **åŒ…å«å†…å®¹**:
  - è§’è‰²å±‚çº§ç®¡ç†è·¯ç”±
  - è§’è‰²ç”¨æˆ·ç®¡ç†è·¯ç”±

### 6.3 æƒé™ç®¡ç†URLé…ç½®
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/urls.py`
- **åŒ…å«å†…å®¹**:
  - æƒé™ç®¡ç†APIè·¯ç”±
  - æƒé™ç®¡ç†Webè§†å›¾è·¯ç”±

## 7. ç®¡ç†åå°é…ç½®

### 7.1 ç”¨æˆ·ç®¡ç†åå°
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/admin.py`
- **ç®¡ç†ç±»åˆ—è¡¨**:
  - `CustomUserAdmin` - ç”¨æˆ·ç®¡ç†
  - `LearningProfileAdmin` - å­¦ä¹ æ¡£æ¡ˆç®¡ç†
  - `RoleExtensionAdmin` - è§’è‰²å¢é¡¹ç®¡ç†
  - `UserExtensionDataAdmin` - ç”¨æˆ·å¢é¡¹æ•°æ®ç®¡ç†
  - `RoleTemplateAdmin` - è§’è‰²æ¨¡æ¿ç®¡ç†

### 7.2 æƒé™ç®¡ç†åå°
- **æ–‡ä»¶ä½ç½®**: `apps/permissions/admin.py`
- **ç®¡ç†ç±»åˆ—è¡¨**:
  - `MenuModuleConfigAdmin` - èœå•æ¨¡å—é…ç½®ç®¡ç†
  - `RoleMenuPermissionAdmin` - è§’è‰²èœå•æƒé™ç®¡ç†
  - `RoleGroupMappingAdmin` - è§’è‰²ç»„æ˜ å°„ç®¡ç†
  - `PermissionSyncLogAdmin` - æƒé™åŒæ­¥æ—¥å¿—ç®¡ç†

### 7.3 é›†æˆæƒé™ç®¡ç†åå°
- **æ–‡ä»¶ä½ç½®**: `apps/accounts/admin_integrated_permissions.py`
- **ç®¡ç†ç±»åˆ—è¡¨**:
  - `IntegratedUserAdmin` - é›†æˆç”¨æˆ·æƒé™ç®¡ç†
  - `IntegratedRoleAdmin` - é›†æˆè§’è‰²æƒé™ç®¡ç†

## 8. ç³»ç»Ÿæ¶æ„ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

### 8.1 ä¼˜åŒ–å®æ–½æ¦‚è¿°

æ ¹æ®ç³»ç»Ÿç›®æ ‡"é€šç”¨ç”¨æˆ·ä¿¡æ¯ç»Ÿä¸€ç®¡ç†å’Œè§’è‰²å…³è”å¢é¡¹é…ç½®ç®¡ç†"ï¼Œå·²å®Œæˆä»¥ä¸‹æ ¸å¿ƒä¼˜åŒ–ï¼š

### 8.2 ç»Ÿä¸€è§’è‰²ç®¡ç†ç³»ç»Ÿ âœ…

**å®æ–½å†…å®¹ï¼š**
- æ‰©å±• `UserRole` ç±»ä¸ºç»Ÿä¸€è§’è‰²ç®¡ç†ä¸­å¿ƒ
- æ–°å¢è§’è‰²å±‚çº§å…³ç³»ç®¡ç†æ–¹æ³•
- å®ç°è§’è‰²æƒé™å’Œç®¡ç†æƒé™æ£€æŸ¥
- åˆ›å»º `apps/accounts/unified_role_api.py` ç»Ÿä¸€è§’è‰²ç®¡ç†API

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- è§’è‰²åˆ—è¡¨å’Œå±‚çº§å…³ç³»æŸ¥è¯¢
- è§’è‰²å¢é¡¹é…ç½®ç®¡ç†
- ç”¨æˆ·æŒ‰è§’è‰²æŸ¥è¯¢å’Œç»Ÿè®¡
- æ‰¹é‡è§’è‰²åˆ†é…å’Œç”¨æˆ·å¢é¡¹æ•°æ®æ›´æ–°
- ç³»ç»Ÿç»Ÿè®¡å’Œè§’è‰²ä½¿ç”¨æƒ…å†µåˆ†æ

### 8.3 å¢å¼ºç”¨æˆ·ç®¡ç†ç³»ç»Ÿ âœ…

**å®æ–½å†…å®¹ï¼š**
- åˆ›å»º `apps/accounts/enhanced_user_api.py` å¢å¼ºç”¨æˆ·ç®¡ç†API
- å®ç°é€šç”¨ç”¨æˆ·ä¿¡æ¯ç»Ÿä¸€ç®¡ç†
- æ”¯æŒæ‰¹é‡ç”¨æˆ·æ“ä½œå’Œæ•°æ®ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æ‰¹é‡ç”¨æˆ·å¯¼å…¥å¯¼å‡ºï¼ˆCSV/JSONæ ¼å¼ï¼‰
- ç”¨æˆ·è§’è‰²è½¬æ¢å’Œæ•°æ®è¿ç§»
- ç”¨æˆ·è´¦å·åˆå¹¶åŠŸèƒ½
- é«˜çº§ç”¨æˆ·ç»Ÿè®¡å’Œåˆ†æ
- æƒé™çº§è”æ£€æŸ¥å’Œæ•°æ®å®Œæ•´æ€§ä¿éšœ

### 8.4 ç³»ç»Ÿé…ç½®ç®¡ç†ä¸­å¿ƒ âœ…

**å®æ–½å†…å®¹ï¼š**
- åˆ›å»º `apps/accounts/system_config_api.py` ç³»ç»Ÿé…ç½®ç®¡ç†API
- å®ç°ç³»ç»Ÿçº§é…ç½®ç»Ÿä¸€ç®¡ç†
- å»ºç«‹è§’è‰²å¢é¡¹é…ç½®åŒæ­¥æœºåˆ¶

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- ç³»ç»Ÿæ¦‚è§ˆå’Œå¥åº·æ£€æŸ¥
- è§’è‰²æ¨¡æ¿ç®¡ç†
- è§’è‰²å¢é¡¹é…ç½®çš„åˆ›å»ºã€æ›´æ–°å’ŒåŒæ­¥
- æ•°æ®å®Œæ•´æ€§æ£€æŸ¥å’Œä¿®å¤å»ºè®®
- ç³»ç»Ÿæ€§èƒ½ç›‘æ§

### 8.5 æ¶æ„ä¼˜åŒ–ç‰¹æ€§

**ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ï¼š**
- âœ… æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯é€šè¿‡ `CustomUser` æ¨¡å‹ç»Ÿä¸€ç®¡ç†
- âœ… æ”¯æŒå¤šè§’è‰²ç”¨æˆ·å’Œè§’è‰²è½¬æ¢
- âœ… å®ç°ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸå®Œæ•´ç®¡ç†

**è§’è‰²å…³è”å¢é¡¹ï¼š**
- âœ… é€šè¿‡ `RoleExtension` å®ç°è§’è‰²å¢é¡¹é…ç½®
- âœ… ç”¨æˆ·å¢é¡¹æ•°æ®è‡ªåŠ¨å…³è”è§’è‰²é…ç½®
- âœ… æ”¯æŒå¢é¡¹é…ç½®çš„æ‰¹é‡åŒæ­¥å’Œæ›´æ–°

**æ¨¡å—åŒ–è®¾è®¡ï¼š**
- âœ… æ¸…æ™°çš„APIæ¨¡å—åˆ’åˆ†
- âœ… ç»Ÿä¸€çš„æƒé™æ£€æŸ¥æœºåˆ¶
- âœ… å¯æ‰©å±•çš„é…ç½®ç®¡ç†æ¶æ„

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- âœ… æ‰¹é‡æ“ä½œAPIå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- âœ… ç¼“å­˜æœºåˆ¶æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦
- âœ… æ•°æ®åº“äº‹åŠ¡ä¿è¯æ“ä½œåŸå­æ€§

**æƒé™æ§åˆ¶ï¼š**
- âœ… åŸºäºè§’è‰²çš„æƒé™çº§è”æ£€æŸ¥
- âœ… ç»†ç²’åº¦çš„æ“ä½œæƒé™æ§åˆ¶
- âœ… å®‰å…¨çš„æ•°æ®è®¿é—®å’Œä¿®æ”¹æœºåˆ¶

### 8.6 æ–°å¢APIæ¥å£æ¸…å•

**ç»Ÿä¸€è§’è‰²ç®¡ç†API (`unified_role_api.py`)ï¼š**
- `GET /api/roles/list/` - è§’è‰²åˆ—è¡¨æŸ¥è¯¢
- `GET /api/roles/hierarchy/` - è§’è‰²å±‚çº§å…³ç³»
- `GET /api/roles/extensions/` - è§’è‰²å¢é¡¹é…ç½®
- `GET /api/roles/{role}/users/` - æŒ‰è§’è‰²æŸ¥è¯¢ç”¨æˆ·
- `POST /api/roles/batch-assign/` - æ‰¹é‡åˆ†é…è§’è‰²
- `POST /api/roles/batch-update-extensions/` - æ‰¹é‡æ›´æ–°ç”¨æˆ·å¢é¡¹
- `GET /api/roles/statistics/` - ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯

**å¢å¼ºç”¨æˆ·ç®¡ç†API (`enhanced_user_api.py`)ï¼š**
- `POST /api/users/batch-import/` - æ‰¹é‡å¯¼å…¥ç”¨æˆ·
- `GET /api/users/export/` - å¯¼å‡ºç”¨æˆ·æ•°æ®
- `POST /api/users/role-transfer/` - ç”¨æˆ·è§’è‰²è½¬æ¢
- `POST /api/users/merge-accounts/` - ç”¨æˆ·è´¦å·åˆå¹¶
- `GET /api/users/advanced-statistics/` - é«˜çº§ç”¨æˆ·ç»Ÿè®¡

**ç³»ç»Ÿé…ç½®ç®¡ç†API (`system_config_api.py`)ï¼š**
- `GET /api/system/overview/` - ç³»ç»Ÿæ¦‚è§ˆ
- `GET|POST /api/system/role-templates/` - è§’è‰²æ¨¡æ¿ç®¡ç†
- `GET|POST|PUT /api/system/role-extensions/` - è§’è‰²å¢é¡¹é…ç½®
- `POST /api/system/sync-role-extensions/` - åŒæ­¥è§’è‰²å¢é¡¹
- `GET /api/system/health/` - ç³»ç»Ÿå¥åº·æ£€æŸ¥

### 8.7 ä¼˜åŒ–æ•ˆæœè¯„ä¼°

**æ¶æ„åˆç†æ€§ï¼š** é€šè¿‡ç»Ÿä¸€çš„ç”¨æˆ·ç®¡ç†å’Œè§’è‰²å…³è”å¢é¡¹ç³»ç»Ÿï¼Œå®ç°äº†æ¸…æ™°çš„æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ã€‚

**åŠŸèƒ½å®Œæ•´æ€§ï¼š** è¦†ç›–äº†ç”¨æˆ·å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€è§’è‰²é…ç½®ç®¡ç†ã€ç³»ç»Ÿç›‘æ§ç­‰æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚ã€‚

**æ€§èƒ½æå‡ï¼š** æ‰¹é‡æ“ä½œã€ç¼“å­˜æœºåˆ¶å’Œä¼˜åŒ–çš„æ•°æ®åº“æŸ¥è¯¢æ˜¾è‘—æå‡äº†ç³»ç»Ÿæ€§èƒ½ã€‚

**å®‰å…¨æ€§å¢å¼ºï¼š** å¤šå±‚çº§æƒé™æ£€æŸ¥å’Œæ•°æ®å®Œæ•´æ€§éªŒè¯ä¿éšœäº†ç³»ç»Ÿå®‰å…¨æ€§ã€‚

**å¯ç»´æŠ¤æ€§ï¼š** æ¨¡å—åŒ–çš„APIè®¾è®¡å’Œæ¸…æ™°çš„ä»£ç ç»“æ„ä¾¿äºåç»­ç»´æŠ¤å’ŒåŠŸèƒ½æ‰©å±•ã€‚

## 9. ä¼˜åŒ–ç‰¹æ€§æ€»ç»“

### 9.1 æ¶æ„ä¼˜åŒ–
- âœ… ç»Ÿä¸€APIæ¥å£è®¾è®¡
- âœ… æ¶ˆé™¤å†—ä½™è·¯ç”±
- âœ… æ¨¡å—åŒ–ç»„ä»¶è®¾è®¡
- âœ… å¢å¼ºæ•°æ®éªŒè¯
- âœ… æ€§èƒ½ä¼˜åŒ–å®ç°
- ğŸ”„ è§’è‰²æ¨¡å‹è¿›ä¸€æ­¥ç»Ÿä¸€
- ğŸ†• è§’è‰²ç®¡ç†ä¸­å¿ƒå»ºç«‹

### 9.2 åŠŸèƒ½å¢å¼º
- âœ… æ‰¹é‡æ“ä½œç»Ÿä¸€åŒ–
- âœ… ç¼“å­˜æœºåˆ¶é›†æˆ
- âœ… æƒé™éªŒè¯ç»†åŒ–
- âœ… æ•°æ®éªŒè¯å¢å¼º
- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- ğŸ†• ç”¨æˆ·ç®¡ç†åŠŸèƒ½å¢å¼º
- ğŸ†• ç³»ç»Ÿé…ç½®ç®¡ç†

### 9.3 ä»£ç è´¨é‡
- âœ… éµå¾ªDRYåŸåˆ™
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… ä»£ç å¤ç”¨æ€§é«˜
- âœ… å¯ç»´æŠ¤æ€§å¼º
- ğŸ”„ è§’è‰²å®šä¹‰ç»Ÿä¸€æ€§
- ğŸ†• APIè®¾è®¡ä¸€è‡´æ€§

### 9.4 ç³»ç»Ÿæ€§èƒ½
- âœ… æŸ¥è¯¢ä¼˜åŒ–
- âœ… ç¼“å­˜ç­–ç•¥
- âœ… æ‰¹é‡æ“ä½œä¼˜åŒ–
- âœ… æ•°æ®åº“è®¿é—®ä¼˜åŒ–
- âœ… APIå“åº”é€Ÿåº¦æå‡
- ğŸ†• è§’è‰²æƒé™æŸ¥è¯¢ä¼˜åŒ–
- ğŸ†• ç”¨æˆ·æ•°æ®ç®¡ç†æ•ˆç‡æå‡
<template>
  <div class="learning-mode-selector">
    <div class="header">
      <h1>è‹±è¯­å­¦ä¹ ä¸­å¿ƒ</h1>
      <p class="subtitle">é€‰æ‹©æ‚¨çš„å­¦ä¹ æ¨¡å¼</p>
    </div>
    
    <!-- åˆ†ç±»æ ‡é¢˜ -->
    <div class="category-section">
      <h2 class="category-title">ğŸ“š å­¦ä¹ æ¨¡å—</h2>
      <div class="mode-grid">
        <!-- å•è¯é˜…è¯» -->
        <div v-if="canUseMode('word-reading')" class="mode-card" @click="navigateToMode('word-reading')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ“–</div>
            <div class="mode-title">å•è¯é˜…è¯»</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-reading"
                v-model="selectedHomepage"
                @change="setHomepage('word-reading')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>H5ç‰ˆå•è¯é˜…è¯»é¡µé¢ï¼Œæ”¯æŒéŸ³é¢‘æ’­æ”¾å’Œè¿›åº¦è·Ÿè¸ª</p>
            <div class="mode-features">
              <span class="feature-tag">éŸ³é¢‘æ’­æ”¾</span>
              <span class="feature-tag">è¿›åº¦è·Ÿè¸ª</span>
              <span class="feature-tag">å‘éŸ³ç»ƒä¹ </span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">å‘éŸ³ç»ƒä¹ </span>
            </div>
          </div>
        </div>

        <!-- å•è¯å­¦ä¹  -->
        <div v-if="canUseMode('word-learning')" class="mode-card" @click="navigateToMode('word-learning')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ“š</div>
            <div class="mode-title">å•è¯å­¦ä¹ </div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-learning"
                v-model="selectedHomepage"
                @change="setHomepage('word-learning')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>H5ç‰ˆå•è¯å­¦ä¹ é¡µé¢ï¼Œå±•ç¤ºå•è¯è¯¦æƒ…å’Œå¤šç§é‡Šä¹‰</p>
            <div class="mode-features">
              <span class="feature-tag">è¯¦ç»†é‡Šä¹‰</span>
              <span class="feature-tag">ä¾‹å¥å±•ç¤º</span>
              <span class="feature-tag">è¯æ±‡ç§¯ç´¯</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">ç³»ç»Ÿå­¦ä¹ </span>
            </div>
          </div>
        </div>

        <!-- å•è¯è¯¦æƒ… -->
        <div v-if="canUseMode('word-detail')" class="mode-card" @click="navigateToMode('word-detail')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ“</div>
            <div class="mode-title">å•è¯è¯¦æƒ…</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-detail"
                v-model="selectedHomepage"
                @change="setHomepage('word-detail')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å•è¯è¯¦æƒ…é¡µé¢ï¼ŒåŒ…å«éŸ³æ ‡ã€é‡Šä¹‰ã€ä¾‹å¥ã€è¯æ ¹è¯ç¼€ç­‰å®Œæ•´ä¿¡æ¯</p>
            <div class="mode-features">
              <span class="feature-tag">éŸ³æ ‡æ ‡æ³¨</span>
              <span class="feature-tag">è¯æ ¹åˆ†æ</span>
              <span class="feature-tag">ä¾‹å¥ä¸°å¯Œ</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">æ·±åº¦å­¦ä¹ </span>
            </div>
          </div>
        </div>

        <!-- è¯æ ¹åˆ†è§£ -->
        <div v-if="canUseMode('word-root-analysis')" class="mode-card" @click="navigateToMode('word-root-analysis')">
          <div class="mode-header">
            <div class="mode-icon">ğŸŒ±</div>
            <div class="mode-title">è¯æ ¹åˆ†è§£</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-root-analysis"
                v-model="selectedHomepage"
                @change="setHomepage('word-root-analysis')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>è¯æ ¹æ‹†è§£å±•ç¤ºé¡µé¢ï¼Œæ”¯æŒè¯æ ¹åˆ†æå’Œå­¦ä¹ è¿›åº¦ç®¡ç†</p>
            <div class="mode-features">
              <span class="feature-tag">è¯æ ¹æ‹†è§£</span>
              <span class="feature-tag">è¯ç¼€åˆ†æ</span>
              <span class="feature-tag">è®°å¿†æŠ€å·§</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">è¯æ±‡æ‰©å±•</span>
            </div>
          </div>
        </div>

        <!-- æ•…äº‹é˜…è¯» -->
        <div v-if="canUseMode('story-reading')" class="mode-card" @click="navigateToMode('story-reading')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ“š</div>
            <div class="mode-title">æ•…äº‹é˜…è¯»</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="story-reading"
                v-model="selectedHomepage"
                @change="setHomepage('story-reading')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>äº¤äº’å¼æ•…äº‹é˜…è¯»é¡µé¢ï¼Œæ”¯æŒè¯æ€§æ ‡æ³¨å’Œç”Ÿè¯æ”¶é›†åŠŸèƒ½</p>
            <div class="mode-features">
              <span class="feature-tag">è¯æ€§æ ‡æ³¨</span>
              <span class="feature-tag">ç”Ÿè¯æ”¶é›†</span>
              <span class="feature-tag">æƒ…å¢ƒå­¦ä¹ </span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">é˜…è¯»æå‡</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç»ƒä¹ æ¨¡å— -->
    <div class="category-section">
      <h2 class="category-title">âœï¸ ç»ƒä¹ æ¨¡å—</h2>
      <div class="mode-grid">

        <!-- æ‹¼å†™ç»ƒä¹  -->
        <div v-if="canUseMode('spelling')" class="mode-card" @click="navigateToMode('spelling')">
          <div class="mode-header">
            <div class="mode-icon">âœï¸</div>
            <div class="mode-title">æ‹¼å†™ç»ƒä¹ </div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="spelling"
                v-model="selectedHomepage"
                @change="setHomepage('spelling')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å¬éŸ³æ‹¼å†™ç»ƒä¹ é¡µé¢ï¼Œæå‡å•è¯è®°å¿†</p>
            <div class="mode-features">
              <span class="feature-tag">å¬éŸ³ç»ƒä¹ </span>
              <span class="feature-tag">æ‹–æ‹½æ‹¼å†™</span>
              <span class="feature-tag">è®°å¿†å¼ºåŒ–</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">æ‹¼å†™ç»ƒä¹ </span>
            </div>
          </div>
        </div>

        <!-- é—ªå¡å­¦ä¹  -->
        <div v-if="canUseMode('flashcard')" class="mode-card" @click="navigateToMode('flashcard')">
          <div class="mode-header">
            <div class="mode-icon">ğŸƒ</div>
            <div class="mode-title">é—ªå¡å­¦ä¹ </div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="flashcard"
                v-model="selectedHomepage"
                @change="setHomepage('flashcard')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>ç¿»è½¬å¡ç‰‡å­¦ä¹ å•è¯é¡µé¢</p>
            <div class="mode-features">
              <span class="feature-tag">å¡ç‰‡ç¿»è½¬</span>
              <span class="feature-tag">å¿«é€Ÿè®°å¿†</span>
              <span class="feature-tag">é‡å¤ç»ƒä¹ </span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">å¿«é€Ÿè®°å¿†</span>
            </div>
          </div>
        </div>

        <!-- æ¨¡å¼åŒ¹é…è®°å¿† -->
        <div v-if="canUseMode('pattern-memory')" class="mode-card" @click="navigateToMode('pattern-memory')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ§ </div>
            <div class="mode-title">æ¨¡å¼åŒ¹é…è®°å¿†</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="pattern-memory"
                v-model="selectedHomepage"
                @change="setHomepage('pattern-memory')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>ä¸‰çº§å­¦ä¹ æ¨¡å¼ï¼šå›¾ç‰‡é€‰æ‹©ã€é€‰æ‹©é¢˜ã€å•è¯è¡¥å…¨ï¼Œæ”¯æŒå¤šç§è®°å¿†æ–¹å¼</p>
            <div class="mode-features">
              <span class="feature-tag">å›¾ç‰‡é€‰æ‹©</span>
              <span class="feature-tag">é€‰æ‹©é¢˜</span>
              <span class="feature-tag">å•è¯è¡¥å…¨</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">ç³»ç»Ÿå­¦ä¹ </span>
            </div>
          </div>
        </div>

        <!-- å•è¯æŒ‘æˆ˜ -->
        <div v-if="canUseMode('word-challenge')" class="mode-card" @click="navigateToMode('word-challenge')">
          <div class="mode-header">
            <div class="mode-icon">âš”ï¸</div>
            <div class="mode-title">å•è¯æŒ‘æˆ˜</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-challenge"
                v-model="selectedHomepage"
                @change="setHomepage('word-challenge')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å•è¯æŒ‘æˆ˜æ¸¸æˆé¡µé¢</p>
            <div class="mode-features">
              <span class="feature-tag">æ¸¸æˆåŒ–</span>
              <span class="feature-tag">æŒ‘æˆ˜æ¨¡å¼</span>
              <span class="feature-tag">ç«æŠ€å¯¹æˆ˜</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">ç«æŠ€æŒ‘æˆ˜</span>
            </div>
          </div>
        </div>

        <!-- å•è¯å¤ä¹  -->
        <div v-if="canUseMode('word-review')" class="mode-card" @click="navigateToMode('word-review')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ”„</div>
            <div class="mode-title">å•è¯å¤ä¹ </div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-review"
                v-model="selectedHomepage"
                @change="setHomepage('word-review')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å•è¯å¤ä¹ é¡µé¢</p>
            <div class="mode-features">
              <span class="feature-tag">å¤ä¹ è®¡åˆ’</span>
              <span class="feature-tag">é—å¿˜æ›²çº¿</span>
              <span class="feature-tag">æ™ºèƒ½æ¨è</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">å·©å›ºå¤ä¹ </span>
            </div>
          </div>
        </div>

        <!-- å•è¯é€‰æ‹© -->
        <div v-if="canUseMode('word-selection')" class="mode-card" @click="navigateToMode('word-selection')">
          <div class="mode-header">
            <div class="mode-icon">âœ…</div>
            <div class="mode-title">å•è¯é€‰æ‹©</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="word-selection"
                v-model="selectedHomepage"
                @change="setHomepage('word-selection')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å•è¯é€‰æ‹©ç»ƒä¹ é¡µé¢</p>
            <div class="mode-features">
              <span class="feature-tag">é€‰æ‹©é¢˜</span>
              <span class="feature-tag">å¿«é€Ÿåˆ¤æ–­</span>
              <span class="feature-tag">å‡†ç¡®ç‡ç»Ÿè®¡</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">å¿«é€Ÿç»ƒä¹ </span>
            </div>
          </div>
        </div>

        <!-- å¸ˆç”Ÿäº’åŠ¨ -->
        <div v-if="canUseMode('teacher-student-interaction')" class="mode-card" @click="navigateToMode('teacher-student-interaction')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ‘¥</div>
            <div class="mode-title">å¸ˆç”Ÿäº’åŠ¨</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="teacher-student-interaction"
                v-model="selectedHomepage"
                @change="setHomepage('teacher-student-interaction')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å¸ˆç”Ÿäº’åŠ¨ç»ƒä¹ æ¨¡å¼ï¼Œæ”¯æŒå•è¯é€‰æ‹©å’Œå®æ—¶åé¦ˆ</p>
            <div class="mode-features">
              <span class="feature-tag">å¸ˆç”Ÿäº’åŠ¨</span>
              <span class="feature-tag">å®æ—¶åé¦ˆ</span>
              <span class="feature-tag">åä½œå­¦ä¹ </span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">è¯¾å ‚æ•™å­¦</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç‰¹è‰²æ¨¡å— -->
    <div class="category-section">
      <h2 class="category-title">ğŸ† ç‰¹è‰²æ¨¡å—</h2>
      <div class="mode-grid">
        <!-- ç«æŠ€æ¨¡å¼ -->
        <div v-if="canUseMode('competition')" class="mode-card" @click="navigateToMode('competition')">
          <div class="mode-header">
            <div class="mode-icon">ğŸ†</div>
            <div class="mode-title">ç«æŠ€æ¨¡å¼</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="competition"
                v-model="selectedHomepage"
                @change="setHomepage('competition')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>ä¸å…¶ä»–å­¦ä¹ è€…ç«æŠ€å¯¹æˆ˜ï¼Œå›¢é˜ŸæŒ‘æˆ˜</p>
            <div class="mode-features">
              <span class="feature-tag">å®æ—¶å¯¹æˆ˜</span>
              <span class="feature-tag">å›¢é˜ŸæŒ‘æˆ˜</span>
              <span class="feature-tag">æ’è¡Œæ¦œ</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">ç«æŠ€æŒ‘æˆ˜</span>
            </div>
          </div>
        </div>

        <!-- å¿«åˆ·æ¨¡å¼ -->
        <div v-if="canUseMode('quick-brush')" class="mode-card" @click="navigateToMode('quick-brush')">
          <div class="mode-header">
            <div class="mode-icon">âš¡</div>
            <div class="mode-title">å¿«åˆ·æ¨¡å¼</div>
            <div class="homepage-selector">
              <input 
                type="radio" 
                name="homepage" 
                value="quick-brush"
                v-model="selectedHomepage"
                @change="setHomepage('quick-brush')"
                @click.stop
              >
              <label>è®¾ä¸ºé¦–é¡µ</label>
            </div>
          </div>
          <div class="mode-description">
            <p>å¿«é€Ÿåˆ·é¢˜æ¨¡å¼ï¼Œè‡ªåŠ¨è·³è½¬ä¸‹ä¸€é¢˜ï¼Œæå‡å­¦ä¹ æ•ˆç‡</p>
            <div class="mode-features">
              <span class="feature-tag">å®æ—¶è®¡æ—¶</span>
              <span class="feature-tag">è‡ªåŠ¨è·³è½¬</span>
              <span class="feature-tag">å¿«é€Ÿåé¦ˆ</span>
            </div>
          </div>
          <div class="mode-stats">
            <div class="stat-item">
              <span class="stat-label">é€‚åˆäººç¾¤</span>
              <span class="stat-value">å¿«é€Ÿå¤ä¹ </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å½“å‰é¦–é¡µè®¾ç½®æç¤º -->
    <div v-if="selectedHomepage" class="homepage-tip">
      <div class="tip-content">
        <span class="tip-icon">ğŸ </span>
        <span class="tip-text">å½“å‰é¦–é¡µï¼š{{ getModeName(selectedHomepage) }}</span>
        <button @click="clearHomepage" class="clear-btn">æ¸…é™¤è®¾ç½®</button>
      </div>
    </div>
  </div>
</template>

<script>
import { UserSettingsManager } from '../utils/userSettings.js'
import userPersonalizationMixin, { predefinedElementConfigs } from '../mixins/userPersonalization.js'
import permissionMixin from '../mixins/permissionMixin.js'
import { homepageManager } from '../utils/homepageManager.js'

export default {
  name: 'LearningModeSelector',
  mixins: [userPersonalizationMixin, permissionMixin],
  data() {
    return {
      selectedHomepage: '',
      userId: 'default',
      userSettings: new UserSettingsManager(),
      // å­¦ä¹ æ¨¡å¼æƒé™æ˜ å°„
      modePermissions: {
        'word-reading': 'practice_reading',
        'word-learning': 'view_word_learning',
        'word-detail': 'view_word_detail',
        'word-root-analysis': 'analyze_word_roots',
        'story-reading': 'practice_story_reading',
        'spelling': 'practice_spelling',
        'flashcard': 'use_flashcard',
        'pattern-memory': 'use_pattern_memory',
        'word-challenge': 'participate_challenge',
        'word-review': 'review_words',
        'word-selection': 'practice_word_selection',
        'teacher-student-interaction': 'practice_word_selection',
        'competition': 'participate_challenge',
        'quick-brush': 'review_words'
      }
    }
  },
  
  computed: {
    /**
     * æ ¹æ®ç”¨æˆ·æƒé™è¿‡æ»¤å¯ç”¨çš„å­¦ä¹ æ¨¡å¼
     */
    availableModes() {
      const allModes = Object.keys(this.modePermissions)
      return allModes.filter(mode => {
        const permission = this.modePermissions[mode]
        return this.$hasPermission(permission)
      })
    }
  },
  methods: {
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™ä½¿ç”¨æŒ‡å®šæ¨¡å¼
     */
    canUseMode(mode) {
      const permission = this.modePermissions[mode]
      return permission ? this.$hasPermission(permission) : false
    },
    
    /**
     * å¯¼èˆªåˆ°æŒ‡å®šæ¨¡å¼ï¼ˆå¸¦æƒé™æ£€æŸ¥ï¼‰
     */
    navigateToMode(mode) {
      // æƒé™æ£€æŸ¥
      if (!this.canUseMode(mode)) {
        this.$showError(`æ‚¨æ²¡æœ‰æƒé™ä½¿ç”¨${homepageManager.getModeName(mode)}åŠŸèƒ½`)
        return
      }
      
      // æ‰§è¡Œå¯¼èˆª
      switch(mode) {
        case 'word-reading':
          this.$router.push('/word-reading')
          break
        case 'word-learning':
          this.$router.push('/word-learning')
          break
        case 'word-detail':
          this.$router.push('/word-detail/institution')
          break
        case 'word-root-analysis':
          this.$router.push('/word-root-analysis')
          break
        case 'story-reading':
          this.$router.push('/story-reading')
          break
        case 'spelling':
          this.$router.push('/word-learning/spelling')
          break
        case 'flashcard':
          this.$router.push('/word-learning/flashcard')
          break
        case 'pattern-memory':
          this.$router.push('/pattern-memory')
          break
        case 'word-challenge':
          this.$router.push('/word-challenge')
          break
        case 'word-review':
          this.$router.push('/word-review')
          break
        case 'word-selection':
          this.$router.push('/word-selection')
          break
        case 'teacher-student-interaction':
          this.$router.push('/word-selection-practice2')
          break
        case 'competition':
          this.$router.push('/competition')
          break
        case 'quick-brush':
          this.$router.push('/quick-brush')
          break
        default:
          console.log('æœªçŸ¥æ¨¡å¼:', mode)
      }
    },
    
    setHomepage(mode) {
      // æ£€æŸ¥æƒé™
      if (!this.canUseMode(mode)) {
        this.$showError(`æ‚¨æ²¡æœ‰æƒé™å°†${homepageManager.getModeName(mode)}è®¾ç½®ä¸ºé¦–é¡µ`)
        return
      }
      
      const success = homepageManager.setHomepage(mode)
      if (success) {
        this.selectedHomepage = mode
        
        // æ˜¾ç¤ºè®¾ç½®æˆåŠŸæç¤º
        this.$nextTick(() => {
          this.$showSuccess(`å·²å°†"${homepageManager.getModeName(mode)}"è®¾ç½®ä¸ºé¦–é¡µ`)
        })
      } else {
        this.$showError('è®¾ç½®é¦–é¡µå¤±è´¥ï¼Œè¯·é‡è¯•')
      }
    },
    
    clearHomepage() {
      const success = homepageManager.clearHomepage()
      if (success) {
        this.selectedHomepage = ''
      }
    },
    
    getModeName(mode) {
      return homepageManager.getModeName(mode)
    },
    
    // è·å–ç”¨æˆ·ID
    getUserId() {
      this.userId = this.userSettings.userId
    },
    
    // åŠ è½½ç”¨æˆ·çš„é¦–é¡µè®¾ç½®
    loadUserHomepageSettings() {
      this.selectedHomepage = homepageManager.getHomepage() || ''
    }
  },
  
  mounted() {
    // è·å–ç”¨æˆ·ID
    this.getUserId()
    
    // åŠ è½½ç”¨æˆ·çš„é¦–é¡µè®¾ç½®
    this.loadUserHomepageSettings()
    
    // åº”ç”¨ç«æŠ€æ¨¡å¼å…ƒç´ é…ç½®
    this.$nextTick(() => {
      const competitionConfigs = predefinedElementConfigs.competitionElements
      if (competitionConfigs && typeof competitionConfigs === 'object') {
        // competitionConfigs æ˜¯å¯¹è±¡ï¼Œä¸æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥ä½¿ç”¨ Object.entries éå†
        Object.entries(competitionConfigs).forEach(([key, config]) => {
          if (config && config.position && config.size) {
            // åº”ç”¨å…ƒç´ é…ç½®
            console.log(`Applying config for ${key}:`, config)
          }
        })
      }
    })
    
    // æ£€æŸ¥æ˜¯å¦ç¦ç”¨é‡å®šå‘
    const noRedirect = this.$route.query['no-redirect'] === 'true'
    
    // åªæœ‰åœ¨æ ¹è·¯å¾„ï¼ˆ/ï¼‰æˆ–é¦–é¡µç›¸å…³è·¯å¾„æ—¶æ‰æ‰§è¡Œé‡å®šå‘
    // é¿å…åœ¨å­¦ä¹ æ¨¡å¼é¡µé¢ä¸­è§¦å‘ä¸å¿…è¦çš„é‡å®šå‘
    const shouldCheckRedirect = ['/', '/index', '/dashboard', '/home'].includes(this.$route.path)
    
    // å¦‚æœæ²¡æœ‰ç¦ç”¨é‡å®šå‘ä¸”åœ¨åˆé€‚çš„è·¯å¾„ä¸‹ï¼Œåˆ™æ£€æŸ¥å¹¶æ‰§è¡Œé¦–é¡µé‡å®šå‘
    if (!noRedirect && shouldCheckRedirect) {
      const redirected = homepageManager.performHomepageRedirect(this.$router, this.$route)
      if (redirected) {
        return
      }
    }
  }
}
</script>

<style scoped>
.learning-mode-selector {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
  padding-bottom: 120px; /* å¢åŠ åº•éƒ¨å†…è¾¹è·ï¼Œç¡®ä¿å†…å®¹ä¸è¢«é®æŒ¡ */
}

.category-section {
  margin-bottom: 40px;
}

.category-title {
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 20px;
  text-align: center;
  background: linear-gradient(45deg, #fff, #f0f8ff, #fff);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: shimmer 3s ease-in-out infinite;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
}

@keyframes shimmer {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

.header {
  text-align: center;
  color: white;
  margin-bottom: 30px;
}

.header h1 {
  font-size: 2.5rem;
  margin-bottom: 10px;
  font-weight: 700;
}

.subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
}

.mode-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.mode-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.mode-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);
}

.mode-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.mode-icon {
  font-size: 2.5rem;
  margin-right: 12px;
}

.mode-title {
  font-size: 1.4rem;
  font-weight: 600;
  color: #333;
  flex: 1;
}

.homepage-selector {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.9rem;
  color: #666;
}

.homepage-selector input[type="radio"] {
  margin: 0;
}

.mode-description p {
  color: #666;
  line-height: 1.6;
  margin-bottom: 12px;
}

.mode-features {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 16px;
}

.feature-tag {
  background: #f0f4ff;
  color: #4f46e5;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
}

.mode-stats {
  border-top: 1px solid #eee;
  padding-top: 16px;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.stat-label {
  color: #888;
  font-size: 0.9rem;
}

.stat-value {
  color: #333;
  font-weight: 600;
}

.homepage-tip {
  position: fixed;
  bottom: 80px; /* è°ƒæ•´ä¸º80pxï¼Œç¡®ä¿ä¸è¢«åº•éƒ¨èœå•æ é®æŒ¡ */
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 12px 20px;
  border-radius: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  z-index: 1000;
}

.tip-content {
  display: flex;
  align-items: center;
  gap: 10px;
}

.tip-icon {
  font-size: 1.2rem;
}

.tip-text {
  color: #333;
  font-weight: 500;
}

.clear-btn {
  background: #ff4757;
  color: white;
  border: none;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.2s;
}

.clear-btn:hover {
  background: #ff3742;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .mode-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .header h1 {
    font-size: 2rem;
  }
  
  .mode-card {
    padding: 20px;
  }
  
  .mode-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .homepage-selector {
    align-self: flex-end;
  }
}
</style>
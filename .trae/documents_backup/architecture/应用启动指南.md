# Natural English 应用启动指南

## 概述

Natural English 是一个英语学习平台，包含前端Vue.js应用和多个后端Django应用。本文档详细说明了如何启动和运行整个系统。

## 系统架构

### 前端应用
- **技术栈**: Vue.js 3 + Vite
- **端口**: 3000 (默认)
- **目录**: `./Natural_English_front/`

### 后端应用
- **技术栈**: Django + Django REST Framework
- **主端口**: 8000
- **应用模块**:
  - `accounts` - 用户认证和账户管理
  - `permissions` - 权限控制系统
  - `teaching` - 教学管理
  - `learning_goals` - 学习目标管理
  - `learning_plans` - 学习计划管理

## 快速启动

### 方式一：使用启动脚本（推荐）

#### 启动前端
```bash
./Natural_English_front/start_frontend.sh
```

#### 启动后端
```bash
./start_backend.sh
```

### 方式二：手动启动

#### 前端手动启动
```bash
# 进入前端目录
cd Natural_English_front

# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm run dev
```

#### 后端手动启动
```bash
# 激活虚拟环境（如果使用）
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate     # Windows

# 安装依赖（首次运行）
pip install -r requirements.txt

# 数据库迁移（首次运行或模型变更后）
python manage.py makemigrations
python manage.py migrate

# 创建超级用户（首次运行）
python manage.py createsuperuser

# 启动开发服务器
python manage.py runserver 0.0.0.0:8000
```

## 环境配置

### 前端环境变量

在 `Natural_English_front/` 目录下创建 `.env` 文件：

```env
# 开发环境配置
VITE_API_BASE_URL=http://127.0.0.1:8000/api
VITE_DJANGO_ADMIN_URL=http://127.0.0.1:8000/admin
VITE_DJANGO_WS_URL=ws://127.0.0.1:8000/ws/permissions/
```

### 后端环境变量

在项目根目录创建 `.env` 文件：

```env
# Django配置
DEBUG=True
SECRET_KEY=your-secret-key-here
ALLOWED_HOSTS=127.0.0.1,localhost

# 数据库配置
DATABASE_URL=sqlite:///db.sqlite3

# CORS配置
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
```

## 端口配置

### 默认端口分配
- **前端**: 3000
- **后端主服务**: 8000
- **WebSocket**: 8000 (与主服务共享)

### 端口冲突解决

如果端口被占用，系统会自动尝试其他端口：
- 前端: 3001, 3002, 3003...
- 后端: 保持8000端口，需要手动指定其他端口

```bash
# 指定后端端口
python manage.py runserver 0.0.0.0:8001
```

## 开发工具

### 前端开发工具
- **热重载**: 代码修改后自动刷新
- **调试面板**: WebSocket连接诊断工具
- **权限调试**: 内置权限检查工具

### 后端开发工具
- **Django Admin**: http://127.0.0.1:8000/admin/
- **API文档**: http://127.0.0.1:8000/api/docs/
- **数据库管理**: Django ORM

## 常见问题

### 1. 前端启动失败

**问题**: `npm run dev` 失败

**解决方案**:
```bash
# 清除缓存
npm cache clean --force

# 删除node_modules重新安装
rm -rf node_modules package-lock.json
npm install
```

### 2. 后端连接失败

**问题**: 前端无法连接后端API

**解决方案**:
1. 确认后端服务正在运行: `http://127.0.0.1:8000/`
2. 检查CORS配置
3. 验证API端点: `http://127.0.0.1:8000/api/`

### 3. WebSocket连接失败

**问题**: 权限同步不工作

**解决方案**:
1. 确认WebSocket端点: `ws://127.0.0.1:8000/ws/permissions/`
2. 检查认证token
3. 使用内置诊断工具

### 4. 权限错误

**问题**: 页面显示权限不足

**解决方案**:
1. 检查用户角色和权限
2. 清除权限缓存
3. 重新登录

## 生产环境部署

### 前端构建
```bash
cd Natural_English_front
npm run build
```

### 后端部署
```bash
# 收集静态文件
python manage.py collectstatic

# 使用生产服务器（如Gunicorn）
gunicorn myproject.wsgi:application --bind 0.0.0.0:8000
```

## 监控和日志

### 前端日志
- 浏览器开发者工具控制台
- WebSocket诊断面板

### 后端日志
- Django控制台输出
- 日志文件（如配置）

## 技术支持

如遇到问题，请检查：
1. 系统要求是否满足
2. 依赖是否正确安装
3. 端口是否被占用
4. 环境变量是否正确配置

---

**最后更新**: 2024年12月
**版本**: 1.0.0
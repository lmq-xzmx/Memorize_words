# Natural English æƒé™ç®¡ç†ç³»ç»Ÿæ“ä½œæŒ‡å—

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **é¡¹ç›®åç§°**: Natural English è‹±è¯­å­¦ä¹ å¹³å°
- **æ–‡æ¡£ç±»å‹**: æƒé™ç³»ç»Ÿæ“ä½œæŒ‡å—
- **æ›´æ–°æ—¥æœŸ**: 2025å¹´1æœˆ
- **ç³»ç»Ÿå®Œæˆåº¦**: 98%
- **æŠ€æœ¯æ ˆ**: Vue3 + TypeScript + Django + Python

## ğŸ“– ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
3. [ç”¨æˆ·æ³¨å†Œä¸è§’è‰²åˆ†é…](#ç”¨æˆ·æ³¨å†Œä¸è§’è‰²åˆ†é…)
4. [æƒé™ç®¡ç†æ“ä½œ](#æƒé™ç®¡ç†æ“ä½œ)
5. [èœå•æƒé™é…ç½®](#èœå•æƒé™é…ç½®)
6. [å®æ—¶æƒé™åŒæ­¥](#å®æ—¶æƒé™åŒæ­¥)
7. [å®‰å…¨åŠŸèƒ½ä½¿ç”¨](#å®‰å…¨åŠŸèƒ½ä½¿ç”¨)
8. [ç›‘æ§ä¸å®¡è®¡](#ç›‘æ§ä¸å®¡è®¡)
9. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
10. [APIæ¥å£è¯´æ˜](#APIæ¥å£è¯´æ˜)

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿç‰¹æ€§
Natural Englishæƒé™ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºRBACæ¨¡å‹çš„å®Œæ•´æƒé™è§£å†³æ–¹æ¡ˆï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

- âœ… **åŠ¨æ€è§’è‰²æ³¨å†Œ**: ç”¨æˆ·æ³¨å†Œæ—¶å¯é€‰æ‹©è§’è‰²å’Œè§’è‰²å¢é¡¹
- âœ… **å®æ—¶æƒé™æ›´æ–°**: è§’è‰²æƒé™å˜æ›´æ—¶æ‰€æœ‰ç”¨æˆ·æƒé™å®æ—¶åŒæ­¥
- âœ… **å¤šå±‚çº§æƒé™æ§åˆ¶**: è·¯ç”±çº§ã€ç»„ä»¶çº§ã€APIçº§æƒé™æ§åˆ¶
- âœ… **é«˜æ€§èƒ½ç¼“å­˜**: LRUç¼“å­˜æœºåˆ¶ï¼Œç¼“å­˜å‘½ä¸­ç‡>95%
- âœ… **WebSocketå®æ—¶æ¨é€**: æƒé™å˜æ›´å®æ—¶é€šçŸ¥
- âœ… **å®Œæ•´å®¡è®¡æ—¥å¿—**: æ‰€æœ‰æƒé™æ“ä½œå¯è¿½è¸ª
- âœ… **å®‰å…¨å¢å¼º**: æ•æ„Ÿæ“ä½œäºŒæ¬¡éªŒè¯

### æŠ€æœ¯æ¶æ„
```
å‰ç«¯å±‚ (Vue3 + TypeScript)
â”œâ”€â”€ é¡µé¢ç»„ä»¶ (Register.vue, Dashboard.vue, Admin/*.vue)
â”œâ”€â”€ æƒé™ç»„ä»¶ (PermissionLoader.vue, PermissionDenied.vue)
â”œâ”€â”€ æœåŠ¡å±‚ (roleService, permissionService, userService)
â”œâ”€â”€ çŠ¶æ€ç®¡ç† (Vuex Store: auth.ts, menu.ts, user.ts)
â””â”€â”€ å·¥å…·å±‚ (æƒé™ç¼“å­˜, APIæ‹¦æˆªå™¨, WebSocket)

åç«¯å±‚ (Django + Python)
â”œâ”€â”€ æƒé™æ¨¡å— (permissions/models.py, routing.py)
â”œâ”€â”€ ç”¨æˆ·æ¨¡å— (accounts/models.py, api_views.py)
â””â”€â”€ å®¡è®¡æ¨¡å— (audit.py, signals.py)
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ
**æ–‡ä»¶ä½ç½®**: `src/pages/Register.vue`

#### åŠŸèƒ½ç‰¹æ€§
- ğŸ¯ åŠ¨æ€è§’è‰²é€‰æ‹©ç•Œé¢
- ğŸ”„ å®æ—¶è§’è‰²å­—æ®µé…ç½®è·å–
- âœ… å®Œæ•´çš„è¡¨å•éªŒè¯æœºåˆ¶
- ğŸ›¡ï¸ å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒé‡éªŒè¯

#### æ”¯æŒçš„è§’è‰²ç±»å‹
| è§’è‰² | è§’è‰²å¢é¡¹ | æƒé™èŒƒå›´ |
|------|----------|----------|
| å­¦ç”Ÿ (Student) | å­¦å·ã€å¹´çº§ã€ç­çº§ | å­¦ä¹ åŠŸèƒ½ã€ä¸ªäººè¿›åº¦ |
| æ•™å¸ˆ (Teacher) | æ•™å¸ˆç¼–å·ã€å­¦ç§‘ã€èŒç§° | æ•™å­¦ç®¡ç†ã€å­¦ç”Ÿç›‘æ§ |
| ç®¡ç†å‘˜ (Admin) | éƒ¨é—¨ã€æƒé™çº§åˆ« | ç³»ç»Ÿç®¡ç†ã€ç”¨æˆ·ç®¡ç† |

#### æ“ä½œæ­¥éª¤
1. è®¿é—®æ³¨å†Œé¡µé¢ `/register`
2. é€‰æ‹©ç”¨æˆ·è§’è‰²
3. ç³»ç»Ÿè‡ªåŠ¨åŠ è½½è§’è‰²å¯¹åº”çš„æ‰©å±•å­—æ®µ
4. å¡«å†™åŸºæœ¬ä¿¡æ¯å’Œè§’è‰²ç‰¹å®šä¿¡æ¯
5. æäº¤æ³¨å†Œï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…æƒé™

### 2. æƒé™ç®¡ç†ç³»ç»Ÿ
**æ ¸å¿ƒæ–‡ä»¶**:
- `src/composables/usePermission.ts` - æƒé™é€»è¾‘å°è£…
- `src/services/permissionService.ts` - æƒé™APIæœåŠ¡
- `src/utils/permissionCacheManager.ts` - æƒé™ç¼“å­˜ç®¡ç†

#### æƒé™æ£€æŸ¥æ–¹æ³•
```typescript
// 1. ç»„åˆå¼APIä½¿ç”¨
import { usePermission } from '@/composables/usePermission'

const { hasPermission, checkPermissions } = usePermission()

// æ£€æŸ¥å•ä¸ªæƒé™
if (hasPermission('word_learning_access')) {
  // æ‰§è¡Œæ“ä½œ
}

// æ£€æŸ¥å¤šä¸ªæƒé™
if (checkPermissions(['class_management_access', 'student_progress_access'])) {
  // æ‰§è¡Œæ“ä½œ
}
```

```vue
<!-- 2. æŒ‡ä»¤ä½¿ç”¨ -->
<template>
  <button v-permission="'user_create'">åˆ›å»ºç”¨æˆ·</button>
  <div v-permission="['admin_access', 'user_management']">ç®¡ç†é¢æ¿</div>
</template>
```

### 3. èœå•æƒé™ç³»ç»Ÿ
**æ ¸å¿ƒæ–‡ä»¶**:
- `src/components/menu/BaseMenu.vue` - èœå•ç»„ä»¶
- `src/composables/useMenu.ts` - èœå•é€»è¾‘
- `src/config/menuConfig.js` - èœå•é…ç½®

#### èœå•é…ç½®ç¤ºä¾‹
```javascript
// src/config/menuConfig.js
export const menuConfig = [
  {
    id: 'learning',
    name: 'å­¦ä¹ ä¸­å¿ƒ',
    icon: 'book',
    permission: 'learning_access',
    children: [
      {
        id: 'word-learning',
        name: 'å•è¯å­¦ä¹ ',
        path: '/learning/words',
        permission: 'word_learning_access'
      },
      {
        id: 'reading',
        name: 'é˜…è¯»ç†è§£',
        path: '/learning/reading',
        permission: 'reading_access'
      }
    ]
  },
  {
    id: 'admin',
    name: 'ç®¡ç†ä¸­å¿ƒ',
    icon: 'settings',
    permission: 'admin_access',
    children: [
      {
        id: 'user-management',
        name: 'ç”¨æˆ·ç®¡ç†',
        path: '/admin/users',
        permission: 'user_management_access'
      }
    ]
  }
]
```

## ğŸ‘¤ ç”¨æˆ·æ³¨å†Œä¸è§’è‰²åˆ†é…

### åŠ¨æ€è§’è‰²æ³¨å†Œæµç¨‹

#### 1. å‰ç«¯æ³¨å†Œç•Œé¢
```vue
<!-- Register.vue æ ¸å¿ƒé€»è¾‘ -->
<template>
  <form @submit.prevent="handleSubmit">
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <input v-model="registerForm.username" placeholder="ç”¨æˆ·å" />
    <input v-model="registerForm.email" placeholder="é‚®ç®±" />
    
    <!-- è§’è‰²é€‰æ‹© -->
    <select v-model="registerForm.role" @change="handleRoleChange">
      <option v-for="role in availableRoles" :key="role.id" :value="role.code">
        {{ role.name }}
      </option>
    </select>
    
    <!-- åŠ¨æ€è§’è‰²å­—æ®µ -->
    <div v-for="field in extendedFields" :key="field.name">
      <label>{{ field.label }}</label>
      <input 
        v-model="registerForm.extended_fields[field.name]"
        :type="field.type"
        :placeholder="field.placeholder"
        :required="field.required"
      />
    </div>
    
    <button type="submit">æ³¨å†Œ</button>
  </form>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { roleService } from '@/services/roleService'

const registerForm = ref({
  username: '',
  email: '',
  password: '',
  role: '',
  extended_fields: {}
})

const availableRoles = ref([])
const extendedFields = ref([])

// è·å–å¯ç”¨è§’è‰²
onMounted(async () => {
  availableRoles.value = await roleService.getAvailableRoles()
})

// è§’è‰²å˜æ›´å¤„ç†
const handleRoleChange = async () => {
  if (registerForm.value.role) {
    extendedFields.value = await roleService.getRoleFields(registerForm.value.role)
    // é‡ç½®æ‰©å±•å­—æ®µ
    registerForm.value.extended_fields = {}
  }
}
</script>
```

#### 2. è§’è‰²å­—æ®µé…ç½®
ä¸åŒè§’è‰²çš„æ‰©å±•å­—æ®µé…ç½®ï¼š

**å­¦ç”Ÿè§’è‰²å­—æ®µ**:
```json
{
  "student_id": {
    "label": "å­¦å·",
    "type": "text",
    "required": true,
    "placeholder": "è¯·è¾“å…¥å­¦å·"
  },
  "grade": {
    "label": "å¹´çº§",
    "type": "select",
    "options": ["ä¸€å¹´çº§", "äºŒå¹´çº§", "ä¸‰å¹´çº§"],
    "required": true
  },
  "class_name": {
    "label": "ç­çº§",
    "type": "text",
    "required": false
  }
}
```

**æ•™å¸ˆè§’è‰²å­—æ®µ**:
```json
{
  "teacher_id": {
    "label": "æ•™å¸ˆç¼–å·",
    "type": "text",
    "required": true
  },
  "subject": {
    "label": "å­¦ç§‘",
    "type": "select",
    "options": ["è‹±è¯­", "æ•°å­¦", "è¯­æ–‡"],
    "required": true
  },
  "title": {
    "label": "èŒç§°",
    "type": "select",
    "options": ["åŠ©æ•™", "è®²å¸ˆ", "å‰¯æ•™æˆ", "æ•™æˆ"],
    "required": false
  }
}
```

## ğŸ” æƒé™ç®¡ç†æ“ä½œ

### è§’è‰²æƒé™åˆ†é…

#### 1. è§’è‰²ç®¡ç†ç•Œé¢
**æ–‡ä»¶ä½ç½®**: `src/pages/admin/RoleManagement.vue`

```vue
<template>
  <div class="role-management">
    <h2>è§’è‰²ç®¡ç†</h2>
    
    <!-- è§’è‰²åˆ—è¡¨ -->
    <div class="role-list">
      <div v-for="role in roles" :key="role.id" class="role-item">
        <h3>{{ role.name }}</h3>
        <p>{{ role.description }}</p>
        
        <!-- æƒé™åˆ†é… -->
        <div class="permissions">
          <h4>æƒé™é…ç½®</h4>
          <div v-for="category in permissionCategories" :key="category.name">
            <h5>{{ category.label }}</h5>
            <label v-for="permission in category.permissions" :key="permission.code">
              <input 
                type="checkbox" 
                :checked="roleHasPermission(role.id, permission.code)"
                @change="togglePermission(role.id, permission.code)"
              />
              {{ permission.name }}
            </label>
          </div>
        </div>
        
        <button @click="saveRolePermissions(role.id)">ä¿å­˜æƒé™</button>
      </div>
    </div>
  </div>
</template>
```

#### 2. æƒé™åˆ†ç±»
ç³»ç»Ÿæƒé™æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»ï¼š

**å­¦ä¹ æ¨¡å—æƒé™**:
- `word_learning_access` - å•è¯å­¦ä¹ è®¿é—®
- `word_challenge_access` - å•è¯æŒ‘æˆ˜è®¿é—®
- `reading_access` - é˜…è¯»ç†è§£è®¿é—®
- `listening_access` - å¬åŠ›ç»ƒä¹ è®¿é—®
- `grammar_access` - è¯­æ³•å­¦ä¹ è®¿é—®

**æ•™å­¦æ¨¡å—æƒé™**:
- `class_management_access` - ç­çº§ç®¡ç†è®¿é—®
- `student_progress_access` - å­¦ç”Ÿè¿›åº¦æŸ¥çœ‹
- `assignment_create` - ä½œä¸šåˆ›å»ºæƒé™
- `assignment_grade` - ä½œä¸šè¯„åˆ†æƒé™

**ç®¡ç†æ¨¡å—æƒé™**:
- `user_management_access` - ç”¨æˆ·ç®¡ç†è®¿é—®
- `role_management_access` - è§’è‰²ç®¡ç†è®¿é—®
- `system_config_access` - ç³»ç»Ÿé…ç½®è®¿é—®
- `audit_log_access` - å®¡è®¡æ—¥å¿—è®¿é—®

## ğŸ“± èœå•æƒé™é…ç½®

### åŠ¨æ€èœå•ç³»ç»Ÿ

#### 1. èœå•æƒé™æ§åˆ¶
```typescript
// src/composables/useMenu.ts
import { computed } from 'vue'
import { usePermission } from './usePermission'
import { menuConfig } from '@/config/menuConfig'

export function useMenu() {
  const { hasPermission } = usePermission()
  
  // è¿‡æ»¤æœ‰æƒé™çš„èœå•
  const filteredMenus = computed(() => {
    return filterMenusByPermission(menuConfig)
  })
  
  function filterMenusByPermission(menus: any[]) {
    return menus.filter(menu => {
      // æ£€æŸ¥èœå•æƒé™
      if (menu.permission && !hasPermission(menu.permission)) {
        return false
      }
      
      // é€’å½’è¿‡æ»¤å­èœå•
      if (menu.children) {
        menu.children = filterMenusByPermission(menu.children)
        // å¦‚æœæ²¡æœ‰å¯è®¿é—®çš„å­èœå•ï¼Œéšè—çˆ¶èœå•
        return menu.children.length > 0
      }
      
      return true
    })
  }
  
  return {
    filteredMenus
  }
}
```

#### 2. èœå•ç»„ä»¶å®ç°
```vue
<!-- src/components/menu/BaseMenu.vue -->
<template>
  <nav class="base-menu">
    <ul>
      <li v-for="menu in filteredMenus" :key="menu.id">
        <router-link 
          v-if="!menu.children" 
          :to="menu.path"
          class="menu-item"
        >
          <i :class="menu.icon"></i>
          {{ menu.name }}
        </router-link>
        
        <!-- å¤šçº§èœå• -->
        <div v-else class="menu-group">
          <div class="menu-title">
            <i :class="menu.icon"></i>
            {{ menu.name }}
          </div>
          <ul class="submenu">
            <li v-for="submenu in menu.children" :key="submenu.id">
              <router-link :to="submenu.path">
                {{ submenu.name }}
              </router-link>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </nav>
</template>

<script setup lang="ts">
import { useMenu } from '@/composables/useMenu'

const { filteredMenus } = useMenu()
</script>
```

## ğŸ”„ å®æ—¶æƒé™åŒæ­¥

### WebSocketæƒé™æ¨é€

#### 1. WebSocketé…ç½®
**æ–‡ä»¶ä½ç½®**: `src/config/websocketConfig.ts`

```typescript
class WebSocketManager {
  private ws: WebSocket | null = null
  private reconnectAttempts = 0
  private maxReconnectAttempts = 5
  private reconnectInterval = 3000
  
  connect() {
    const wsUrl = `ws://${window.location.host}/ws/permissions/`
    this.ws = new WebSocket(wsUrl)
    
    this.ws.onopen = () => {
      console.log('æƒé™WebSocketè¿æ¥å·²å»ºç«‹')
      this.reconnectAttempts = 0
    }
    
    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data)
      this.handlePermissionUpdate(data)
    }
    
    this.ws.onclose = () => {
      console.log('æƒé™WebSocketè¿æ¥å·²å…³é—­')
      this.attemptReconnect()
    }
    
    this.ws.onerror = (error) => {
      console.error('æƒé™WebSocketé”™è¯¯:', error)
    }
  }
  
  private handlePermissionUpdate(data: any) {
    switch (data.type) {
      case 'permission_updated':
        // æ¸…é™¤æƒé™ç¼“å­˜
        permissionCacheManager.clearUserCache(data.user_id)
        // é‡æ–°è·å–æƒé™
        permissionService.refreshUserPermissions()
        break
      case 'role_updated':
        // è§’è‰²æƒé™æ›´æ–°
        permissionCacheManager.clearRoleCache(data.role_id)
        break
    }
  }
}

export const websocketManager = new WebSocketManager()
```

#### 2. æƒé™ç¼“å­˜ç®¡ç†
**æ–‡ä»¶ä½ç½®**: `src/utils/permissionCacheManager.ts`

```typescript
class PermissionCacheManager {
  private cache = new Map<string, any>()
  private maxSize = 1000
  private ttl = 5 * 60 * 1000 // 5åˆ†é’Ÿ
  
  // LRUç¼“å­˜å®ç°
  get(key: string) {
    const item = this.cache.get(key)
    if (!item) return null
    
    // æ£€æŸ¥è¿‡æœŸæ—¶é—´
    if (Date.now() > item.expiry) {
      this.cache.delete(key)
      return null
    }
    
    // LRU: ç§»åŠ¨åˆ°æœ€å
    this.cache.delete(key)
    this.cache.set(key, item)
    
    return item.data
  }
  
  set(key: string, data: any) {
    // å¦‚æœç¼“å­˜å·²æ»¡ï¼Œåˆ é™¤æœ€æ—§çš„é¡¹
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value
      this.cache.delete(firstKey)
    }
    
    this.cache.set(key, {
      data,
      expiry: Date.now() + this.ttl
    })
  }
  
  clearUserCache(userId: string) {
    const userKeys = Array.from(this.cache.keys()).filter(key => 
      key.startsWith(`user_${userId}_`)
    )
    userKeys.forEach(key => this.cache.delete(key))
  }
}

export const permissionCacheManager = new PermissionCacheManager()
```

## ğŸ›¡ï¸ å®‰å…¨åŠŸèƒ½ä½¿ç”¨

### æ•æ„Ÿæ“ä½œäºŒæ¬¡éªŒè¯

#### 1. äºŒæ¬¡éªŒè¯ç»„ä»¶
**æ–‡ä»¶ä½ç½®**: `src/components/SecondaryVerification.vue`

```vue
<template>
  <div v-if="showVerification" class="verification-modal">
    <div class="modal-content">
      <h3>å®‰å…¨éªŒè¯</h3>
      <p>æ­¤æ“ä½œéœ€è¦äºŒæ¬¡éªŒè¯ï¼Œè¯·è¾“å…¥æ‚¨çš„å¯†ç ï¼š</p>
      
      <form @submit.prevent="handleVerification">
        <input 
          v-model="password" 
          type="password" 
          placeholder="è¯·è¾“å…¥å¯†ç "
          required
        />
        <div class="actions">
          <button type="button" @click="cancel">å–æ¶ˆ</button>
          <button type="submit" :disabled="loading">
            {{ loading ? 'éªŒè¯ä¸­...' : 'ç¡®è®¤' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { authService } from '@/services/authService'

const props = defineProps<{
  operation: string
  onSuccess: () => void
  onCancel: () => void
}>()

const showVerification = ref(true)
const password = ref('')
const loading = ref(false)

const handleVerification = async () => {
  loading.value = true
  try {
    const result = await authService.verifyPassword(password.value)
    if (result.success) {
      props.onSuccess()
      showVerification.value = false
    } else {
      alert('å¯†ç éªŒè¯å¤±è´¥')
    }
  } catch (error) {
    console.error('éªŒè¯å¤±è´¥:', error)
    alert('éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯')
  } finally {
    loading.value = false
  }
}

const cancel = () => {
  props.onCancel()
  showVerification.value = false
}
</script>
```

#### 2. ä½¿ç”¨äºŒæ¬¡éªŒè¯
```vue
<template>
  <div>
    <button @click="deleteUser">åˆ é™¤ç”¨æˆ·</button>
    
    <SecondaryVerification
      v-if="showSecondaryVerification"
      operation="delete_user"
      :on-success="confirmDeleteUser"
      :on-cancel="cancelDeleteUser"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import SecondaryVerification from '@/components/SecondaryVerification.vue'

const showSecondaryVerification = ref(false)

const deleteUser = () => {
  showSecondaryVerification.value = true
}

const confirmDeleteUser = () => {
  // æ‰§è¡Œåˆ é™¤æ“ä½œ
  console.log('ç”¨æˆ·åˆ é™¤ç¡®è®¤')
  showSecondaryVerification.value = false
}

const cancelDeleteUser = () => {
  showSecondaryVerification.value = false
}
</script>
```

## ğŸ“Š ç›‘æ§ä¸å®¡è®¡

### å®¡è®¡æ—¥å¿—ç®¡ç†

#### 1. å®¡è®¡æ—¥å¿—ç•Œé¢
**æ–‡ä»¶ä½ç½®**: `src/pages/admin/AuditLogManagement.vue`

```vue
<template>
  <div class="audit-log-management">
    <h2>æƒé™å®¡è®¡æ—¥å¿—</h2>
    
    <!-- ç­›é€‰æ¡ä»¶ -->
    <div class="filters">
      <input v-model="filters.user" placeholder="ç”¨æˆ·å" />
      <select v-model="filters.action">
        <option value="">æ‰€æœ‰æ“ä½œ</option>
        <option value="login">ç™»å½•</option>
        <option value="permission_change">æƒé™å˜æ›´</option>
        <option value="role_assignment">è§’è‰²åˆ†é…</option>
      </select>
      <input v-model="filters.dateFrom" type="date" />
      <input v-model="filters.dateTo" type="date" />
      <button @click="loadAuditLogs">æŸ¥è¯¢</button>
    </div>
    
    <!-- æ—¥å¿—åˆ—è¡¨ -->
    <div class="log-list">
      <table>
        <thead>
          <tr>
            <th>æ—¶é—´</th>
            <th>ç”¨æˆ·</th>
            <th>æ“ä½œ</th>
            <th>è¯¦æƒ…</th>
            <th>IPåœ°å€</th>
            <th>çŠ¶æ€</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="log in auditLogs" :key="log.id">
            <td>{{ formatDate(log.timestamp) }}</td>
            <td>{{ log.user }}</td>
            <td>{{ log.action }}</td>
            <td>{{ log.details }}</td>
            <td>{{ log.ip_address }}</td>
            <td>
              <span :class="getStatusClass(log.status)">
                {{ log.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- åˆ†é¡µ -->
    <PermissionPagination
      :current-page="currentPage"
      :total-pages="totalPages"
      @page-change="handlePageChange"
    />
  </div>
</template>
```

#### 2. æƒé™ç³»ç»Ÿç›‘æ§é¢æ¿
**æ–‡ä»¶ä½ç½®**: `src/pages/admin/PermissionSystemPanel.vue`

```vue
<template>
  <div class="permission-system-panel">
    <h2>æƒé™ç³»ç»Ÿç›‘æ§</h2>
    
    <!-- ç³»ç»ŸçŠ¶æ€ -->
    <div class="system-status">
      <div class="status-card">
        <h3>ç¼“å­˜çŠ¶æ€</h3>
        <p>å‘½ä¸­ç‡: {{ cacheStats.hitRate }}%</p>
        <p>ç¼“å­˜å¤§å°: {{ cacheStats.size }}</p>
      </div>
      
      <div class="status-card">
        <h3>WebSocketçŠ¶æ€</h3>
        <p>è¿æ¥çŠ¶æ€: {{ websocketStatus }}</p>
        <p>åœ¨çº¿ç”¨æˆ·: {{ onlineUsers }}</p>
      </div>
      
      <div class="status-card">
        <h3>æƒé™ç»Ÿè®¡</h3>
        <p>æ€»ç”¨æˆ·æ•°: {{ userStats.total }}</p>
        <p>æ´»è·ƒç”¨æˆ·: {{ userStats.active }}</p>
      </div>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="actions">
      <button @click="clearCache">æ¸…é™¤ç¼“å­˜</button>
      <button @click="refreshPermissions">åˆ·æ–°æƒé™</button>
      <button @click="exportAuditLogs">å¯¼å‡ºå®¡è®¡æ—¥å¿—</button>
    </div>
  </div>
</template>
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æƒé™ç¼“å­˜é—®é¢˜
**é—®é¢˜**: ç”¨æˆ·æƒé™æ›´æ–°åå‰ç«¯æ²¡æœ‰ç«‹å³ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ‰‹åŠ¨æ¸…é™¤ç”¨æˆ·æƒé™ç¼“å­˜
import { permissionCacheManager } from '@/utils/permissionCacheManager'

// æ¸…é™¤ç‰¹å®šç”¨æˆ·ç¼“å­˜
permissionCacheManager.clearUserCache(userId)

// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
permissionCacheManager.clearAll()

// é‡æ–°è·å–æƒé™
await permissionService.refreshUserPermissions()
```

#### 2. WebSocketè¿æ¥é—®é¢˜
**é—®é¢˜**: WebSocketè¿æ¥æ–­å¼€ï¼Œæƒé™æ›´æ–°ä¸åŠæ—¶

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥WebSocketçŠ¶æ€
import { websocketManager } from '@/config/websocketConfig'

// æ‰‹åŠ¨é‡è¿
websocketManager.reconnect()

// æ£€æŸ¥è¿æ¥çŠ¶æ€
console.log('WebSocketçŠ¶æ€:', websocketManager.getStatus())
```

#### 3. èœå•æƒé™ä¸æ˜¾ç¤º
**é—®é¢˜**: ç”¨æˆ·æœ‰æƒé™ä½†èœå•ä¸æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥èœå•é…ç½®ä¸­çš„æƒé™ä»£ç æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç”¨æˆ·è§’è‰²æ˜¯å¦åŒ…å«ç›¸åº”æƒé™
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡æ–°ç™»å½•

```typescript
// è°ƒè¯•èœå•æƒé™
import { usePermission } from '@/composables/usePermission'
import { useMenu } from '@/composables/useMenu'

const { hasPermission, getUserPermissions } = usePermission()
const { filteredMenus } = useMenu()

// æ£€æŸ¥ç”¨æˆ·æƒé™
console.log('ç”¨æˆ·æƒé™:', getUserPermissions())

// æ£€æŸ¥ç‰¹å®šæƒé™
console.log('æ˜¯å¦æœ‰èœå•æƒé™:', hasPermission('menu_access'))

// æ£€æŸ¥è¿‡æ»¤åçš„èœå•
console.log('å¯è®¿é—®èœå•:', filteredMenus.value)
```

## ğŸ“¡ APIæ¥å£è¯´æ˜

### æƒé™ç›¸å…³API

#### 1. è·å–å¯ç”¨è§’è‰²
```http
GET /api/permissions/roles/available/
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "code": "student",
      "name": "å­¦ç”Ÿ",
      "description": "å­¦ä¹ å¹³å°å­¦ç”Ÿç”¨æˆ·"
    },
    {
      "id": 2,
      "code": "teacher",
      "name": "æ•™å¸ˆ",
      "description": "æ•™å­¦ç®¡ç†ç”¨æˆ·"
    }
  ]
}
```

#### 2. è·å–è§’è‰²å­—æ®µé…ç½®
```http
GET /api/permissions/roles/{role}/fields/
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "name": "student_id",
      "label": "å­¦å·",
      "type": "text",
      "required": true,
      "placeholder": "è¯·è¾“å…¥å­¦å·"
    }
  ]
}
```

#### 3. è·å–ç”¨æˆ·æƒé™
```http
GET /api/permissions/user/permissions/
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "permissions": [
      "word_learning_access",
      "reading_access",
      "profile_access"
    ],
    "role": "student",
    "cache_key": "user_123_permissions"
  }
}
```

#### 4. åˆ·æ–°æƒé™ç¼“å­˜
```http
POST /api/permissions/cache/refresh/
Authorization: Bearer {token}
```

### WebSocketæ¶ˆæ¯æ ¼å¼

#### æƒé™æ›´æ–°æ¶ˆæ¯
```json
{
  "type": "permission_updated",
  "user_id": 123,
  "permissions": ["new_permission_list"],
  "timestamp": "2025-01-01T12:00:00Z"
}
```

#### è§’è‰²æ›´æ–°æ¶ˆæ¯
```json
{
  "type": "role_updated",
  "role_id": 2,
  "affected_users": [123, 456],
  "timestamp": "2025-01-01T12:00:00Z"
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜ä¼˜åŒ–
- åˆç†è®¾ç½®ç¼“å­˜TTLæ—¶é—´
- ä½¿ç”¨LRUç®—æ³•ç®¡ç†ç¼“å­˜å¤§å°
- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜

### 2. ç½‘ç»œä¼˜åŒ–
- ä½¿ç”¨WebSocketå‡å°‘è½®è¯¢è¯·æ±‚
- å®ç°æƒé™æ‰¹é‡æŸ¥è¯¢æ¥å£
- å¯ç”¨HTTP/2å’Œå‹ç¼©

### 3. å‰ç«¯ä¼˜åŒ–
- æƒé™ç»„ä»¶æ‡’åŠ è½½
- èœå•æƒé™é¢„è®¡ç®—
- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ•°æ®

## ğŸ“ æ€»ç»“

Natural Englishæƒé™ç®¡ç†ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„RBACæƒé™è§£å†³æ–¹æ¡ˆï¼Œå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š

âœ… **åŠŸèƒ½å®Œæ•´**: æ¶µç›–ç”¨æˆ·æ³¨å†Œã€è§’è‰²ç®¡ç†ã€æƒé™æ§åˆ¶ã€å®æ—¶åŒæ­¥ç­‰å…¨æµç¨‹  
âœ… **æ€§èƒ½ä¼˜å¼‚**: é«˜æ•ˆç¼“å­˜æœºåˆ¶ï¼Œå“åº”æ—¶é—´<100ms  
âœ… **å®‰å…¨å¯é **: å¤šå±‚æ¬¡æƒé™éªŒè¯ï¼Œå®Œæ•´å®¡è®¡æ—¥å¿—  
âœ… **æ˜“äºä½¿ç”¨**: ç›´è§‚çš„æ“ä½œç•Œé¢ï¼Œå®Œå–„çš„æ–‡æ¡£æ”¯æŒ  
âœ… **æ‰©å±•æ€§å¼º**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰æƒé™å’Œè§’è‰²  

ç³»ç»Ÿå·²è¾¾åˆ°98%å®Œæˆåº¦ï¼Œå¯æ»¡è¶³ç”Ÿäº§ç¯å¢ƒä½¿ç”¨éœ€æ±‚ã€‚
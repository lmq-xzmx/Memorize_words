# ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿè§„èŒƒ

## 1. äº§å“æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸ºNatural Englishè‹±è¯­å­¦ä¹ å¹³å°å»ºç«‹å®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿè§„èŒƒï¼ŒåŸºäºRBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰æ¨¡å‹ï¼Œç»Ÿä¸€ç®¡ç†ç”¨æˆ·è®¤è¯ã€è§’è‰²å®šä¹‰ã€æƒé™æ§åˆ¶ã€é¡µé¢è®¿é—®å’Œèœå•ç»‘å®šç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

é€šè¿‡æ ‡å‡†åŒ–çš„æƒé™ç®¡ç†æµç¨‹ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨æ€§ã€ç”¨æˆ·ä½“éªŒä¸€è‡´æ€§ï¼Œå¹¶ä¸ºåç»­åŠŸèƒ½æ‰©å±•æä¾›å¯é çš„æƒé™åŸºç¡€æ¶æ„ã€‚

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 ç”¨æˆ·ç®¡ç†è§„èŒƒ

#### 2.1.1 ç”¨æˆ·æ³¨å†Œæµç¨‹

**æ³¨å†Œæ–¹å¼ï¼š**
- æ‰‹æœºå·æ³¨å†Œï¼šç”¨æˆ·æä¾›æ‰‹æœºå·ï¼ˆå¿…å¡«ï¼‰ã€å¯†ç ã€çœŸå®å§“å
- é‚®ç®±æ³¨å†Œï¼šé‚®ç®±ä¸ºéå¿…å¡«é¡¹ï¼Œå¯é€‰æ‹©æ€§æä¾›
- è§’è‰²é€‰æ‹©ï¼šç”¨æˆ·è§’è‰²ä¸ºå¿…é€‰é¡¹ï¼Œæ–°æ³¨å†Œç”¨æˆ·é»˜è®¤ä¸º `student` è§’è‰²
- éªŒè¯æœºåˆ¶ï¼šæ‰‹æœºå·éªŒè¯ï¼ˆå¿…éœ€ï¼‰ã€é‚®ç®±éªŒè¯ï¼ˆå¯é€‰ï¼‰

**ç™»å½•æ–¹å¼ï¼š**
- æ”¯æŒç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±ä»»ä¸€æ–¹å¼ç™»å½•
- æ‰‹æœºå·ä½œä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†
- å¯†ç ç»Ÿä¸€éªŒè¯

**æ•°æ®ç»“æ„ï¼š**
```javascript
const UserProfile = {
  id: 'string',           // ç”¨æˆ·å”¯ä¸€æ ‡è¯†
  username: 'string',     // ç”¨æˆ·å
  phone: 'string',        // æ‰‹æœºå·ï¼ˆå¿…å¡«ï¼Œå”¯ä¸€æ ‡è¯†ï¼‰
  email: 'string',        // é‚®ç®±åœ°å€ï¼ˆå¯é€‰ï¼‰
  real_name: 'string',    // çœŸå®å§“å
  role: 'string',         // ç”¨æˆ·è§’è‰²ï¼ˆå¿…é€‰ï¼‰
  avatar: 'string',       // å¤´åƒURL
  created_at: 'datetime', // åˆ›å»ºæ—¶é—´
  updated_at: 'datetime', // æ›´æ–°æ—¶é—´
  is_active: 'boolean',   // è´¦æˆ·çŠ¶æ€
  last_login: 'datetime', // æœ€åç™»å½•æ—¶é—´
  phone_verified: 'boolean', // æ‰‹æœºå·éªŒè¯çŠ¶æ€
  email_verified: 'boolean'  // é‚®ç®±éªŒè¯çŠ¶æ€
}
```

#### 2.1.2 ç”¨æˆ·è®¤è¯æœºåˆ¶

**è®¤è¯æ–¹å¼ï¼š**
- Tokenè®¤è¯ï¼šåŸºäºJWTæˆ–ç±»ä¼¼tokenæœºåˆ¶
- ä¼šè¯ç®¡ç†ï¼šå‰ç«¯localStorageå­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œtoken
- è‡ªåŠ¨åŒæ­¥ï¼šå‰åç«¯è®¤è¯çŠ¶æ€è‡ªåŠ¨åŒæ­¥

**è®¤è¯çŠ¶æ€ç®¡ç†ï¼š**
```javascript
// è®¤è¯çŠ¶æ€æ£€æŸ¥
export async function isAuthenticated() {
  const token = localStorage.getItem('token')
  const user = getCurrentUser()
  
  // å‰ç«¯æœ‰å®Œæ•´ç™»å½•ä¿¡æ¯
  if (token && user) return true
  
  // åŒæ­¥åç«¯çŠ¶æ€
  return await syncAuthState()
}

// è·å–å½“å‰ç”¨æˆ·
export function getCurrentUser() {
  const userStr = localStorage.getItem('user')
  if (!userStr) return null
  
  try {
    const user = JSON.parse(userStr)
    return user && user.role ? user : null
  } catch (error) {
    console.error('ç”¨æˆ·ä¿¡æ¯è§£æå¤±è´¥:', error)
    return null
  }
}
```

### 2.2 è§’è‰²å®šä¹‰è§„èŒƒ

#### 2.2.1 è§’è‰²å±‚æ¬¡ç»“æ„

æˆ‘ä»¬çš„ç³»ç»Ÿå®šä¹‰äº†7ç§ç”¨æˆ·è§’è‰²ï¼ŒæŒ‰æƒé™çº§åˆ«ä»é«˜åˆ°ä½æ’åˆ—ï¼š

| è§’è‰²ä»£ç  | è§’è‰²åç§° | æƒé™çº§åˆ« | ä¸»è¦èŒè´£ |
|----------|----------|----------|----------|
| admin | ç®¡ç†å‘˜ | æœ€é«˜ | ç³»ç»Ÿç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€å…¨åŠŸèƒ½è®¿é—® |
| dean | æ•™å¯¼ä¸»ä»» | é«˜ | æ•™å­¦ç®¡ç†ã€å­¦æœ¯ç®¡ç†ã€æ•°æ®åˆ†æ |
| academic_director | æ•™åŠ¡ä¸»ä»» | é«˜ | è¯¾ç¨‹ç®¡ç†ã€æ•™å­¦ç®¡ç†ã€å­¦æœ¯æŠ¥å‘Š |
| research_leader | æ•™ç ”ç»„é•¿ | ä¸­é«˜ | æ•™ç ”ç®¡ç†ã€æ•™å­¦æ–¹æ³•ã€ç ”ç©¶æŠ¥å‘Š |
| teacher | è‡ªç”±è€å¸ˆ | ä¸­ | æ•™å­¦åŠŸèƒ½ã€å­¦ç”Ÿç®¡ç†ã€èµ„æºç®¡ç† |
| parent | å®¶é•¿ | ä½ | æŸ¥çœ‹å­å¥³ä¿¡æ¯ã€è¿›åº¦è·Ÿè¸ªã€æ²Ÿé€š |
| student | å­¦ç”Ÿ | åŸºç¡€ | å­¦ä¹ åŠŸèƒ½ã€ä¸ªäººèµ„æ–™ã€åŸºç¡€æ“ä½œ |

#### 2.2.2 è§’è‰²æ˜¾ç¤ºåç§°æ˜ å°„

```javascript
export function getRoleDisplayName(role) {
  const roleNames = {
    'admin': 'ç®¡ç†å‘˜',
    'dean': 'æ•™å¯¼ä¸»ä»»',
    'academic_director': 'æ•™åŠ¡ä¸»ä»»',
    'research_leader': 'æ•™ç ”ç»„é•¿',
    'teacher': 'è‡ªç”±è€å¸ˆ',
    'parent': 'å®¶é•¿',
    'student': 'å­¦ç”Ÿ'
  }
  return roleNames[role] || role
}
```

### 2.3 æƒé™ç®¡ç†è§„èŒƒ

#### 2.3.1 æƒé™åˆ†ç±»ä½“ç³»

**åŸºç¡€æƒé™ï¼š**
- `view_dashboard` - æŸ¥çœ‹ä»ªè¡¨æ¿
- `view_own_profile` - æŸ¥çœ‹ä¸ªäººèµ„æ–™
- `change_own_settings` - ä¿®æ”¹ä¸ªäººè®¾ç½®
- `view_help` - æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£

**å­¦ä¹ åŠŸèƒ½æƒé™ï¼š**
- `view_word_learning` - å•è¯å­¦ä¹ åŠŸèƒ½
- `practice_spelling` - æ‹¼å†™ç»ƒä¹ 
- `use_flashcard` - ä½¿ç”¨é—ªå¡
- `practice_reading` - é˜…è¯»ç»ƒä¹ 
- `practice_listening` - å¬åŠ›ç»ƒä¹ 
- `participate_challenge` - å‚ä¸æŒ‘æˆ˜
- `review_words` - å•è¯å¤ä¹ 

**ç®¡ç†åŠŸèƒ½æƒé™ï¼š**
- `manage_users` - ç”¨æˆ·ç®¡ç†
- `manage_academic` - å­¦æœ¯ç®¡ç†
- `manage_teaching` - æ•™å­¦ç®¡ç†
- `manage_research` - æ•™ç ”ç®¡ç†
- `view_analytics` - æ•°æ®åˆ†æ
- `access_dev_tools` - å¼€å‘å·¥å…·è®¿é—®

#### 2.3.2 è§’è‰²æƒé™æ˜ å°„è¡¨

```javascript
const ROLE_PERMISSIONS = {
  'admin': ['*'], // ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™
  
  'dean': [
    'view_dashboard', 'view_own_profile', 'change_own_settings', 'view_help',
    'view_word_learning', 'practice_spelling', 'use_flashcard', 'practice_reading',
    'view_word_detail', 'view_word_examples', 'practice_story_reading', 'practice_listening',
    'participate_challenge', 'practice_word_selection', 'review_words',
    'analyze_word_roots', 'use_pattern_memory', 'access_community', 'access_fashion_content',
    'discover_content', 'access_dev_tools', 'view_analytics', 'manage_resource_auth',
    'manage_subscriptions', 'share_resources', 'manage_academic', 'manage_teaching',
    'view_reports', 'manage_users'
  ],
  
  'academic_director': [
    'view_dashboard', 'view_own_profile', 'change_own_settings', 'view_help',
    'view_word_learning', 'practice_spelling', 'use_flashcard', 'practice_reading',
    'view_word_detail', 'view_word_examples', 'practice_story_reading', 'practice_listening',
    'participate_challenge', 'practice_word_selection', 'review_words',
    'analyze_word_roots', 'use_pattern_memory', 'access_community', 'access_fashion_content',
    'discover_content', 'access_dev_tools', 'view_analytics', 'manage_resource_auth',
    'manage_subscriptions', 'share_resources', 'manage_curriculum', 'manage_teaching',
    'view_academic_reports'
  ],
  
  'research_leader': [
    'view_dashboard', 'view_own_profile', 'change_own_settings', 'view_help',
    'view_word_learning', 'practice_spelling', 'use_flashcard', 'practice_reading',
    'view_word_detail', 'view_word_examples', 'practice_story_reading', 'practice_listening',
    'participate_challenge', 'practice_word_selection', 'review_words',
    'analyze_word_roots', 'use_pattern_memory', 'access_community', 'access_fashion_content',
    'discover_content', 'access_dev_tools', 'view_analytics', 'manage_resource_auth',
    'manage_subscriptions', 'share_resources', 'manage_research', 'manage_teaching_methods',
    'view_research_reports'
  ],
  
  'teacher': [
    'view_dashboard', 'view_own_profile', 'change_own_settings', 'view_help',
    'view_word_learning', 'practice_spelling', 'use_flashcard', 'practice_reading',
    'view_word_detail', 'view_word_examples', 'practice_story_reading', 'practice_listening',
    'participate_challenge', 'practice_word_selection', 'review_words',
    'analyze_word_roots', 'use_pattern_memory', 'access_community', 'access_fashion_content',
    'discover_content', 'access_dev_tools', 'view_analytics', 'manage_resource_auth',
    'manage_subscriptions', 'share_resources', 'manage_teaching', 'view_student',
    'change_student'
  ],
  
  'parent': [
    'view_dashboard', 'view_own_profile', 'change_own_settings', 'view_help',
    'view_student', 'view_own_children', 'view_child_progress', 'view_child_reports',
    'communicate_with_teacher'
  ],
  
  'student': [
    'view_dashboard', 'view_own_profile', 'change_own_settings', 'view_help',
    'view_word_learning', 'practice_spelling', 'use_flashcard', 'practice_reading',
    'view_word_detail', 'view_word_examples', 'practice_story_reading', 'practice_listening',
    'participate_challenge', 'practice_word_selection', 'review_words',
    'analyze_word_roots', 'use_pattern_memory', 'access_community', 'access_fashion_content',
    'discover_content', 'change_own_profile'
  ]
}
```

#### 2.3.3 æƒé™æ£€æŸ¥å‡½æ•°

```javascript
/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šæƒé™
 * @param {string} userRole - ç”¨æˆ·è§’è‰²
 * @param {string} permission - æƒé™åç§°
 * @returns {boolean} æ˜¯å¦æ‹¥æœ‰æƒé™
 */
export function hasPermission(userRole, permission) {
  if (!userRole || !permission) return false
  
  const permissions = ROLE_PERMISSIONS[userRole] || []
  return permissions.includes('*') || permissions.includes(permission)
}
```

### 2.4 é¡µé¢è®¿é—®æ§åˆ¶è§„èŒƒ

#### 2.4.1 é¡µé¢æƒé™æ˜ å°„è¡¨

```javascript
const PAGE_PERMISSIONS = {
  '/': 'view_word_learning',
  '/dashboard': 'view_dashboard',
  '/profile': 'view_own_profile',
  '/settings': 'change_own_settings',
  '/help': 'view_help',
  '/word-learning': 'view_word_learning',
  '/word-learning/spelling': 'practice_spelling',
  '/word-learning/flashcard': 'use_flashcard',
  '/word-reading': 'practice_reading',
  '/word-detail': 'view_word_detail',
  '/word-examples': 'view_word_examples',
  '/story-reading': 'practice_story_reading',
  '/listening': 'practice_listening',
  '/word-challenge': 'participate_challenge',
  '/word-selection': 'practice_word_selection',
  '/word-review': 'review_words',
  '/word-root-analysis': 'analyze_word_roots',
  '/pattern-memory': 'use_pattern_memory',
  '/community': 'access_community',
  '/fashion': 'access_fashion_content',
  '/dev': 'access_dev_tools',
  '/dev-index': 'access_dev_tools',
  '/admin/dev-index': 'access_dev_tools',
  '/analytics': 'view_analytics',
  '/resource-auth': 'manage_resource_auth',
  '/subscription-management': 'manage_subscriptions',
  '/resource-sharing': 'share_resources',
  '/learning-modes': 'view_word_learning',
  '/competition': 'participate_challenge',
  '/quick-brush': 'review_words',
  '/discover': 'discover_content'
}
```

#### 2.4.2 é¡µé¢è®¿é—®æ£€æŸ¥å‡½æ•°

```javascript
/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®æŒ‡å®šé¡µé¢
 * @param {string} userRole - ç”¨æˆ·è§’è‰²
 * @param {string} path - é¡µé¢è·¯å¾„
 * @returns {boolean} æ˜¯å¦å¯ä»¥è®¿é—®
 */
export function canAccessPage(userRole, path) {
  // å¤„ç†åŠ¨æ€è·¯ç”±å‚æ•°
  const normalizedPath = path.replace(/\/\d+$/, '').replace(/\/[^/]*$/, '')
  const permission = PAGE_PERMISSIONS[normalizedPath] || PAGE_PERMISSIONS[path]
  
  if (!permission) {
    // å¦‚æœé¡µé¢æ²¡æœ‰å®šä¹‰æƒé™è¦æ±‚ï¼Œé»˜è®¤å…è®¸è®¿é—®
    return true
  }
  
  return hasPermission(userRole, permission)
}
```

#### 2.4.3 è·¯ç”±å®ˆå«å®ç°

```javascript
/**
 * è·¯ç”±æƒé™æ£€æŸ¥å‡½æ•°
 * @param {Object} to - ç›®æ ‡è·¯ç”±
 * @param {Object} from - æ¥æºè·¯ç”±
 * @param {Function} next - è·¯ç”±ç»§ç»­å‡½æ•°
 */
export async function checkRoutePermission(to, from, next) {
  const authenticated = await isAuthenticated()
  const user = getCurrentUser()
  
  // å¦‚æœè·¯ç”±éœ€è¦è®¤è¯ä½†ç”¨æˆ·æœªç™»å½•
  if (to.meta.requiresAuth && !authenticated) {
    next('/login')
    return
  }
  
  // å¦‚æœç”¨æˆ·å·²ç™»å½•ä½†è®¿é—®ç™»å½•é¡µï¼Œé‡å®šå‘åˆ°é¦–é¡µ
  if (authenticated && to.path === '/login') {
    next('/')
    return
  }
  
  // æ£€æŸ¥é¡µé¢æƒé™
  if (user && !canAccessPage(user.role, to.path)) {
    console.warn(`ç”¨æˆ· ${user.username}(${user.role}) æ— æƒè®¿é—®é¡µé¢ ${to.path}`)
    
    // å¯¹äºå…³é”®é¡µé¢ï¼Œé‡å®šå‘åˆ°é¦–é¡µè€Œä¸æ˜¯é”™è¯¯é¡µ
    const criticalPages = ['/learning-modes', '/learning-mode', '/dashboard']
    if (criticalPages.includes(to.path)) {
      next('/')
      return
    }
    
    next({
      path: '/error',
      query: {
        type: 'permission',
        message: `æ‚¨çš„è§’è‰²(${user.role})æ— æƒè®¿é—®æ­¤é¡µé¢`
      }
    })
    return
  }
  
  next()
}
```

### 2.5 è§’è‰²æƒé™å®Œæ•´æ˜ å°„è¡¨

#### 2.5.1 è§’è‰²-é¡µé¢-æƒé™æ˜ å°„è¡¨

| è§’è‰² | å¯è®¿é—®é¡µé¢ | é¡µé¢è·¯å¾„ | æ‰€éœ€æƒé™ | æƒé™åˆ†ç±» |
|------|------------|----------|----------|----------|
| **admin** | æ‰€æœ‰é¡µé¢ | /* | * | å…¨éƒ¨æƒé™ |
| **dean** | ä»ªè¡¨æ¿ | /dashboard | view_dashboard | åŸºç¡€æƒé™ |
| | ä¸ªäººèµ„æ–™ | /profile | view_own_profile | åŸºç¡€æƒé™ |
| | è®¾ç½® | /settings | change_own_settings | åŸºç¡€æƒé™ |
| | å¸®åŠ© | /help | view_help | åŸºç¡€æƒé™ |
| | å•è¯å­¦ä¹  | /word-learning | view_word_learning | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ‹¼å†™ç»ƒä¹  | /word-learning/spelling | practice_spelling | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é—ªå¡ç»ƒä¹  | /word-learning/flashcard | use_flashcard | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é˜…è¯»ç»ƒä¹  | /word-reading | practice_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯è¯¦æƒ… | /word-detail | view_word_detail | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯ä¾‹å¥ | /word-examples | view_word_examples | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ•…äº‹é˜…è¯» | /story-reading | practice_story_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å¬åŠ›ç»ƒä¹  | /listening | practice_listening | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯æŒ‘æˆ˜ | /word-challenge | participate_challenge | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯é€‰æ‹© | /word-selection | practice_word_selection | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯å¤ä¹  | /word-review | review_words | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | è¯æ ¹åˆ†æ | /word-root-analysis | analyze_word_roots | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ¨¡å¼è®°å¿† | /pattern-memory | use_pattern_memory | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å­¦ä¹ ç¤¾åŒº | /community | access_community | ç¤¾äº¤åŠŸèƒ½æƒé™ |
| | æ—¶å°šå†…å®¹ | /fashion | access_fashion_content | å†…å®¹æƒé™ |
| | å†…å®¹å‘ç° | /discover | discover_content | å†…å®¹æƒé™ |
| | å¼€å‘å·¥å…· | /dev-index | access_dev_tools | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•°æ®åˆ†æ | /analytics | view_analytics | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºç®¡ç† | /resource-auth | manage_resource_auth | ç®¡ç†åŠŸèƒ½æƒé™ |
| | è®¢é˜…ç®¡ç† | /subscription-management | manage_subscriptions | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºåˆ†äº« | /resource-sharing | share_resources | ç®¡ç†åŠŸèƒ½æƒé™ |
| | å­¦æœ¯ç®¡ç† | - | manage_academic | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•™å­¦ç®¡ç† | - | manage_teaching | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æŠ¥å‘ŠæŸ¥çœ‹ | - | view_reports | ç®¡ç†åŠŸèƒ½æƒé™ |
| | ç”¨æˆ·ç®¡ç† | - | manage_users | ç®¡ç†åŠŸèƒ½æƒé™ |
| **academic_director** | ä»ªè¡¨æ¿ | /dashboard | view_dashboard | åŸºç¡€æƒé™ |
| | ä¸ªäººèµ„æ–™ | /profile | view_own_profile | åŸºç¡€æƒé™ |
| | è®¾ç½® | /settings | change_own_settings | åŸºç¡€æƒé™ |
| | å¸®åŠ© | /help | view_help | åŸºç¡€æƒé™ |
| | å•è¯å­¦ä¹  | /word-learning | view_word_learning | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ‹¼å†™ç»ƒä¹  | /word-learning/spelling | practice_spelling | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é—ªå¡ç»ƒä¹  | /word-learning/flashcard | use_flashcard | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é˜…è¯»ç»ƒä¹  | /word-reading | practice_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯è¯¦æƒ… | /word-detail | view_word_detail | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯ä¾‹å¥ | /word-examples | view_word_examples | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ•…äº‹é˜…è¯» | /story-reading | practice_story_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å¬åŠ›ç»ƒä¹  | /listening | practice_listening | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯æŒ‘æˆ˜ | /word-challenge | participate_challenge | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯é€‰æ‹© | /word-selection | practice_word_selection | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯å¤ä¹  | /word-review | review_words | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | è¯æ ¹åˆ†æ | /word-root-analysis | analyze_word_roots | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ¨¡å¼è®°å¿† | /pattern-memory | use_pattern_memory | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å­¦ä¹ ç¤¾åŒº | /community | access_community | ç¤¾äº¤åŠŸèƒ½æƒé™ |
| | æ—¶å°šå†…å®¹ | /fashion | access_fashion_content | å†…å®¹æƒé™ |
| | å†…å®¹å‘ç° | /discover | discover_content | å†…å®¹æƒé™ |
| | å¼€å‘å·¥å…· | /dev-index | access_dev_tools | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•°æ®åˆ†æ | /analytics | view_analytics | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºç®¡ç† | /resource-auth | manage_resource_auth | ç®¡ç†åŠŸèƒ½æƒé™ |
| | è®¢é˜…ç®¡ç† | /subscription-management | manage_subscriptions | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºåˆ†äº« | /resource-sharing | share_resources | ç®¡ç†åŠŸèƒ½æƒé™ |
| | è¯¾ç¨‹ç®¡ç† | - | manage_curriculum | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•™å­¦ç®¡ç† | - | manage_teaching | ç®¡ç†åŠŸèƒ½æƒé™ |
| | å­¦æœ¯æŠ¥å‘Š | - | view_academic_reports | ç®¡ç†åŠŸèƒ½æƒé™ |
| **research_leader** | ä»ªè¡¨æ¿ | /dashboard | view_dashboard | åŸºç¡€æƒé™ |
| | ä¸ªäººèµ„æ–™ | /profile | view_own_profile | åŸºç¡€æƒé™ |
| | è®¾ç½® | /settings | change_own_settings | åŸºç¡€æƒé™ |
| | å¸®åŠ© | /help | view_help | åŸºç¡€æƒé™ |
| | å•è¯å­¦ä¹  | /word-learning | view_word_learning | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ‹¼å†™ç»ƒä¹  | /word-learning/spelling | practice_spelling | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é—ªå¡ç»ƒä¹  | /word-learning/flashcard | use_flashcard | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é˜…è¯»ç»ƒä¹  | /word-reading | practice_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯è¯¦æƒ… | /word-detail | view_word_detail | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯ä¾‹å¥ | /word-examples | view_word_examples | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ•…äº‹é˜…è¯» | /story-reading | practice_story_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å¬åŠ›ç»ƒä¹  | /listening | practice_listening | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯æŒ‘æˆ˜ | /word-challenge | participate_challenge | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯é€‰æ‹© | /word-selection | practice_word_selection | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯å¤ä¹  | /word-review | review_words | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | è¯æ ¹åˆ†æ | /word-root-analysis | analyze_word_roots | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ¨¡å¼è®°å¿† | /pattern-memory | use_pattern_memory | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å­¦ä¹ ç¤¾åŒº | /community | access_community | ç¤¾äº¤åŠŸèƒ½æƒé™ |
| | æ—¶å°šå†…å®¹ | /fashion | access_fashion_content | å†…å®¹æƒé™ |
| | å†…å®¹å‘ç° | /discover | discover_content | å†…å®¹æƒé™ |
| | å¼€å‘å·¥å…· | /dev-index | access_dev_tools | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•°æ®åˆ†æ | /analytics | view_analytics | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºç®¡ç† | /resource-auth | manage_resource_auth | ç®¡ç†åŠŸèƒ½æƒé™ |
| | è®¢é˜…ç®¡ç† | /subscription-management | manage_subscriptions | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºåˆ†äº« | /resource-sharing | share_resources | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•™ç ”ç®¡ç† | - | manage_research | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•™å­¦æ–¹æ³• | - | manage_teaching_methods | ç®¡ç†åŠŸèƒ½æƒé™ |
| | ç ”ç©¶æŠ¥å‘Š | - | view_research_reports | ç®¡ç†åŠŸèƒ½æƒé™ |
| **teacher** | ä»ªè¡¨æ¿ | /dashboard | view_dashboard | åŸºç¡€æƒé™ |
| | ä¸ªäººèµ„æ–™ | /profile | view_own_profile | åŸºç¡€æƒé™ |
| | è®¾ç½® | /settings | change_own_settings | åŸºç¡€æƒé™ |
| | å¸®åŠ© | /help | view_help | åŸºç¡€æƒé™ |
| | å•è¯å­¦ä¹  | /word-learning | view_word_learning | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ‹¼å†™ç»ƒä¹  | /word-learning/spelling | practice_spelling | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é—ªå¡ç»ƒä¹  | /word-learning/flashcard | use_flashcard | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é˜…è¯»ç»ƒä¹  | /word-reading | practice_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯è¯¦æƒ… | /word-detail | view_word_detail | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯ä¾‹å¥ | /word-examples | view_word_examples | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ•…äº‹é˜…è¯» | /story-reading | practice_story_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å¬åŠ›ç»ƒä¹  | /listening | practice_listening | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯æŒ‘æˆ˜ | /word-challenge | participate_challenge | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯é€‰æ‹© | /word-selection | practice_word_selection | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯å¤ä¹  | /word-review | review_words | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | è¯æ ¹åˆ†æ | /word-root-analysis | analyze_word_roots | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ¨¡å¼è®°å¿† | /pattern-memory | use_pattern_memory | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å­¦ä¹ ç¤¾åŒº | /community | access_community | ç¤¾äº¤åŠŸèƒ½æƒé™ |
| | æ—¶å°šå†…å®¹ | /fashion | access_fashion_content | å†…å®¹æƒé™ |
| | å†…å®¹å‘ç° | /discover | discover_content | å†…å®¹æƒé™ |
| | å¼€å‘å·¥å…· | /dev-index | access_dev_tools | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•°æ®åˆ†æ | /analytics | view_analytics | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºç®¡ç† | /resource-auth | manage_resource_auth | ç®¡ç†åŠŸèƒ½æƒé™ |
| | è®¢é˜…ç®¡ç† | /subscription-management | manage_subscriptions | ç®¡ç†åŠŸèƒ½æƒé™ |
| | èµ„æºåˆ†äº« | /resource-sharing | share_resources | ç®¡ç†åŠŸèƒ½æƒé™ |
| | æ•™å­¦ç®¡ç† | - | manage_teaching | ç®¡ç†åŠŸèƒ½æƒé™ |
| | å­¦ç”ŸæŸ¥çœ‹ | - | view_student | ç®¡ç†åŠŸèƒ½æƒé™ |
| | å­¦ç”Ÿç®¡ç† | - | change_student | ç®¡ç†åŠŸèƒ½æƒé™ |
| **parent** | ä»ªè¡¨æ¿ | /dashboard | view_dashboard | åŸºç¡€æƒé™ |
| | ä¸ªäººèµ„æ–™ | /profile | view_own_profile | åŸºç¡€æƒé™ |
| | è®¾ç½® | /settings | change_own_settings | åŸºç¡€æƒé™ |
| | å¸®åŠ© | /help | view_help | åŸºç¡€æƒé™ |
| | å­¦ç”Ÿä¿¡æ¯ | - | view_student | å®¶é•¿ä¸“ç”¨æƒé™ |
| | å­å¥³ä¿¡æ¯ | - | view_own_children | å®¶é•¿ä¸“ç”¨æƒé™ |
| | å­å¥³è¿›åº¦ | - | view_child_progress | å®¶é•¿ä¸“ç”¨æƒé™ |
| | å­å¥³æŠ¥å‘Š | - | view_child_reports | å®¶é•¿ä¸“ç”¨æƒé™ |
| | æ•™å¸ˆæ²Ÿé€š | - | communicate_with_teacher | å®¶é•¿ä¸“ç”¨æƒé™ |
| **student** | ä»ªè¡¨æ¿ | /dashboard | view_dashboard | åŸºç¡€æƒé™ |
| | ä¸ªäººèµ„æ–™ | /profile | view_own_profile | åŸºç¡€æƒé™ |
| | è®¾ç½® | /settings | change_own_settings | åŸºç¡€æƒé™ |
| | å¸®åŠ© | /help | view_help | åŸºç¡€æƒé™ |
| | å•è¯å­¦ä¹  | /word-learning | view_word_learning | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ‹¼å†™ç»ƒä¹  | /word-learning/spelling | practice_spelling | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é—ªå¡ç»ƒä¹  | /word-learning/flashcard | use_flashcard | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | é˜…è¯»ç»ƒä¹  | /word-reading | practice_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯è¯¦æƒ… | /word-detail | view_word_detail | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯ä¾‹å¥ | /word-examples | view_word_examples | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ•…äº‹é˜…è¯» | /story-reading | practice_story_reading | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å¬åŠ›ç»ƒä¹  | /listening | practice_listening | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯æŒ‘æˆ˜ | /word-challenge | participate_challenge | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯é€‰æ‹© | /word-selection | practice_word_selection | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å•è¯å¤ä¹  | /word-review | review_words | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | è¯æ ¹åˆ†æ | /word-root-analysis | analyze_word_roots | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | æ¨¡å¼è®°å¿† | /pattern-memory | use_pattern_memory | å­¦ä¹ åŠŸèƒ½æƒé™ |
| | å­¦ä¹ ç¤¾åŒº | /community | access_community | ç¤¾äº¤åŠŸèƒ½æƒé™ |
| | æ—¶å°šå†…å®¹ | /fashion | access_fashion_content | å†…å®¹æƒé™ |
| | å†…å®¹å‘ç° | /discover | discover_content | å†…å®¹æƒé™ |
| | ä¸ªäººèµ„æ–™ç¼–è¾‘ | - | change_own_profile | åŸºç¡€æƒé™ |

#### 2.5.2 æƒé™åˆ†ç±»ç»Ÿè®¡è¡¨

| æƒé™åˆ†ç±» | æƒé™æ•°é‡ | ä¸»è¦æƒé™é¡¹ |
|----------|----------|------------|
| åŸºç¡€æƒé™ | 4 | view_dashboard, view_own_profile, change_own_settings, view_help |
| å­¦ä¹ åŠŸèƒ½æƒé™ | 14 | view_word_learning, practice_spelling, use_flashcard, practice_reading, view_word_detail, view_word_examples, practice_story_reading, practice_listening, participate_challenge, practice_word_selection, review_words, analyze_word_roots, use_pattern_memory, change_own_profile |
| ç¤¾äº¤åŠŸèƒ½æƒé™ | 1 | access_community |
| å†…å®¹æƒé™ | 2 | access_fashion_content, discover_content |
| ç®¡ç†åŠŸèƒ½æƒé™ | 15 | access_dev_tools, view_analytics, manage_resource_auth, manage_subscriptions, share_resources, manage_academic, manage_teaching, view_reports, manage_users, manage_curriculum, view_academic_reports, manage_research, manage_teaching_methods, view_research_reports, view_student, change_student |
| å®¶é•¿ä¸“ç”¨æƒé™ | 5 | view_student, view_own_children, view_child_progress, view_child_reports, communicate_with_teacher |

### 2.6 æƒé™åˆ†ç±»ä¼˜åŒ–æ–¹æ¡ˆ

#### 2.6.1 ç°æœ‰æƒé™åˆ†ç±»é—®é¢˜åˆ†æ

**å½“å‰é—®é¢˜ï¼š**
1. **æƒé™ç²’åº¦ä¸ä¸€è‡´**ï¼šå­¦ä¹ åŠŸèƒ½æƒé™è¿‡äºç»†åˆ†ï¼Œè€Œç®¡ç†åŠŸèƒ½æƒé™ç›¸å¯¹ç²—ç³™
2. **æƒé™ç»§æ‰¿ç¼ºå¤±**ï¼šè§’è‰²é—´ç¼ºä¹æ˜ç¡®çš„æƒé™ç»§æ‰¿å…³ç³»ï¼Œå¯¼è‡´é‡å¤å®šä¹‰
3. **æƒé™å‘½åä¸è§„èŒƒ**ï¼šæƒé™å‘½åç¼ºä¹ç»Ÿä¸€æ ‡å‡†ï¼Œéš¾ä»¥ç»´æŠ¤
4. **åŠ¨æ€æƒé™æ”¯æŒä¸è¶³**ï¼šæ— æ³•æ ¹æ®ç”¨æˆ·çŠ¶æ€åŠ¨æ€è°ƒæ•´æƒé™
5. **æƒé™åˆ†ç»„ä¸åˆç†**ï¼šéƒ¨åˆ†æƒé™åˆ†ç±»è¾¹ç•Œæ¨¡ç³Šï¼Œå­˜åœ¨äº¤å‰

#### 2.6.2 ä¼˜åŒ–æƒé™åˆ†ç±»ä½“ç³»

**æ–°æƒé™åˆ†ç±»æ¶æ„ï¼š**

| ä¸€çº§åˆ†ç±» | äºŒçº§åˆ†ç±» | æƒé™ç²’åº¦ | é€‚ç”¨è§’è‰² | ç»§æ‰¿å…³ç³» |
|----------|----------|----------|----------|----------|
| **ç³»ç»Ÿæƒé™** | åŸºç¡€è®¿é—®æƒé™ | ç²—ç²’åº¦ | æ‰€æœ‰è§’è‰² | åŸºç¡€ç»§æ‰¿ |
| | è®¤è¯æƒé™ | ä¸­ç²’åº¦ | è®¤è¯ç”¨æˆ· | åŸºç¡€ç»§æ‰¿ |
| **å­¦ä¹ æƒé™** | å†…å®¹è®¿é—®æƒé™ | ä¸­ç²’åº¦ | student+ | è§’è‰²ç»§æ‰¿ |
| | å­¦ä¹ å·¥å…·æƒé™ | ç»†ç²’åº¦ | student+ | è§’è‰²ç»§æ‰¿ |
| | è¿›åº¦ç®¡ç†æƒé™ | ä¸­ç²’åº¦ | student+ | è§’è‰²ç»§æ‰¿ |
| **æ•™å­¦æƒé™** | å­¦ç”Ÿç®¡ç†æƒé™ | ä¸­ç²’åº¦ | teacher+ | è§’è‰²ç»§æ‰¿ |
| | è¯¾ç¨‹ç®¡ç†æƒé™ | ä¸­ç²’åº¦ | teacher+ | è§’è‰²ç»§æ‰¿ |
| | æ•™å­¦å·¥å…·æƒé™ | ç»†ç²’åº¦ | teacher+ | è§’è‰²ç»§æ‰¿ |
| **ç®¡ç†æƒé™** | ç”¨æˆ·ç®¡ç†æƒé™ | ä¸­ç²’åº¦ | admin+ | ç®¡ç†ç»§æ‰¿ |
| | ç³»ç»Ÿç®¡ç†æƒé™ | ç²—ç²’åº¦ | admin+ | ç®¡ç†ç»§æ‰¿ |
| | æ•°æ®ç®¡ç†æƒé™ | ä¸­ç²’åº¦ | admin+ | ç®¡ç†ç»§æ‰¿ |
| **å®¶é•¿æƒé™** | å­å¥³ç›‘æŠ¤æƒé™ | ä¸­ç²’åº¦ | parent | ç‹¬ç«‹æƒé™ |
| | æ²Ÿé€šæƒé™ | ç»†ç²’åº¦ | parent | ç‹¬ç«‹æƒé™ |

#### 2.6.3 æƒé™ç»§æ‰¿æœºåˆ¶è®¾è®¡

**è§’è‰²ç»§æ‰¿å±‚æ¬¡ï¼š**
```mermaid
graph TD
    A[admin] --> B[dean]
    A --> C[academic_director]
    A --> D[research_leader]
    B --> E[teacher]
    C --> E
    D --> E
    E --> F[student]
    G[parent] --> H[åŸºç¡€æƒé™]
    F --> H
```

**ç»§æ‰¿è§„åˆ™ï¼š**
1. **å‘ä¸Šç»§æ‰¿**ï¼šé«˜çº§è§’è‰²è‡ªåŠ¨ç»§æ‰¿ä½çº§è§’è‰²çš„æ‰€æœ‰æƒé™
2. **æƒé™å åŠ **ï¼šåŒçº§è§’è‰²æƒé™å¯ä»¥å åŠ ï¼Œä¸å†²çª
3. **ç‰¹æ®Šæƒé™**ï¼šæŸäº›è§’è‰²æ‹¥æœ‰ç‹¬ç‰¹æƒé™ï¼ˆå¦‚parentçš„å®¶é•¿æƒé™ï¼‰
4. **æƒé™è¦†ç›–**ï¼šé«˜çº§è§’è‰²å¯ä»¥è¦†ç›–ä½çº§è§’è‰²çš„ç‰¹å®šæƒé™è®¾ç½®

#### 2.6.4 åŠ¨æ€æƒé™ç®¡ç†æ–¹æ¡ˆ

**åŠ¨æ€æƒé™è§¦å‘æ¡ä»¶ï¼š**

| è§¦å‘æ¡ä»¶ | æƒé™å˜åŒ– | å®ç°æ–¹å¼ | ç¤ºä¾‹ |
|----------|----------|----------|------|
| ç”¨æˆ·çŠ¶æ€å˜æ›´ | æƒé™å¯ç”¨/ç¦ç”¨ | çŠ¶æ€ç›‘å¬ | è´¦æˆ·å†»ç»“æ—¶ç¦ç”¨æ‰€æœ‰æƒé™ |
| è®¢é˜…çŠ¶æ€ | åŠŸèƒ½æƒé™è°ƒæ•´ | è®¢é˜…æ£€æŸ¥ | é«˜çº§åŠŸèƒ½éœ€è¦ä»˜è´¹è®¢é˜… |
| æ—¶é—´é™åˆ¶ | ä¸´æ—¶æƒé™æˆäºˆ | å®šæ—¶ä»»åŠ¡ | è¯•ç”¨æœŸæƒé™è‡ªåŠ¨åˆ°æœŸ |
| åœ°ç†ä½ç½® | åŒºåŸŸæƒé™é™åˆ¶ | IPæ£€æŸ¥ | æŸäº›åŠŸèƒ½ä»…é™ç‰¹å®šåœ°åŒº |
| è®¾å¤‡ç±»å‹ | å¹³å°æƒé™å·®å¼‚ | è®¾å¤‡æ£€æµ‹ | ç§»åŠ¨ç«¯åŠŸèƒ½å—é™ |

**åŠ¨æ€æƒé™å®ç°æ¶æ„ï¼š**
```javascript
// åŠ¨æ€æƒé™æ£€æŸ¥å™¨
class DynamicPermissionChecker {
  async checkPermission(user, permission, context) {
    // 1. åŸºç¡€è§’è‰²æƒé™æ£€æŸ¥
    const basePermission = this.checkRolePermission(user.role, permission);
    
    // 2. åŠ¨æ€æ¡ä»¶æ£€æŸ¥
    const dynamicChecks = await Promise.all([
      this.checkSubscriptionStatus(user, permission),
      this.checkTimeRestrictions(user, permission),
      this.checkLocationRestrictions(user, permission, context),
      this.checkDeviceRestrictions(user, permission, context)
    ]);
    
    // 3. ç»¼åˆåˆ¤æ–­
    return basePermission && dynamicChecks.every(check => check);
  }
}
```

#### 2.6.5 æƒé™ç²’åº¦ä¼˜åŒ–å»ºè®®

**ç²’åº¦ä¼˜åŒ–åŸåˆ™ï¼š**
1. **åŠŸèƒ½å¯¼å‘**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†æƒé™ï¼Œè€ŒéæŒ‰é¡µé¢
2. **æœ€å°æƒé™**ï¼šé»˜è®¤æœ€å°æƒé™ï¼ŒæŒ‰éœ€æˆäºˆ
3. **ç»„åˆæƒé™**ï¼šæ”¯æŒæƒé™ç»„åˆï¼Œå‡å°‘å•ä¸€æƒé™æ•°é‡
4. **ä¸Šä¸‹æ–‡ç›¸å…³**ï¼šè€ƒè™‘ä½¿ç”¨åœºæ™¯çš„æƒé™å·®å¼‚

**ä¼˜åŒ–åçš„æƒé™ç»“æ„ï¼š**
```javascript
// æƒé™ç»„åˆç¤ºä¾‹
const PERMISSION_GROUPS = {
  LEARNING_BASIC: [
    'view_word_learning',
    'practice_spelling',
    'use_flashcard',
    'practice_reading'
  ],
  LEARNING_ADVANCED: [
    'analyze_word_roots',
    'use_pattern_memory',
    'participate_challenge'
  ],
  TEACHING_BASIC: [
    'view_student',
    'manage_teaching'
  ],
  TEACHING_ADVANCED: [
    'change_student',
    'view_analytics',
    'manage_curriculum'
  ]
};
```

#### 2.6.6 å®æ–½æ­¥éª¤å’Œæœ€ä½³å®è·µ

**ç¬¬ä¸€é˜¶æ®µï¼šæƒé™é‡æ„ï¼ˆ1-2å‘¨ï¼‰**
1. é‡æ–°å®šä¹‰æƒé™åˆ†ç±»ä½“ç³»
2. å»ºç«‹æƒé™ç»§æ‰¿å…³ç³»
3. æ›´æ–°æƒé™å‘½åè§„èŒƒ
4. è¿ç§»ç°æœ‰æƒé™æ•°æ®

**ç¬¬äºŒé˜¶æ®µï¼šåŠ¨æ€æƒé™å®ç°ï¼ˆ2-3å‘¨ï¼‰**
1. å®ç°åŠ¨æ€æƒé™æ£€æŸ¥å™¨
2. é›†æˆè®¢é˜…çŠ¶æ€æ£€æŸ¥
3. æ·»åŠ æ—¶é—´å’Œåœ°ç†ä½ç½®é™åˆ¶
4. å®Œå–„æƒé™ç¼“å­˜æœºåˆ¶

**ç¬¬ä¸‰é˜¶æ®µï¼šæƒé™ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰**
1. å®ç°æƒé™ç»„åˆåŠŸèƒ½
2. ä¼˜åŒ–æƒé™æ£€æŸ¥æ€§èƒ½
3. æ·»åŠ æƒé™å®¡è®¡æ—¥å¿—
4. å®Œå–„æƒé™ç®¡ç†ç•Œé¢

**æœ€ä½³å®è·µå»ºè®®ï¼š**
1. **æƒé™ç¼“å­˜**ï¼šå®ç°å¤šå±‚æƒé™ç¼“å­˜ï¼Œæé«˜æ£€æŸ¥æ•ˆç‡
2. **æƒé™å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰æƒé™å˜æ›´å’Œæ£€æŸ¥æ—¥å¿—
3. **æƒé™æµ‹è¯•**ï¼šå»ºç«‹å®Œæ•´çš„æƒé™æµ‹è¯•ç”¨ä¾‹
4. **æƒé™æ–‡æ¡£**ï¼šç»´æŠ¤è¯¦ç»†çš„æƒé™è¯´æ˜æ–‡æ¡£
5. **æƒé™ç›‘æ§**ï¼šå®æ—¶ç›‘æ§æƒé™ä½¿ç”¨æƒ…å†µå’Œå¼‚å¸¸

### 2.7 èœå•ç»‘å®šè§„èŒƒ

#### 2.7.1 èœå•æƒé™è¿‡æ»¤

```javascript
/**
 * è·å–ç”¨æˆ·å¯è®¿é—®çš„èœå•é¡¹
 * @param {string} userRole - ç”¨æˆ·è§’è‰²
 * @returns {Array} å¯è®¿é—®çš„èœå•é¡¹
 */
export function getAccessibleMenus(userRole) {
  const allMenus = [
    {
      id: 'dashboard',
      title: 'ä»ªè¡¨æ¿',
      path: '/dashboard',
      icon: 'ğŸ“Š',
      permission: 'view_dashboard'
    },
    {
      id: 'word-learning',
      title: 'å•è¯å­¦ä¹ ',
      path: '/word-learning',
      icon: 'ğŸ“š',
      permission: 'view_word_learning'
    },
    {
      id: 'word-challenge',
      title: 'å•è¯æŒ‘æˆ˜',
      path: '/word-challenge',
      icon: 'ğŸ¯',
      permission: 'participate_challenge'
    },
    {
      id: 'word-review',
      title: 'å•è¯å¤ä¹ ',
      path: '/word-review',
      icon: 'ğŸ”„',
      permission: 'review_words'
    },
    {
      id: 'community',
      title: 'å­¦ä¹ ç¤¾åŒº',
      path: '/community',
      icon: 'ğŸ‘¥',
      permission: 'access_community'
    },
    {
      id: 'analytics',
      title: 'æ•°æ®åˆ†æ',
      path: '/analytics',
      icon: 'ğŸ“ˆ',
      permission: 'view_analytics'
    },
    {
      id: 'resource-auth',
      title: 'èµ„æºç®¡ç†',
      path: '/resource-auth',
      icon: 'ğŸ”',
      permission: 'manage_resource_auth'
    },
    {
      id: 'dev-index',
      title: 'å¼€å‘å·¥å…·',
      path: '/dev-index',
      icon: 'ğŸ› ï¸',
      permission: 'access_dev_tools'
    },
    {
      id: 'profile',
      title: 'ä¸ªäººèµ„æ–™',
      path: '/profile',
      icon: 'ğŸ‘¤',
      permission: 'view_own_profile'
    },
    {
      id: 'settings',
      title: 'è®¾ç½®',
      path: '/settings',
      icon: 'âš™ï¸',
      permission: 'change_own_settings'
    }
  ]
  
  return allMenus.filter(menu => hasPermission(userRole, menu.permission))
}
```

#### 2.5.2 åŠ¨æ€èœå•ç®¡ç†

```javascript
// åœ¨useMenuManager.jsä¸­å®ç°
export function useMenuManager() {
  const userInfo = ref(null)
  const userAuthState = ref(false)
  
  // æƒé™æ£€æŸ¥
  const checkPermission = async (permission) => {
    try {
      if (!isUserLoggedIn.value) return false
      
      const user = getCurrentUser()
      if (!user || !user.role) return false
      
      return await hasPermission(user.role, permission)
    } catch (error) {
      console.error('æƒé™æ£€æŸ¥å¤±è´¥:', error)
      return false
    }
  }
  
  // æ£€æŸ¥é¡µé¢æ˜¯å¦éœ€è¦è®¤è¯
  const requiresAuth = (path) => {
    const authRequiredPaths = [
      '/dashboard', '/profile', '/settings', '/word-learning',
      '/word-detail', '/word-root-analysis', '/story-reading',
      '/pattern-memory', '/resource-auth', '/subscription-management'
    ]
    return authRequiredPaths.includes(path)
  }
  
  return {
    userInfo,
    userAuthState,
    checkPermission,
    requiresAuth
  }
}
```

## 3. æ ¸å¿ƒæµç¨‹

### 3.1 ç”¨æˆ·è®¤è¯æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è®¿é—®é¡µé¢] --> B{æ˜¯å¦å·²ç™»å½•?}
    B -->|æ˜¯| C[æ£€æŸ¥tokenæœ‰æ•ˆæ€§]
    B -->|å¦| D[è·³è½¬ç™»å½•é¡µ]
    
    C --> E{tokenæœ‰æ•ˆ?}
    E -->|æ˜¯| F[è·å–ç”¨æˆ·ä¿¡æ¯]
    E -->|å¦| G[åŒæ­¥åç«¯çŠ¶æ€]
    
    G --> H{åç«¯è®¤è¯æˆåŠŸ?}
    H -->|æ˜¯| I[æ›´æ–°å‰ç«¯çŠ¶æ€]
    H -->|å¦| D
    
    F --> J[æƒé™æ£€æŸ¥]
    I --> J
    
    J --> K{æœ‰è®¿é—®æƒé™?}
    K -->|æ˜¯| L[å…è®¸è®¿é—®]
    K -->|å¦| M[è·³è½¬é”™è¯¯é¡µ]
    
    D --> N[ç”¨æˆ·ç™»å½•]
    N --> O{ç™»å½•æˆåŠŸ?}
    O -->|æ˜¯| P[å­˜å‚¨ç”¨æˆ·ä¿¡æ¯]
    O -->|å¦| Q[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    
    P --> R[è·³è½¬ç›®æ ‡é¡µé¢]
```

### 3.2 æƒé™æ£€æŸ¥æµç¨‹

```mermaid
graph TD
    A[æƒé™æ£€æŸ¥è¯·æ±‚] --> B[è·å–ç”¨æˆ·è§’è‰²]
    B --> C{è§’è‰²æ˜¯å¦ä¸ºadmin?}
    C -->|æ˜¯| D[å…è®¸æ‰€æœ‰æƒé™]
    C -->|å¦| E[æŸ¥æ‰¾è§’è‰²æƒé™åˆ—è¡¨]
    
    E --> F{æƒé™åœ¨åˆ—è¡¨ä¸­?}
    F -->|æ˜¯| G[æƒé™æ£€æŸ¥é€šè¿‡]
    F -->|å¦| H[æƒé™æ£€æŸ¥å¤±è´¥]
    
    G --> I[æ‰§è¡Œæ“ä½œ]
    H --> J[æ‹’ç»è®¿é—®]
```

### 3.3 èœå•æ¸²æŸ“æµç¨‹

```mermaid
graph TD
    A[èœå•ç»„ä»¶åˆå§‹åŒ–] --> B[è·å–ç”¨æˆ·ä¿¡æ¯]
    B --> C{ç”¨æˆ·å·²ç™»å½•?}
    C -->|å¦| D[æ˜¾ç¤ºåŸºç¡€èœå•]
    C -->|æ˜¯| E[è·å–ç”¨æˆ·è§’è‰²]
    
    E --> F[åŠ è½½å®Œæ•´èœå•é…ç½®]
    F --> G[éå†èœå•é¡¹]
    G --> H[æ£€æŸ¥èœå•é¡¹æƒé™]
    H --> I{æœ‰æƒé™?}
    I -->|æ˜¯| J[æ·»åŠ åˆ°å¯è§èœå•]
    I -->|å¦| K[è·³è¿‡è¯¥èœå•é¡¹]
    
    J --> L{è¿˜æœ‰èœå•é¡¹?}
    K --> L
    L -->|æ˜¯| G
    L -->|å¦| M[æ¸²æŸ“æœ€ç»ˆèœå•]
    
    D --> M
```

## 4. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 4.1 æƒé™ç›¸å…³UIç»„ä»¶

**æƒé™æŒ‡ä»¤ (v-permission)ï¼š**
```javascript
// æƒé™æŒ‡ä»¤å®ç°
const permissionDirective = {
  mounted(el, binding) {
    const user = getCurrentUser()
    const permission = binding.value
    
    if (!user || !hasPermission(user.role, permission)) {
      el.style.display = 'none'
    }
  },
  
  updated(el, binding) {
    const user = getCurrentUser()
    const permission = binding.value
    
    if (!user || !hasPermission(user.role, permission)) {
      el.style.display = 'none'
    } else {
      el.style.display = ''
    }
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```vue
<template>
  <!-- åªæœ‰ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°çš„æŒ‰é’® -->
  <button v-permission="'manage_users'">ç”¨æˆ·ç®¡ç†</button>
  
  <!-- åªæœ‰æ•™å¸ˆä»¥ä¸Šè§’è‰²å¯ä»¥çœ‹åˆ°çš„èœå• -->
  <div v-permission="'access_dev_tools'">å¼€å‘å·¥å…·</div>
</template>
```

### 4.2 é”™è¯¯é¡µé¢è®¾è®¡

**æƒé™ä¸è¶³é¡µé¢ï¼š**
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯æç¤º
- å½“å‰ç”¨æˆ·è§’è‰²æ˜¾ç¤º
- è¿”å›é¦–é¡µæˆ–ç™»å½•çš„æ“ä½œæŒ‰é’®
- è”ç³»ç®¡ç†å‘˜çš„å¼•å¯¼ä¿¡æ¯

**æœªç™»å½•é¡µé¢ï¼š**
- å‹å¥½çš„ç™»å½•æç¤º
- å¿«é€Ÿç™»å½•è¡¨å•
- æ³¨å†Œè´¦æˆ·çš„å¼•å¯¼é“¾æ¥

### 4.3 è§’è‰²æ ‡è¯†è®¾è®¡

**è§’è‰²å¾½ç« ï¼š**
```css
.role-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
}

.role-badge--admin { background: #f44336; color: white; }
.role-badge--dean { background: #9c27b0; color: white; }
.role-badge--academic-director { background: #3f51b5; color: white; }
.role-badge--research-leader { background: #2196f3; color: white; }
.role-badge--teacher { background: #4caf50; color: white; }
.role-badge--parent { background: #ff9800; color: white; }
.role-badge--student { background: #607d8b; color: white; }
```

## 5. æŠ€æœ¯å®ç°è§„èŒƒ

### 5.1 æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ permission.js          # æ ¸å¿ƒæƒé™ç®¡ç†
â”‚   â”œâ”€â”€ authSync.js           # è®¤è¯çŠ¶æ€åŒæ­¥
â”‚   â”œâ”€â”€ dynamicPermission.js  # åŠ¨æ€æƒé™ç®¡ç†
â”‚   â””â”€â”€ permissionUtils.js    # æƒé™å·¥å…·å‡½æ•°
â”œâ”€â”€ composables/
â”‚   â””â”€â”€ useMenuManager.js     # èœå•ç®¡ç†å™¨
â”œâ”€â”€ mixins/
â”‚   â””â”€â”€ permissionMixin.js    # æƒé™æ··å…¥
â”œâ”€â”€ directives/
â”‚   â””â”€â”€ permission.js         # æƒé™æŒ‡ä»¤
â””â”€â”€ components/
    â”œâ”€â”€ ErrorHandler.vue      # é”™è¯¯å¤„ç†ç»„ä»¶
    â””â”€â”€ RoleBadge.vue        # è§’è‰²å¾½ç« ç»„ä»¶
```

### 5.2 APIæ¥å£è§„èŒƒ

**è®¤è¯ç›¸å…³APIï¼š**
```javascript
// ç”¨æˆ·ç™»å½•
POST /accounts/api/auth/login/
{
  "username": "string",
  "password": "string"
}

// ç”¨æˆ·æ³¨å†Œ
POST /accounts/api/auth/register/
{
  "username": "string",
  "email": "string",
  "password": "string",
  "real_name": "string"
}

// è·å–ç”¨æˆ·ä¿¡æ¯
GET /accounts/api/users/profile/
Headers: { "Authorization": "Token <token>" }

// éªŒè¯token
POST /accounts/api/auth/verify-token/
Headers: { "Authorization": "Token <token>" }

// ç”¨æˆ·ç™»å‡º
POST /accounts/api/users/logout/
Headers: { "Authorization": "Token <token>" }
```

### 5.3 çŠ¶æ€ç®¡ç†

**æƒé™çŠ¶æ€ç®¡ç†ï¼š**
```javascript
// æƒé™å˜æ›´ç›‘å¬å™¨
class PermissionWatcher {
  constructor() {
    this.listeners = []
  }
  
  addListener(callback) {
    this.listeners.push(callback)
  }
  
  removeListener(callback) {
    const index = this.listeners.indexOf(callback)
    if (index > -1) {
      this.listeners.splice(index, 1)
    }
  }
  
  notifyChange(user) {
    this.listeners.forEach(callback => {
      try {
        callback(user)
      } catch (error) {
        console.error('æƒé™å˜æ›´ç›‘å¬å™¨æ‰§è¡Œå¤±è´¥:', error)
      }
    })
  }
}

export const permissionWatcher = new PermissionWatcher()
```

### 5.4 ç¼“å­˜ç­–ç•¥

**è®¤è¯çŠ¶æ€ç¼“å­˜ï¼š**
```javascript
// è®¤è¯çŠ¶æ€ç¼“å­˜
let authCache = {
  lastCheck: 0,
  result: null,
  syncing: false
}

// ç¼“å­˜æœ‰æ•ˆæœŸï¼ˆ5åˆ†é’Ÿï¼‰
const AUTH_CACHE_DURATION = 5 * 60 * 1000

// æ¸…é™¤è®¤è¯ç¼“å­˜
export function clearAuthCache() {
  authCache.lastCheck = 0
  authCache.result = null
  authCache.syncing = false
}
```

## 6. æƒé™æ£€æŸ¥æµç¨‹

### 6.1 å‰ç«¯æƒé™éªŒè¯

**ç»„ä»¶çº§æƒé™æ£€æŸ¥ï¼š**
```javascript
// åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨
export default {
  mixins: [permissionMixin],
  
  computed: {
    canManageUsers() {
      return this.hasPermission('manage_users')
    },
    
    canAccessDevTools() {
      return this.hasPermission('access_dev_tools')
    }
  },
  
  methods: {
    handleAdminAction() {
      if (!this.isAdmin) {
        this.$message.error('æƒé™ä¸è¶³')
        return
      }
      // æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ
    }
  }
}
```

**è·¯ç”±çº§æƒé™æ£€æŸ¥ï¼š**
```javascript
// åœ¨router/index.jsä¸­é…ç½®
router.beforeEach(async (to, from, next) => {
  // è®¾ç½®é¡µé¢æ ‡é¢˜
  document.title = to.meta.title || 'Natural English'
  
  // å¼‚æ­¥æ£€æŸ¥è®¤è¯çŠ¶æ€
  const isAuth = await isAuthenticated()
  const user = getCurrentUser()
  
  // æ£€æŸ¥é¡µé¢è®¿é—®æƒé™
  if (user && !canAccessPage(user.role, to.path)) {
    console.warn(`ç”¨æˆ·æ— æƒè®¿é—®é¡µé¢: ${to.path}`)
    next({ path: '/error', query: { type: 'permission' } })
    return
  }
  
  next()
})
```

### 6.2 åç«¯åŒæ­¥æœºåˆ¶

**è®¤è¯çŠ¶æ€åŒæ­¥ï¼š**
```javascript
// åŒæ­¥åç«¯è®¤è¯çŠ¶æ€
export async function syncAuthState() {
  try {
    const response = await fetch('/accounts/api/auth/verify-token/', {
      method: 'POST',
      credentials: 'include',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    
    if (response.ok) {
      const data = await response.json()
      if (data.user) {
        localStorage.setItem('user', JSON.stringify(data.user))
        localStorage.setItem('token', data.token || '')
        return { success: true, authenticated: true, user: data.user }
      }
    }
    
    // è®¤è¯å¤±è´¥ï¼Œæ¸…é™¤æœ¬åœ°çŠ¶æ€
    clearAuth()
    return { success: true, authenticated: false }
  } catch (error) {
    console.error('è®¤è¯çŠ¶æ€åŒæ­¥å¤±è´¥:', error)
    return { success: false, authenticated: false }
  }
}
```

## 7. å®æ–½æŒ‡å—å’Œæœ€ä½³å®è·µ

### 7.1 å®æ–½æ­¥éª¤

**ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æƒé™ç³»ç»Ÿ**
1. å®Œå–„ `utils/permission.js` æƒé™ç®¡ç†æ ¸å¿ƒ
2. å®ç°ç”¨æˆ·è®¤è¯çŠ¶æ€ç®¡ç†
3. å»ºç«‹è§’è‰²æƒé™æ˜ å°„è¡¨
4. å®ç°åŸºç¡€æƒé™æ£€æŸ¥å‡½æ•°

**ç¬¬äºŒé˜¶æ®µï¼šé¡µé¢è®¿é—®æ§åˆ¶**
1. å®Œå–„é¡µé¢æƒé™æ˜ å°„è¡¨
2. å®ç°è·¯ç”±å®ˆå«æƒé™æ£€æŸ¥
3. ä¼˜åŒ–é”™è¯¯é¡µé¢å¤„ç†
4. æµ‹è¯•å„è§’è‰²é¡µé¢è®¿é—®æƒé™

**ç¬¬ä¸‰é˜¶æ®µï¼šèœå•æƒé™ç»‘å®š**
1. å®ç°åŠ¨æ€èœå•è¿‡æ»¤
2. ä¼˜åŒ– `useMenuManager.js` æƒé™æ£€æŸ¥
3. å®Œå–„èœå•ç»„ä»¶æƒé™æŒ‡ä»¤
4. æµ‹è¯•èœå•æ˜¾ç¤ºé€»è¾‘

**ç¬¬å››é˜¶æ®µï¼šUIç»„ä»¶å’Œä½“éªŒä¼˜åŒ–**
1. å®ç°æƒé™æŒ‡ä»¤ `v-permission`
2. ä¼˜åŒ–é”™è¯¯é¡µé¢è®¾è®¡
3. æ·»åŠ è§’è‰²æ ‡è¯†ç»„ä»¶
4. å®Œå–„ç”¨æˆ·ä½“éªŒç»†èŠ‚

**ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•å’Œä¼˜åŒ–**
1. å…¨é¢æƒé™åŠŸèƒ½æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥
3. å®‰å…¨æ€§å®¡æŸ¥
4. æ–‡æ¡£å®Œå–„å’ŒåŸ¹è®­

### 7.2 æœ€ä½³å®è·µ

**å®‰å…¨åŸåˆ™ï¼š**
1. **æœ€å°æƒé™åŸåˆ™** - ç”¨æˆ·åªè·å¾—å®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°æƒé™
2. **æƒé™åˆ†ç¦»** - æ•æ„Ÿæ“ä½œéœ€è¦å¤šé‡æƒé™éªŒè¯
3. **å®šæœŸå®¡æŸ¥** - å®šæœŸæ£€æŸ¥å’Œæ›´æ–°ç”¨æˆ·æƒé™
4. **æ—¥å¿—è®°å½•** - è®°å½•æ‰€æœ‰æƒé™ç›¸å…³æ“ä½œ

**æ€§èƒ½ä¼˜åŒ–ï¼š**
1. **æƒé™ç¼“å­˜** - åˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤æ£€æŸ¥
2. **æ‡’åŠ è½½** - æŒ‰éœ€åŠ è½½æƒé™ç›¸å…³æ•°æ®
3. **æ‰¹é‡æ£€æŸ¥** - æ‰¹é‡å¤„ç†æƒé™éªŒè¯è¯·æ±‚
4. **å‰ç«¯é¢„æ£€** - å‰ç«¯é¢„å…ˆè¿‡æ»¤æ˜æ˜¾æ— æƒé™çš„æ“ä½œ

**ç”¨æˆ·ä½“éªŒï¼š**
1. **æ¸è¿›å¼æ˜¾ç¤º** - æ ¹æ®æƒé™é€æ­¥æ˜¾ç¤ºåŠŸèƒ½
2. **å‹å¥½æç¤º** - æä¾›æ¸…æ™°çš„æƒé™ä¸è¶³æç¤º
3. **å¿«é€Ÿåé¦ˆ** - æƒé™æ£€æŸ¥ç»“æœå¿«é€Ÿå“åº”
4. **ä¸€è‡´æ€§** - ä¿æŒæƒé™æ£€æŸ¥é€»è¾‘çš„ä¸€è‡´æ€§

**ä»£ç è§„èŒƒï¼š**
1. **ç»Ÿä¸€å‘½å** - æƒé™åç§°ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ
2. **æ¨¡å—åŒ–** - æƒé™ç›¸å…³ä»£ç æ¨¡å—åŒ–ç®¡ç†
3. **æ–‡æ¡£åŒ–** - è¯¦ç»†è®°å½•æƒé™é…ç½®å’Œä½¿ç”¨æ–¹æ³•
4. **æµ‹è¯•è¦†ç›–** - ç¡®ä¿æƒé™åŠŸèƒ½çš„æµ‹è¯•è¦†ç›–ç‡

### 7.3 ç›‘æ§å’Œç»´æŠ¤

**æƒé™ç›‘æ§ï¼š**
```javascript
// æƒé™ä½¿ç”¨ç»Ÿè®¡
const permissionStats = {
  checkCount: 0,
  deniedCount: 0,
  errorCount: 0
}

// æƒé™æ£€æŸ¥åŒ…è£…å™¨
function monitoredHasPermission(userRole, permission) {
  permissionStats.checkCount++
  
  try {
    const result = hasPermission(userRole, permission)
    if (!result) {
      permissionStats.deniedCount++
      console.log(`æƒé™æ‹’ç»: ${userRole} -> ${permission}`)
    }
    return result
  } catch (error) {
    permissionStats.errorCount++
    console.error(`æƒé™æ£€æŸ¥é”™è¯¯: ${error.message}`)
    return false
  }
}
```

**å®šæœŸç»´æŠ¤ä»»åŠ¡ï¼š**
1. æ£€æŸ¥æƒé™é…ç½®çš„å®Œæ•´æ€§
2. æ¸…ç†æ— æ•ˆçš„æƒé™ç¼“å­˜
3. æ›´æ–°è§’è‰²æƒé™æ˜ å°„è¡¨
4. ä¼˜åŒ–æƒé™æ£€æŸ¥æ€§èƒ½
5. å®¡æŸ¥ç”¨æˆ·æƒé™åˆ†é…

é€šè¿‡è¿™å¥—å®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿè§„èŒƒï¼ŒNatural Englishå¹³å°å°†æ‹¥æœ‰å®‰å…¨ã€é«˜æ•ˆã€ç”¨æˆ·å‹å¥½çš„æƒé™æ§åˆ¶ä½“ç³»ï¼Œä¸ºå¹³å°çš„é•¿æœŸå‘å±•æä¾›åšå®çš„åŸºç¡€æ¶æ„æ”¯æ’‘ã€‚
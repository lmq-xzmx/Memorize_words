# Natural English å­¦ä¹ ç›®æ ‡ä¸å­¦ä¹ è®¡åˆ’æƒé™æ§åˆ¶ç³»ç»Ÿæ–‡æ¡£

## 1. æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸“é—¨æè¿° Natural English å¹³å°ä¸­å­¦ä¹ ç›®æ ‡ï¼ˆLearningGoalï¼‰å’Œå­¦ä¹ è®¡åˆ’ï¼ˆLearningPlanï¼‰ä¸è§’è‰²ã€èœå•ã€æƒé™ç³»ç»Ÿçš„é›†æˆå…³ç³»ï¼ŒåŒ…æ‹¬æƒé™é…ç½®ã€èœå•æ˜¾ç¤ºé€»è¾‘ã€åŠ¨æ€çŠ¶æ€ç›‘å¬ç­‰æ ¸å¿ƒæœºåˆ¶ã€‚

## 2. å­¦ä¹ ç›®æ ‡ (LearningGoal) æƒé™æ§åˆ¶ç³»ç»Ÿ

### 2.1 å­¦ä¹ ç›®æ ‡æ¨¡å‹å®šä¹‰

```python
class LearningGoal(models.Model):
    """å­¦ä¹ ç›®æ ‡æ¨¡å‹"""
    GOAL_TYPE_CHOICES = [
        ('vocabulary_list', 'è¯åº“'),
        ('word_set', 'è¯é›†'),
        ('grade_level', 'åˆ†çº§'),
        ('vocabulary', 'è¯æ±‡å­¦ä¹ '),
        ('reading', 'é˜…è¯»ç†è§£'),
        ('listening', 'å¬åŠ›è®­ç»ƒ'),
        ('speaking', 'å£è¯­ç»ƒä¹ '),
        ('writing', 'å†™ä½œè®­ç»ƒ'),
    ]
    
    user = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='teaching_learning_goals',
        verbose_name='ç”¨æˆ·'
    )
    name = models.CharField(max_length=200, verbose_name='ç›®æ ‡åç§°')
    description = models.TextField(blank=True, verbose_name='ç›®æ ‡æè¿°')
    goal_type = models.CharField(
        max_length=20, 
        choices=GOAL_TYPE_CHOICES, 
        default='vocabulary', 
        verbose_name='ç›®æ ‡ç±»å‹'
    )
    is_current = models.BooleanField(default=False, verbose_name='æ˜¯å¦ä¸ºå½“å‰ç›®æ ‡')
    total_words = models.IntegerField(default=0, verbose_name='æ€»å•è¯æ•°')
    learned_words = models.IntegerField(default=0, verbose_name='å·²å­¦å•è¯æ•°')
    target_words_count = models.IntegerField(default=100, verbose_name='ç›®æ ‡å•è¯æ•°é‡')
    start_date = models.DateField(default=timezone.now, verbose_name='å¼€å§‹æ—¥æœŸ')
    end_date = models.DateField(verbose_name='ç»“æŸæ—¥æœŸ')
    is_active = models.BooleanField(default=True, verbose_name='æ˜¯å¦æ¿€æ´»')
```

### 2.2 å­¦ä¹ ç›®æ ‡èœå•æƒé™é…ç½®

#### 2.2.1 è§’è‰²èœå•æƒé™çŸ©é˜µ

```python
# å­¦ä¹ ç›®æ ‡ç›¸å…³èœå•æƒé™é…ç½®
role_menu_matrix = {
    UserRole.ADMIN: {
        'allowed_menus': ['teaching_goals'],  # ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ‰€æœ‰æ•™å­¦ç›®æ ‡
        'permissions': [
            'create_learning_goals',
            'edit_learning_goals', 
            'delete_learning_goals',
            'view_all_learning_goals',
            'assign_goals_to_users'
        ]
    },
    UserRole.DEAN: {
        'allowed_menus': ['teaching_goals'],  # æ•™å¯¼ä¸»ä»»å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ•™å­¦ç›®æ ‡
        'permissions': [
            'create_learning_goals',
            'edit_learning_goals',
            'view_all_learning_goals',
            'assign_goals_to_teachers'
        ]
    },
    UserRole.ACADEMIC_DIRECTOR: {
        'allowed_menus': ['teaching_goals'],  # æ•™åŠ¡ä¸»ä»»å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ•™å­¦ç›®æ ‡
        'permissions': [
            'create_learning_goals',
            'edit_learning_goals',
            'view_department_learning_goals',
            'assign_goals_to_classes'
        ]
    },
    UserRole.RESEARCH_LEADER: {
        'allowed_menus': ['teaching_goals'],  # æ•™ç ”ç»„é•¿å¯ä»¥æŸ¥çœ‹æ•™å­¦ç›®æ ‡
        'permissions': [
            'view_subject_learning_goals',
            'suggest_goal_improvements'
        ]
    },
    UserRole.TEACHER: {
        'allowed_menus': [],  # æ•™å¸ˆä¸èƒ½ç›´æ¥ç®¡ç†æ•™å­¦ç›®æ ‡ï¼Œä½†å¯ä»¥æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±çš„ç›®æ ‡
        'permissions': [
            'view_assigned_goals',
            'track_student_goal_progress',
            'create_class_specific_goals'
        ]
    },
    UserRole.PARENT: {
        'allowed_menus': [],  # å®¶é•¿ä¸èƒ½è®¿é—®æ•™å­¦ç›®æ ‡ç®¡ç†
        'permissions': [
            'view_child_learning_goals',
            'view_child_goal_progress'
        ]
    },
    UserRole.STUDENT: {
        'allowed_menus': [],  # å­¦ç”Ÿä¸èƒ½è®¿é—®æ•™å­¦ç›®æ ‡ç®¡ç†
        'permissions': [
            'view_own_learning_goals',
            'track_own_goal_progress'
        ]
    }
}
```

#### 2.2.2 å‰ç«¯èœå•æ˜¾ç¤ºé€»è¾‘

```vue
<template>
  <div class="teaching-menu">
    <!-- æ•™å­¦ç›®æ ‡èœå•é¡¹ -->
    <div v-permission="'manage_teaching_goals'" class="menu-item" @click="navigateToGoals">
      <span class="menu-icon">ğŸ¯</span>
      <span class="menu-text">å­¦ä¹ ç›®æ ‡</span>
      <span v-if="activeGoalsCount > 0" class="badge">{{ activeGoalsCount }}</span>
    </div>
  </div>
</template>

<script>
export default {
  computed: {
    // æ´»è·ƒç›®æ ‡æ•°é‡
    activeGoalsCount() {
      return this.learningGoals.filter(goal => goal.is_active).length
    }
  },
  
  methods: {
    // å¯¼èˆªåˆ°ç›®æ ‡ç®¡ç†é¡µé¢
    navigateToGoals() {
      this.$navigateWithPermission('/teaching/goals', 'manage_teaching_goals')
    }
  }
}
</script>
```

## 3. å­¦ä¹ è®¡åˆ’ (LearningPlan) æƒé™æ§åˆ¶ç³»ç»Ÿ

### 3.1 å­¦ä¹ è®¡åˆ’æ¨¡å‹å®šä¹‰

```python
class LearningPlan(models.Model):
    """å­¦ä¹ è®¡åˆ’æ¨¡å‹"""
    PLAN_TYPE_CHOICES = [
        ('mechanical', 'æœºæ¢°æ¨¡å¼'),
        ('daily_progress', 'æ—¥è¿›æ¨¡å¼'),
        ('weekday', 'å·¥ä½œæ—¥æ¨¡å¼'),
        ('weekend', 'å‘¨æœ«æ¨¡å¼'),
        ('daily', 'æ¯æ—¥è®¡åˆ’'),
        ('weekly', 'æ¯å‘¨è®¡åˆ’'),
        ('custom', 'è‡ªå®šä¹‰è®¡åˆ’'),
    ]
    
    STATUS_CHOICES = [
        ('active', 'è¿›è¡Œä¸­'),
        ('completed', 'å·²å®Œæˆ'),
        ('paused', 'å·²æš‚åœ'),
        ('cancelled', 'å·²å–æ¶ˆ'),
    ]
    
    user = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='teaching_learning_plans',
        verbose_name='ç”¨æˆ·'
    )
    goal = models.ForeignKey(
        LearningGoal, 
        on_delete=models.CASCADE, 
        related_name='plans',
        verbose_name='å­¦ä¹ ç›®æ ‡'
    )
    name = models.CharField(max_length=100, verbose_name='è®¡åˆ’åç§°')
    plan_type = models.CharField(
        max_length=20, 
        choices=PLAN_TYPE_CHOICES, 
        default='daily',
        verbose_name='è®¡åˆ’ç±»å‹'
    )
    start_date = models.DateField(null=True, blank=True, verbose_name='å¼€å§‹æ—¥æœŸ')
    end_date = models.DateField(null=True, blank=True, verbose_name='ç»“æŸæ—¥æœŸ')
    total_words = models.IntegerField(default=0, verbose_name='æ€»å•è¯æ•°')
    daily_target = models.IntegerField(default=0, verbose_name='æ¯æ—¥ç›®æ ‡å•è¯æ•°')
    status = models.CharField(
        max_length=20, 
        choices=STATUS_CHOICES, 
        default='active',
        verbose_name='çŠ¶æ€'
    )
```

### 3.2 å­¦ä¹ è®¡åˆ’èœå•æƒé™é…ç½®

#### 3.2.1 è§’è‰²æƒé™æ˜ å°„

```python
# å­¦ä¹ è®¡åˆ’ç›¸å…³æƒé™é…ç½®
role_permissions = {
    UserRole.ADMIN: {
        'teaching_plans': True,  # ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ‰€æœ‰æ•™å­¦è®¡åˆ’
        'permissions': [
            'create_all_learning_plans',
            'edit_all_learning_plans',
            'delete_all_learning_plans',
            'view_all_learning_plans',
            'assign_plans_to_users'
        ]
    },
    UserRole.DEAN: {
        'teaching_plans': True,  # æ•™å¯¼ä¸»ä»»å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ•™å­¦è®¡åˆ’
        'permissions': [
            'create_department_learning_plans',
            'edit_department_learning_plans',
            'view_all_learning_plans',
            'assign_plans_to_teachers'
        ]
    },
    UserRole.ACADEMIC_DIRECTOR: {
        'teaching_plans': True,  # æ•™åŠ¡ä¸»ä»»å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ•™å­¦è®¡åˆ’
        'permissions': [
            'create_grade_learning_plans',
            'edit_grade_learning_plans',
            'view_department_learning_plans',
            'assign_plans_to_classes'
        ]
    },
    UserRole.RESEARCH_LEADER: {
        'teaching_plans': False,  # æ•™ç ”ç»„é•¿ä¸èƒ½ç›´æ¥ç®¡ç†æ•™å­¦è®¡åˆ’
        'permissions': [
            'view_subject_learning_plans',
            'suggest_plan_improvements'
        ]
    },
    UserRole.TEACHER: {
        'teaching_plans': True,  # æ•™å¸ˆå¯ä»¥ä¸ºè‡ªå·±çš„å­¦ç”Ÿåˆ¶å®šè®¡åˆ’
        'permissions': [
            'create_class_learning_plans',
            'edit_own_class_plans',
            'view_assigned_plans',
            'track_student_plan_progress'
        ]
    },
    UserRole.PARENT: {
        'teaching_plans': False,  # å®¶é•¿ä¸èƒ½ç®¡ç†æ•™å­¦è®¡åˆ’ï¼Œä½†å¯ä»¥æŸ¥çœ‹å­å¥³çš„è®¡åˆ’
        'permissions': [
            'view_child_learning_plans',
            'view_child_plan_progress'
        ]
    },
    UserRole.STUDENT: {
        'teaching_plans': False,  # å­¦ç”Ÿä¸èƒ½ç®¡ç†æ•™å­¦è®¡åˆ’ï¼Œä½†å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„è®¡åˆ’
        'permissions': [
            'view_own_learning_plans',
            'track_own_plan_progress',
            'update_plan_status'
        ]
    }
}
```

#### 3.2.2 å‰ç«¯è®¡åˆ’ç®¡ç†èœå•

```vue
<template>
  <div class="learning-plans-menu">
    <!-- æ•™å­¦è®¡åˆ’èœå•é¡¹ -->
    <div v-permission="'manage_teaching_plans'" class="menu-item" @click="navigateToPlans">
      <span class="menu-icon">ğŸ“…</span>
      <span class="menu-text">å­¦ä¹ è®¡åˆ’</span>
      <span v-if="activePlansCount > 0" class="badge">{{ activePlansCount }}</span>
    </div>
    
    <!-- å­¦ä¹ è¿›åº¦èœå•é¡¹ï¼ˆæ‰€æœ‰è§’è‰²éƒ½å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„è¿›åº¦ï¼‰ -->
    <div class="menu-item" @click="navigateToProgress">
      <span class="menu-icon">ğŸ“Š</span>
      <span class="menu-text">å­¦ä¹ è¿›åº¦</span>
      <span v-if="progressPercentage > 0" class="progress-indicator">{{ progressPercentage }}%</span>
    </div>
  </div>
</template>

<script>
export default {
  computed: {
    // æ´»è·ƒè®¡åˆ’æ•°é‡
    activePlansCount() {
      return this.learningPlans.filter(plan => plan.status === 'active').length
    },
    
    // å­¦ä¹ è¿›åº¦ç™¾åˆ†æ¯”
    progressPercentage() {
      const currentGoal = this.learningGoals.find(goal => goal.is_current)
      if (!currentGoal) return 0
      
      return Math.round((currentGoal.learned_words / currentGoal.total_words) * 100)
    }
  },
  
  methods: {
    // å¯¼èˆªåˆ°è®¡åˆ’ç®¡ç†é¡µé¢
    navigateToPlans() {
      this.$navigateWithPermission('/teaching/plans', 'manage_teaching_plans')
    },
    
    // å¯¼èˆªåˆ°è¿›åº¦æŸ¥çœ‹é¡µé¢
    navigateToProgress() {
      this.$router.push('/learning/progress')
    }
  }
}
</script>
```

## 4. èœå•ä¸å­¦ä¹ åŠŸèƒ½çš„é›†æˆå…³ç³»

### 4.1 å­¦ä¹ ä¸­å¿ƒèœå•ç»“æ„

```javascript
const learningCenterMenu = {
  key: 'learning',
  name: 'å­¦ä¹ ä¸­å¿ƒ',
  icon: 'fas fa-graduation-cap',
  children: [
    {
      key: 'learning_goals',
      name: 'å­¦ä¹ ç›®æ ‡',
      icon: 'fas fa-bullseye',
      url: '/learning/goals',
      permissions: ['view_learning_goals'],
      roles: ['admin', 'dean', 'academic_director', 'teacher', 'student']
    },
    {
      key: 'learning_plans',
      name: 'å­¦ä¹ è®¡åˆ’',
      icon: 'fas fa-calendar-alt',
      url: '/learning/plans',
      permissions: ['view_learning_plans'],
      roles: ['admin', 'dean', 'academic_director', 'teacher', 'student']
    },
    {
      key: 'learning_progress',
      name: 'å­¦ä¹ è¿›åº¦',
      icon: 'fas fa-chart-line',
      url: '/learning/progress',
      permissions: ['view_learning_progress'],
      roles: ['admin', 'dean', 'academic_director', 'teacher', 'parent', 'student']
    },
    {
      key: 'learning_practice',
      name: 'å­¦ä¹ ç»ƒä¹ ',
      icon: 'fas fa-dumbbell',
      url: '/learning/practice',
      permissions: ['access_learning_practice'],
      roles: ['student', 'teacher']
    }
  ]
}
```

### 4.2 åŠ¨æ€èœå•ç”Ÿæˆé€»è¾‘

```javascript
// æ ¹æ®ç”¨æˆ·è§’è‰²å’Œå­¦ä¹ çŠ¶æ€åŠ¨æ€ç”Ÿæˆèœå•
export function generateLearningMenu(user, learningStatus) {
  const menu = {
    items: [],
    badges: {}
  }
  
  // åŸºç¡€å­¦ä¹ èœå•é¡¹
  if (hasPermission(user.role, 'view_learning_goals')) {
    menu.items.push({
      key: 'goals',
      name: 'å­¦ä¹ ç›®æ ‡',
      url: '/learning/goals',
      icon: 'ğŸ¯'
    })
    
    // æ·»åŠ ç›®æ ‡æ•°é‡å¾½ç« 
    if (learningStatus.activeGoals > 0) {
      menu.badges.goals = learningStatus.activeGoals
    }
  }
  
  if (hasPermission(user.role, 'view_learning_plans')) {
    menu.items.push({
      key: 'plans',
      name: 'å­¦ä¹ è®¡åˆ’',
      url: '/learning/plans',
      icon: 'ğŸ“…'
    })
    
    // æ·»åŠ è®¡åˆ’çŠ¶æ€å¾½ç« 
    if (learningStatus.activePlans > 0) {
      menu.badges.plans = learningStatus.activePlans
    }
  }
  
  // å­¦ä¹ è¿›åº¦ï¼ˆæ‰€æœ‰è§’è‰²éƒ½å¯ä»¥æŸ¥çœ‹ï¼‰
  menu.items.push({
    key: 'progress',
    name: 'å­¦ä¹ è¿›åº¦',
    url: '/learning/progress',
    icon: 'ğŸ“Š'
  })
  
  // æ·»åŠ è¿›åº¦å¾½ç« 
  if (learningStatus.progressPercentage > 0) {
    menu.badges.progress = `${learningStatus.progressPercentage}%`
  }
  
  // å­¦ä¹ ç»ƒä¹ ï¼ˆå­¦ç”Ÿå’Œæ•™å¸ˆï¼‰
  if (['student', 'teacher'].includes(user.role)) {
    menu.items.push({
      key: 'practice',
      name: 'å­¦ä¹ ç»ƒä¹ ',
      url: '/learning/practice',
      icon: 'ğŸƒâ€â™‚ï¸'
    })
    
    // æ·»åŠ å¾…å®Œæˆç»ƒä¹ å¾½ç« 
    if (learningStatus.pendingPractices > 0) {
      menu.badges.practice = learningStatus.pendingPractices
    }
  }
  
  return menu
}
```

### 4.3 å­¦ä¹ çŠ¶æ€ä¸èœå•è”åŠ¨

```javascript
// å­¦ä¹ çŠ¶æ€ç›‘å¬å™¨
export class LearningStatusWatcher {
  constructor() {
    this.listeners = []
    this.currentStatus = null
  }
  
  // ç›‘å¬å­¦ä¹ çŠ¶æ€å˜åŒ–
  watchLearningStatus(callback) {
    this.listeners.push(callback)
    
    // å®šæœŸæ£€æŸ¥å­¦ä¹ çŠ¶æ€
    setInterval(() => {
      this.checkLearningStatus()
    }, 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
  }
  
  // æ£€æŸ¥å­¦ä¹ çŠ¶æ€
  async checkLearningStatus() {
    try {
      const response = await api.get('/learning/status/')
      const newStatus = response.data
      
      // æ¯”è¾ƒçŠ¶æ€å˜åŒ–
      if (this.hasStatusChanged(newStatus)) {
        this.currentStatus = newStatus
        
        // é€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨
        this.listeners.forEach(callback => {
          callback(newStatus)
        })
      }
    } catch (error) {
      console.error('æ£€æŸ¥å­¦ä¹ çŠ¶æ€å¤±è´¥:', error)
    }
  }
  
  // æ£€æŸ¥çŠ¶æ€æ˜¯å¦å˜åŒ–
  hasStatusChanged(newStatus) {
    if (!this.currentStatus) return true
    
    return (
      this.currentStatus.activeGoals !== newStatus.activeGoals ||
      this.currentStatus.activePlans !== newStatus.activePlans ||
      this.currentStatus.progressPercentage !== newStatus.progressPercentage ||
      this.currentStatus.pendingPractices !== newStatus.pendingPractices
    )
  }
}

// åœ¨èœå•ç»„ä»¶ä¸­ä½¿ç”¨
export default {
  name: 'LearningMenu',
  
  data() {
    return {
      learningStatus: {
        activeGoals: 0,
        activePlans: 0,
        progressPercentage: 0,
        pendingPractices: 0
      }
    }
  },
  
  mounted() {
    // ç›‘å¬å­¦ä¹ çŠ¶æ€å˜åŒ–
    const watcher = new LearningStatusWatcher()
    watcher.watchLearningStatus((status) => {
      this.learningStatus = status
      this.updateMenuBadges()
    })
  },
  
  methods: {
    // æ›´æ–°èœå•å¾½ç« 
    updateMenuBadges() {
      // æ›´æ–°ç›®æ ‡å¾½ç« 
      this.$refs.goalsMenuItem.setBadge(this.learningStatus.activeGoals)
      
      // æ›´æ–°è®¡åˆ’å¾½ç« 
      this.$refs.plansMenuItem.setBadge(this.learningStatus.activePlans)
      
      // æ›´æ–°è¿›åº¦å¾½ç« 
      this.$refs.progressMenuItem.setBadge(`${this.learningStatus.progressPercentage}%`)
      
      // æ›´æ–°ç»ƒä¹ å¾½ç« 
      this.$refs.practiceMenuItem.setBadge(this.learningStatus.pendingPractices)
    }
  }
}
```

## 5. æƒé™æ§åˆ¶é€»è¾‘è¯„ä¼°ä¸é—®é¢˜åˆ†æ

### 5.1 å½“å‰è®¾è®¡çš„åˆç†æ€§åˆ†æ

#### 5.1.1 âœ… åˆç†çš„è®¾è®¡éƒ¨åˆ†

1. **è§’è‰²å±‚çº§æ¸…æ™°**
   - ç®¡ç†å‘˜ â†’ æ•™å¯¼ä¸»ä»» â†’ æ•™åŠ¡ä¸»ä»» â†’ æ•™ç ”ç»„é•¿ â†’ æ•™å¸ˆ â†’ å®¶é•¿/å­¦ç”Ÿ
   - æƒé™é€çº§é€’å‡ï¼Œç¬¦åˆæ•™è‚²æœºæ„çš„ç®¡ç†å±‚çº§

2. **æƒé™ç²’åº¦é€‚ä¸­**
   - åŒºåˆ†äº†æŸ¥çœ‹ã€åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç­‰ä¸åŒæ“ä½œæƒé™
   - æ”¯æŒæŒ‰éƒ¨é—¨ã€å¹´çº§ã€ç­çº§ç­‰ç»´åº¦çš„æƒé™æ§åˆ¶

3. **èœå•ä¸åŠŸèƒ½æƒé™ä¸€è‡´**
   - èœå•æ˜¾ç¤ºæƒé™ä¸å®é™…åŠŸèƒ½æƒé™ä¿æŒåŒæ­¥
   - å‰ç«¯æƒé™æ§åˆ¶ä¸åç«¯APIæƒé™éªŒè¯å¯¹åº”

4. **åŠ¨æ€çŠ¶æ€åé¦ˆ**
   - å®æ—¶æ˜¾ç¤ºå­¦ä¹ ç›®æ ‡ã€è®¡åˆ’æ•°é‡ç­‰çŠ¶æ€ä¿¡æ¯
   - é€šè¿‡å¾½ç« ç­‰UIå…ƒç´ æä¾›ç›´è§‚çš„çŠ¶æ€åé¦ˆ

#### 5.1.2 âŒ ä¸åˆç†çš„è®¾è®¡éƒ¨åˆ†

1. **æ•™ç ”ç»„é•¿æƒé™é…ç½®ä¸å½“**
   ```python
   # é—®é¢˜ï¼šæ•™ç ”ç»„é•¿æ— æ³•ç®¡ç†æ•™å­¦è®¡åˆ’
   UserRole.RESEARCH_LEADER: {
       'teaching_plans': False,  # ä¸åˆç†ï¼šæ•™ç ”ç»„é•¿åº”è¯¥èƒ½å‚ä¸è®¡åˆ’åˆ¶å®š
       'permissions': [
           'view_subject_learning_plans',
           'suggest_plan_improvements'  # ä»…èƒ½å»ºè®®ï¼Œæ— æ³•å®é™…å‚ä¸
       ]
   }
   ```
   **é—®é¢˜åˆ†æ**ï¼šæ•™ç ”ç»„é•¿ä½œä¸ºæ•™å­¦ç ”ç©¶çš„è´Ÿè´£äººï¼Œåº”è¯¥èƒ½å¤Ÿå‚ä¸æ•™å­¦è®¡åˆ’çš„åˆ¶å®šå’Œä¼˜åŒ–ï¼Œè€Œä¸ä»…ä»…æ˜¯æå‡ºå»ºè®®ã€‚

2. **æ•™å¸ˆæƒé™è¿‡äºå—é™**
   ```python
   # é—®é¢˜ï¼šæ•™å¸ˆæ— æ³•è®¿é—®æ•™å­¦ç›®æ ‡ç®¡ç†èœå•
   UserRole.TEACHER: {
       'allowed_menus': [],  # ä¸åˆç†ï¼šæ•™å¸ˆåº”è¯¥èƒ½æŸ¥çœ‹ç›¸å…³æ•™å­¦ç›®æ ‡
       'permissions': [
           'view_assigned_goals',  # ä»…èƒ½æŸ¥çœ‹åˆ†é…çš„ç›®æ ‡
           'track_student_goal_progress',
           'create_class_specific_goals'  # çŸ›ç›¾ï¼šèƒ½åˆ›å»ºä½†æ— èœå•è®¿é—®æƒé™
       ]
   }
   ```
   **é—®é¢˜åˆ†æ**ï¼šæ•™å¸ˆèƒ½åˆ›å»ºç­çº§ç‰¹å®šç›®æ ‡ï¼Œä½†æ— æ³•è®¿é—®æ•™å­¦ç›®æ ‡èœå•ï¼Œè¿™åœ¨é€»è¾‘ä¸Šæ˜¯çŸ›ç›¾çš„ã€‚

3. **å®¶é•¿å’Œå­¦ç”Ÿæƒé™è®¾è®¡ä¸ä¸€è‡´**
   ```python
   # é—®é¢˜ï¼šå®¶é•¿å’Œå­¦ç”Ÿéƒ½æ— æ³•è®¿é—®å­¦ä¹ ç›®æ ‡èœå•ï¼Œä½†æœ‰æŸ¥çœ‹æƒé™
   UserRole.PARENT: {
       'allowed_menus': [],  # ä¸åˆç†
       'permissions': ['view_child_learning_goals']  # æœ‰æƒé™ä½†æ— èœå•
   }
   UserRole.STUDENT: {
       'allowed_menus': [],  # ä¸åˆç†
       'permissions': ['view_own_learning_goals']  # æœ‰æƒé™ä½†æ— èœå•
   }
   ```
   **é—®é¢˜åˆ†æ**ï¼šç”¨æˆ·æœ‰æŸ¥çœ‹æƒé™ä½†æ— æ³•é€šè¿‡èœå•è®¿é—®ï¼Œå¯¼è‡´åŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚

4. **æƒé™æ£€æŸ¥é€»è¾‘å†—ä½™**
   ```javascript
   // é—®é¢˜ï¼šé‡å¤çš„æƒé™æ£€æŸ¥
   async checkToolsPermission() {
     const hasPermission = await checkMenuPermission('tools')  // APIè°ƒç”¨
     if (!hasPermission) {
       this.$showError('æ‚¨æ²¡æœ‰æƒé™è®¿é—®å·¥å…·èœå•')
       return
     }
     this.toggleMenu('tools')
   }
   ```
   **é—®é¢˜åˆ†æ**ï¼šå‰ç«¯å·²æœ‰æƒé™æ··å…¥å’ŒæŒ‡ä»¤ï¼Œä¸åº”è¯¥åœ¨æ¯æ¬¡èœå•æ“ä½œæ—¶éƒ½è¿›è¡ŒAPIè°ƒç”¨ã€‚

5. **å­¦ä¹ çŠ¶æ€ç›‘å¬é¢‘ç‡è¿‡é«˜**
   ```javascript
   // é—®é¢˜ï¼š30ç§’è½®è¯¢è¿‡äºé¢‘ç¹
   setInterval(() => {
     this.checkLearningStatus()
   }, 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
   ```
   **é—®é¢˜åˆ†æ**ï¼šå­¦ä¹ çŠ¶æ€å˜åŒ–ä¸é¢‘ç¹ï¼Œ30ç§’è½®è¯¢ä¼šé€ æˆä¸å¿…è¦çš„æœåŠ¡å™¨è´Ÿè½½ã€‚

### 5.2 æ”¹è¿›å»ºè®®

#### 5.2.1 æƒé™é…ç½®ä¼˜åŒ–

```python
# å»ºè®®çš„æƒé™é…ç½®
role_permissions_optimized = {
    UserRole.RESEARCH_LEADER: {
        'teaching_plans': True,  # åº”è¯¥èƒ½å‚ä¸è®¡åˆ’åˆ¶å®š
        'permissions': [
            'view_subject_learning_plans',
            'create_research_based_plans',  # æ–°å¢ï¼šåŸºäºç ”ç©¶åˆ›å»ºè®¡åˆ’
            'edit_subject_learning_plans',  # æ–°å¢ï¼šç¼–è¾‘å­¦ç§‘ç›¸å…³è®¡åˆ’
            'suggest_plan_improvements'
        ]
    },
    UserRole.TEACHER: {
        'allowed_menus': ['teaching_goals'],  # åº”è¯¥èƒ½è®¿é—®æ•™å­¦ç›®æ ‡èœå•
        'permissions': [
            'view_assigned_goals',
            'view_class_learning_goals',  # æ–°å¢ï¼šæŸ¥çœ‹ç­çº§å­¦ä¹ ç›®æ ‡
            'track_student_goal_progress',
            'create_class_specific_goals'
        ]
    },
    UserRole.PARENT: {
        'allowed_menus': ['learning_goals', 'learning_progress'],  # æ–°å¢èœå•è®¿é—®æƒé™
        'permissions': [
            'view_child_learning_goals',
            'view_child_goal_progress'
        ]
    },
    UserRole.STUDENT: {
        'allowed_menus': ['learning_goals', 'learning_progress'],  # æ–°å¢èœå•è®¿é—®æƒé™
        'permissions': [
            'view_own_learning_goals',
            'track_own_goal_progress'
        ]
    }
}
```

#### 5.2.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```javascript
// ä¼˜åŒ–çš„å­¦ä¹ çŠ¶æ€ç›‘å¬
export class OptimizedLearningStatusWatcher {
  constructor() {
    this.listeners = []
    this.currentStatus = null
    this.pollInterval = 5 * 60 * 1000 // æ”¹ä¸º5åˆ†é’Ÿè½®è¯¢
  }
  
  // ä½¿ç”¨WebSocketå®æ—¶æ¨é€æ›¿ä»£è½®è¯¢
  initWebSocketConnection() {
    const ws = new WebSocket('/ws/learning-status/')
    
    ws.onmessage = (event) => {
      const newStatus = JSON.parse(event.data)
      this.updateStatus(newStatus)
    }
    
    // é™çº§åˆ°è½®è¯¢ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
    ws.onerror = () => {
      this.fallbackToPolling()
    }
  }
  
  fallbackToPolling() {
    setInterval(() => {
      this.checkLearningStatus()
    }, this.pollInterval)
  }
}
```

#### 5.2.3 æƒé™æ£€æŸ¥ä¼˜åŒ–

```javascript
// ä¼˜åŒ–çš„æƒé™æ£€æŸ¥é€»è¾‘
export default {
  computed: {
    // ç¼“å­˜æƒé™æ£€æŸ¥ç»“æœ
    canAccessTools() {
      return this.$hasPermission('access_tools')
    }
  },
  
  methods: {
    // ç®€åŒ–çš„å·¥å…·æƒé™æ£€æŸ¥
    checkToolsPermission() {
      if (!this.canAccessTools) {
        this.$showError('æ‚¨æ²¡æœ‰æƒé™è®¿é—®å·¥å…·èœå•')
        return
      }
      this.toggleMenu('tools')
    }
  }
}
```

## 6. æ€»ç»“ä¸å»ºè®®

### 6.1 ç³»ç»Ÿä¼˜åŠ¿

1. **å®Œæ•´çš„æƒé™ä½“ç³»**ï¼šè¦†ç›–äº†ä»ç®¡ç†å‘˜åˆ°å­¦ç”Ÿçš„å®Œæ•´è§’è‰²å±‚çº§
2. **ç»†ç²’åº¦æ§åˆ¶**ï¼šæ”¯æŒåŠŸèƒ½çº§å’Œæ•°æ®çº§çš„æƒé™æ§åˆ¶
3. **åŠ¨æ€å“åº”**ï¼šèœå•å’ŒçŠ¶æ€èƒ½å¤Ÿå®æ—¶åæ˜ ç”¨æˆ·æƒé™å’Œå­¦ä¹ çŠ¶æ€
4. **å‰åç«¯ä¸€è‡´**ï¼šå‰ç«¯æƒé™æ§åˆ¶ä¸åç«¯APIæƒé™éªŒè¯ä¿æŒåŒæ­¥

### 6.2 ä¸»è¦é—®é¢˜

1. **æƒé™é…ç½®ä¸ä¸€è‡´**ï¼šéƒ¨åˆ†è§’è‰²çš„èœå•æƒé™ä¸åŠŸèƒ½æƒé™ä¸åŒ¹é…
2. **æ•™ç ”ç»„é•¿æƒé™ä¸è¶³**ï¼šæ— æ³•æœ‰æ•ˆå‚ä¸æ•™å­¦è®¡åˆ’åˆ¶å®š
3. **æ€§èƒ½ä¼˜åŒ–ä¸è¶³**ï¼šé¢‘ç¹çš„APIè°ƒç”¨å’Œè½®è¯¢å½±å“æ€§èƒ½
4. **ç”¨æˆ·ä½“éªŒé—®é¢˜**ï¼šæœ‰æƒé™ä½†æ— èœå•è®¿é—®å¯¼è‡´åŠŸèƒ½æ— æ³•ä½¿ç”¨

### 6.3 æ”¹è¿›æ–¹å‘

1. **ç»Ÿä¸€æƒé™é…ç½®**ï¼šç¡®ä¿èœå•æƒé™ä¸åŠŸèƒ½æƒé™çš„ä¸€è‡´æ€§
2. **ä¼˜åŒ–è§’è‰²æƒé™**ï¼šæ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è°ƒæ•´å„è§’è‰²æƒé™
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨WebSocketæ¨é€å’Œæƒé™ç¼“å­˜å‡å°‘æœåŠ¡å™¨è´Ÿè½½
4. **ç”¨æˆ·ä½“éªŒæå‡**ï¼šæä¾›æ›´ç›´è§‚çš„æƒé™åé¦ˆå’Œæ“ä½œæŒ‡å¼•

è¯¥æƒé™æ§åˆ¶ç³»ç»Ÿä¸ºå­¦ä¹ ç›®æ ‡å’Œå­¦ä¹ è®¡åˆ’åŠŸèƒ½æä¾›äº†åŸºç¡€çš„å®‰å…¨ä¿éšœï¼Œä½†éœ€è¦åœ¨æƒé™é…ç½®åˆç†æ€§å’Œç³»ç»Ÿæ€§èƒ½æ–¹é¢è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚
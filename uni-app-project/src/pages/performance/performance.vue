<template>
  <view class="performance-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <view class="page-header">
      <text class="page-title">ğŸ“Š æ€§èƒ½ç›‘æ§</text>
      <text class="page-subtitle">å¼€å‘å·¥å…· - åº”ç”¨æ€§èƒ½åˆ†æ</text>
    </view>

    <!-- åŠŸèƒ½çŠ¶æ€ -->
    <view class="status-card">
      <view class="status-header">
        <text class="status-title">âš¡ ç›‘æ§çŠ¶æ€</text>
        <view class="status-badge disabled">
          <text class="badge-text">æœªå¯ç”¨</text>
        </view>
      </view>
      
      <text class="status-description">
        æ€§èƒ½ç›‘æ§åŠŸèƒ½å½“å‰å¤„äºå¼€å‘é˜¶æ®µï¼Œæš‚æœªå¯ç”¨ã€‚æ­¤åŠŸèƒ½å°†æä¾›åº”ç”¨æ€§èƒ½çš„å®æ—¶ç›‘æ§ã€åˆ†æå’Œä¼˜åŒ–å»ºè®®ã€‚
      </text>
      
      <view class="status-features">
        <text class="features-title">ç›‘æ§æŒ‡æ ‡:</text>
        <view class="feature-list">
          <view class="feature-item">
            <text class="feature-icon">ğŸš€</text>
            <text class="feature-text">é¡µé¢åŠ è½½æ€§èƒ½</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">ğŸ’¾</text>
            <text class="feature-text">å†…å­˜ä½¿ç”¨æƒ…å†µ</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">ğŸ”„</text>
            <text class="feature-text">ç½‘ç»œè¯·æ±‚åˆ†æ</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">ğŸ“±</text>
            <text class="feature-text">è®¾å¤‡æ€§èƒ½æŒ‡æ ‡</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ€§èƒ½æ¦‚è§ˆ -->
    <view class="overview-section">
      <text class="section-title">ğŸ“ˆ æ€§èƒ½æ¦‚è§ˆ</text>
      <text class="section-subtitle">åº”ç”¨æ•´ä½“æ€§èƒ½è¡¨ç°</text>
      
      <view class="metrics-grid">
        <view class="metric-card disabled">
          <view class="metric-icon">âš¡</view>
          <view class="metric-content">
            <text class="metric-label">æ€§èƒ½è¯„åˆ†</text>
            <text class="metric-value">--</text>
            <text class="metric-unit">/100</text>
          </view>
        </view>
        
        <view class="metric-card disabled">
          <view class="metric-icon">ğŸš€</view>
          <view class="metric-content">
            <text class="metric-label">å¹³å‡åŠ è½½æ—¶é—´</text>
            <text class="metric-value">--</text>
            <text class="metric-unit">ms</text>
          </view>
        </view>
        
        <view class="metric-card disabled">
          <view class="metric-icon">ğŸ’¾</view>
          <view class="metric-content">
            <text class="metric-label">å†…å­˜ä½¿ç”¨</text>
            <text class="metric-value">--</text>
            <text class="metric-unit">MB</text>
          </view>
        </view>
        
        <view class="metric-card disabled">
          <view class="metric-icon">ğŸ“Š</view>
          <view class="metric-content">
            <text class="metric-label">FPS</text>
            <text class="metric-value">--</text>
            <text class="metric-unit">fps</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†ç›‘æ§é¢æ¿ -->
    <view class="monitoring-section">
      <text class="section-title">ğŸ” è¯¦ç»†ç›‘æ§</text>
      
      <!-- é¡µé¢æ€§èƒ½ -->
      <view class="monitor-panel disabled">
        <view class="panel-header">
          <text class="panel-title">ğŸ“„ é¡µé¢æ€§èƒ½</text>
          <view class="panel-status">
            <view class="status-dot offline"></view>
            <text class="status-text">ç¦»çº¿</text>
          </view>
        </view>
        
        <view class="performance-chart">
          <view class="chart-placeholder">
            <text class="placeholder-text">ğŸ“Š æ€§èƒ½å›¾è¡¨</text>
            <text class="placeholder-desc">åŠŸèƒ½å¯ç”¨åæ˜¾ç¤ºå®æ—¶æ€§èƒ½æ•°æ®</text>
          </view>
        </view>
        
        <view class="performance-details">
          <view class="detail-row">
            <text class="detail-label">é¦–å±æ¸²æŸ“æ—¶é—´</text>
            <text class="detail-value">-- ms</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">DOM æ„å»ºæ—¶é—´</text>
            <text class="detail-value">-- ms</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">èµ„æºåŠ è½½æ—¶é—´</text>
            <text class="detail-value">-- ms</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">äº¤äº’å“åº”æ—¶é—´</text>
            <text class="detail-value">-- ms</text>
          </view>
        </view>
      </view>
      
      <!-- ç½‘ç»œç›‘æ§ -->
      <view class="monitor-panel disabled">
        <view class="panel-header">
          <text class="panel-title">ğŸŒ ç½‘ç»œç›‘æ§</text>
          <view class="panel-status">
            <view class="status-dot offline"></view>
            <text class="status-text">ç¦»çº¿</text>
          </view>
        </view>
        
        <view class="network-stats">
          <view class="stat-item">
            <text class="stat-label">è¯·æ±‚æ€»æ•°</text>
            <text class="stat-value">--</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">æˆåŠŸç‡</text>
            <text class="stat-value">--%</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å¹³å‡å“åº”æ—¶é—´</text>
            <text class="stat-value">-- ms</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">æ•°æ®ä¼ è¾“é‡</text>
            <text class="stat-value">-- KB</text>
          </view>
        </view>
        
        <view class="request-list">
          <view class="list-header">
            <text class="header-text">æœ€è¿‘è¯·æ±‚</text>
          </view>
          <view class="request-item">
            <text class="request-method">--</text>
            <text class="request-url">ç­‰å¾…æ•°æ®...</text>
            <text class="request-status">--</text>
            <text class="request-time">-- ms</text>
          </view>
        </view>
      </view>
      
      <!-- èµ„æºç›‘æ§ -->
      <view class="monitor-panel disabled">
        <view class="panel-header">
          <text class="panel-title">ğŸ’¾ èµ„æºç›‘æ§</text>
          <view class="panel-status">
            <view class="status-dot offline"></view>
            <text class="status-text">ç¦»çº¿</text>
          </view>
        </view>
        
        <view class="resource-usage">
          <view class="usage-item">
            <view class="usage-header">
              <text class="usage-label">å†…å­˜ä½¿ç”¨</text>
              <text class="usage-percent">--%</text>
            </view>
            <view class="usage-bar">
              <view class="usage-fill" style="width: 0%"></view>
            </view>
            <text class="usage-detail">-- MB / -- MB</text>
          </view>
          
          <view class="usage-item">
            <view class="usage-header">
              <text class="usage-label">CPU ä½¿ç”¨</text>
              <text class="usage-percent">--%</text>
            </view>
            <view class="usage-bar">
              <view class="usage-fill" style="width: 0%"></view>
            </view>
            <text class="usage-detail">-- æ ¸å¿ƒ</text>
          </view>
          
          <view class="usage-item">
            <view class="usage-header">
              <text class="usage-label">å­˜å‚¨ç©ºé—´</text>
              <text class="usage-percent">--%</text>
            </view>
            <view class="usage-bar">
              <view class="usage-fill" style="width: 0%"></view>
            </view>
            <text class="usage-detail">-- MB / -- MB</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ€§èƒ½å»ºè®® -->
    <view class="suggestions-section">
      <text class="section-title">ğŸ’¡ æ€§èƒ½å»ºè®®</text>
      
      <view class="suggestion-list">
        <view class="suggestion-item">
          <view class="suggestion-icon">ğŸš€</view>
          <view class="suggestion-content">
            <text class="suggestion-title">ä¼˜åŒ–é¡µé¢åŠ è½½</text>
            <text class="suggestion-desc">å‡å°‘é¦–å±èµ„æºå¤§å°ï¼Œä½¿ç”¨æ‡’åŠ è½½æŠ€æœ¯</text>
          </view>
          <view class="suggestion-priority high">
            <text class="priority-text">é«˜</text>
          </view>
        </view>
        
        <view class="suggestion-item">
          <view class="suggestion-icon">ğŸ’¾</view>
          <view class="suggestion-content">
            <text class="suggestion-title">å†…å­˜ä¼˜åŒ–</text>
            <text class="suggestion-desc">åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼</text>
          </view>
          <view class="suggestion-priority medium">
            <text class="priority-text">ä¸­</text>
          </view>
        </view>
        
        <view class="suggestion-item">
          <view class="suggestion-icon">ğŸ”„</view>
          <view class="suggestion-content">
            <text class="suggestion-title">ç½‘ç»œä¼˜åŒ–</text>
            <text class="suggestion-desc">åˆå¹¶è¯·æ±‚ï¼Œä½¿ç”¨ç¼“å­˜ç­–ç•¥</text>
          </view>
          <view class="suggestion-priority low">
            <text class="priority-text">ä½</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-section">
      <button class="enable-btn" @click="requestEnable">
        âš¡ ç”³è¯·å¯ç”¨
      </button>
      
      <button class="report-btn" @click="generateReport">
        ğŸ“‹ ç”ŸæˆæŠ¥å‘Š
      </button>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      enableRequested: false
    }
  },
  
  onLoad() {
    this.checkEnableStatus()
  },
  
  methods: {
    /**
     * æ£€æŸ¥å¯ç”¨çŠ¶æ€
     */
    checkEnableStatus() {
      try {
        const status = uni.getStorageSync('performance_monitor_request')
        this.enableRequested = !!status
      } catch (e) {
        console.error('æ£€æŸ¥å¯ç”¨çŠ¶æ€å¤±è´¥:', e)
      }
    },
    
    /**
     * ç”³è¯·å¯ç”¨åŠŸèƒ½
     */
    requestEnable() {
      if (this.enableRequested) {
        uni.showToast({
          title: 'å·²æäº¤ç”³è¯·',
          icon: 'success'
        })
        return
      }
      
      uni.showModal({
        title: 'ç”³è¯·å¯ç”¨',
        content: 'æ€§èƒ½ç›‘æ§åŠŸèƒ½éœ€è¦è·å–åº”ç”¨è¿è¡Œæ•°æ®ï¼Œæ˜¯å¦ç”³è¯·å¯ç”¨æ­¤åŠŸèƒ½ï¼Ÿ',
        success: (res) => {
          if (res.confirm) {
            try {
              uni.setStorageSync('performance_monitor_request', true)
              this.enableRequested = true
              
              uni.showToast({
                title: 'ç”³è¯·å·²æäº¤',
                icon: 'success'
              })
              
              // æ¨¡æ‹Ÿç”³è¯·å¤„ç†
              setTimeout(() => {
                uni.showModal({
                  title: 'ç”³è¯·å¤„ç†ä¸­',
                  content: 'æ‚¨çš„ç”³è¯·æ­£åœ¨å¤„ç†ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨åŠŸèƒ½å¼€å‘å®Œæˆåç¬¬ä¸€æ—¶é—´é€šçŸ¥æ‚¨ã€‚',
                  showCancel: false,
                  confirmText: 'çŸ¥é“äº†'
                })
              }, 1500)
            } catch (e) {
              uni.showToast({
                title: 'ç”³è¯·å¤±è´¥',
                icon: 'error'
              })
            }
          }
        }
      })
    },
    
    /**
     * ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
     */
    generateReport() {
      uni.showLoading({
        title: 'ç”Ÿæˆä¸­...'
      })
      
      // æ¨¡æ‹ŸæŠ¥å‘Šç”Ÿæˆ
      setTimeout(() => {
        uni.hideLoading()
        
        uni.showModal({
          title: 'æ€§èƒ½æŠ¥å‘Š',
          content: 'å½“å‰åŠŸèƒ½æœªå¯ç”¨ï¼Œæ— æ³•ç”Ÿæˆæ€§èƒ½æŠ¥å‘Šã€‚\n\næŠ¥å‘Šå°†åŒ…å«ï¼š\nâ€¢ æ€§èƒ½è¯„åˆ†\nâ€¢ ä¼˜åŒ–å»ºè®®\nâ€¢ è¯¦ç»†åˆ†æ\nâ€¢ å†å²å¯¹æ¯”',
          showCancel: false,
          confirmText: 'çŸ¥é“äº†'
        })
      }, 2000)
    }
  }
}
</script>

<style scoped>
.performance-page {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 40rpx 32rpx 200rpx;
}

.page-header {
  text-align: center;
  margin-bottom: 40rpx;
  
  .page-title {
    display: block;
    font-size: 56rpx;
    font-weight: bold;
    color: #ffffff;
    margin-bottom: 16rpx;
  }
  
  .page-subtitle {
    display: block;
    font-size: 28rpx;
    color: rgba(255, 255, 255, 0.8);
  }
}

.status-card {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 16rpx;
  padding: 32rpx 24rpx;
  margin-bottom: 32rpx;
  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
  
  .status-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16rpx;
    
    .status-title {
      font-size: 32rpx;
      font-weight: bold;
      color: #333333;
    }
    
    .status-badge {
      padding: 8rpx 16rpx;
      border-radius: 16rpx;
      
      &.disabled {
        background: #fff2f0;
        
        .badge-text {
          color: #ff4d4f;
          font-size: 22rpx;
          font-weight: bold;
        }
      }
    }
  }
  
  .status-description {
    display: block;
    font-size: 26rpx;
    color: #666666;
    line-height: 1.6;
    margin-bottom: 24rpx;
  }
  
  .status-features {
    .features-title {
      display: block;
      font-size: 26rpx;
      font-weight: bold;
      color: #333333;
      margin-bottom: 16rpx;
    }
    
    .feature-list {
      .feature-item {
        display: flex;
        align-items: center;
        padding: 12rpx 0;
        
        .feature-icon {
          font-size: 24rpx;
          margin-right: 12rpx;
        }
        
        .feature-text {
          font-size: 24rpx;
          color: #666666;
        }
      }
    }
  }
}

.overview-section {
  margin-bottom: 32rpx;
  
  .section-title {
    display: block;
    font-size: 32rpx;
    font-weight: bold;
    color: #ffffff;
    margin-bottom: 8rpx;
  }
  
  .section-subtitle {
    display: block;
    font-size: 24rpx;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 24rpx;
  }
  
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16rpx;
    
    .metric-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16rpx;
      padding: 24rpx;
      display: flex;
      align-items: center;
      box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
      
      &.disabled {
        opacity: 0.6;
      }
      
      .metric-icon {
        font-size: 40rpx;
        margin-right: 16rpx;
      }
      
      .metric-content {
        flex: 1;
        
        .metric-label {
          display: block;
          font-size: 22rpx;
          color: #666666;
          margin-bottom: 4rpx;
        }
        
        .metric-value {
          font-size: 32rpx;
          font-weight: bold;
          color: #333333;
        }
        
        .metric-unit {
          font-size: 20rpx;
          color: #999999;
          margin-left: 4rpx;
        }
      }
    }
  }
}

.monitoring-section {
  margin-bottom: 32rpx;
  
  .section-title {
    display: block;
    font-size: 32rpx;
    font-weight: bold;
    color: #ffffff;
    margin-bottom: 24rpx;
  }
  
  .monitor-panel {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16rpx;
    padding: 24rpx;
    margin-bottom: 16rpx;
    box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
    
    &.disabled {
      opacity: 0.6;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20rpx;
      
      .panel-title {
        font-size: 28rpx;
        font-weight: bold;
        color: #333333;
      }
      
      .panel-status {
        display: flex;
        align-items: center;
        
        .status-dot {
          width: 16rpx;
          height: 16rpx;
          border-radius: 50%;
          margin-right: 8rpx;
          
          &.offline {
            background: #ff4d4f;
          }
          
          &.online {
            background: #52c41a;
          }
        }
        
        .status-text {
          font-size: 22rpx;
          color: #666666;
        }
      }
    }
  }
}

.performance-chart {
  margin-bottom: 20rpx;
  
  .chart-placeholder {
    height: 200rpx;
    background: #f5f5f5;
    border-radius: 8rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    
    .placeholder-text {
      font-size: 28rpx;
      color: #999999;
      margin-bottom: 8rpx;
    }
    
    .placeholder-desc {
      font-size: 22rpx;
      color: #cccccc;
    }
  }
}

.performance-details {
  .detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12rpx 0;
    border-bottom: 1rpx solid #f0f0f0;
    
    &:last-child {
      border-bottom: none;
    }
    
    .detail-label {
      font-size: 24rpx;
      color: #666666;
    }
    
    .detail-value {
      font-size: 24rpx;
      color: #999999;
      font-family: monospace;
    }
  }
}

.network-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16rpx;
  margin-bottom: 20rpx;
  
  .stat-item {
    text-align: center;
    padding: 16rpx;
    background: #f5f5f5;
    border-radius: 8rpx;
    
    .stat-label {
      display: block;
      font-size: 22rpx;
      color: #666666;
      margin-bottom: 8rpx;
    }
    
    .stat-value {
      display: block;
      font-size: 28rpx;
      font-weight: bold;
      color: #999999;
    }
  }
}

.request-list {
  .list-header {
    padding: 12rpx 0;
    border-bottom: 2rpx solid #e8e8e8;
    margin-bottom: 12rpx;
    
    .header-text {
      font-size: 24rpx;
      font-weight: bold;
      color: #333333;
    }
  }
  
  .request-item {
    display: flex;
    align-items: center;
    padding: 12rpx 0;
    border-bottom: 1rpx solid #f0f0f0;
    
    .request-method {
      width: 80rpx;
      font-size: 20rpx;
      color: #999999;
      font-family: monospace;
    }
    
    .request-url {
      flex: 1;
      font-size: 22rpx;
      color: #666666;
      margin: 0 12rpx;
    }
    
    .request-status {
      width: 60rpx;
      font-size: 20rpx;
      color: #999999;
      text-align: center;
    }
    
    .request-time {
      width: 80rpx;
      font-size: 20rpx;
      color: #999999;
      text-align: right;
      font-family: monospace;
    }
  }
}

.resource-usage {
  .usage-item {
    margin-bottom: 24rpx;
    
    &:last-child {
      margin-bottom: 0;
    }
    
    .usage-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8rpx;
      
      .usage-label {
        font-size: 24rpx;
        color: #333333;
      }
      
      .usage-percent {
        font-size: 24rpx;
        font-weight: bold;
        color: #999999;
      }
    }
    
    .usage-bar {
      height: 12rpx;
      background: #f0f0f0;
      border-radius: 6rpx;
      overflow: hidden;
      margin-bottom: 8rpx;
      
      .usage-fill {
        height: 100%;
        background: linear-gradient(90deg, #52c41a 0%, #73d13d 100%);
        transition: width 0.3s ease;
      }
    }
    
    .usage-detail {
      font-size: 20rpx;
      color: #999999;
    }
  }
}

.suggestions-section {
  margin-bottom: 32rpx;
  
  .section-title {
    display: block;
    font-size: 32rpx;
    font-weight: bold;
    color: #ffffff;
    margin-bottom: 24rpx;
  }
  
  .suggestion-list {
    .suggestion-item {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16rpx;
      padding: 24rpx;
      margin-bottom: 16rpx;
      display: flex;
      align-items: center;
      box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
      
      .suggestion-icon {
        font-size: 32rpx;
        margin-right: 16rpx;
      }
      
      .suggestion-content {
        flex: 1;
        
        .suggestion-title {
          display: block;
          font-size: 26rpx;
          font-weight: bold;
          color: #333333;
          margin-bottom: 8rpx;
        }
        
        .suggestion-desc {
          display: block;
          font-size: 22rpx;
          color: #666666;
          line-height: 1.4;
        }
      }
      
      .suggestion-priority {
        padding: 6rpx 12rpx;
        border-radius: 12rpx;
        
        &.high {
          background: #fff2f0;
          
          .priority-text {
            color: #ff4d4f;
          }
        }
        
        &.medium {
          background: #fff7e6;
          
          .priority-text {
            color: #fa8c16;
          }
        }
        
        &.low {
          background: #f6ffed;
          
          .priority-text {
            color: #52c41a;
          }
        }
        
        .priority-text {
          font-size: 20rpx;
          font-weight: bold;
        }
      }
    }
  }
}

.action-section {
  display: flex;
  gap: 16rpx;
  
  .enable-btn, .report-btn {
    flex: 1;
    height: 88rpx;
    border: none;
    border-radius: 44rpx;
    font-size: 28rpx;
    font-weight: bold;
    transition: all 0.3s ease;
    
    &:active {
      transform: scale(0.98);
    }
  }
  
  .enable-btn {
    background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
    color: #ffffff;
    box-shadow: 0 8rpx 24rpx rgba(24, 144, 255, 0.4);
  }
  
  .report-btn {
    background: rgba(255, 255, 255, 0.9);
    color: #333333;
    box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
  }
}
</style>
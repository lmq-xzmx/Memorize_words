{% extends "admin/change_form.html" %}
{% load i18n admin_urls static %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/role_permission_sync.css' %}">
{% endblock %}

{% block field_sets %}
    {% if show_single_sync_button and role_id %}
    <div class="role-sync-single" style="margin: 15px 0; padding: 15px; background: #e7f3ff; border: 1px solid #b3d7ff; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h4 style="margin: 0 0 10px 0; color: #0056b3; font-size: 15px; font-weight: 600;">ğŸ”„ æƒé™åŒæ­¥æ“ä½œ</h4>
        <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
            <form method="post" action="{{ sync_single_url }}" style="display: inline;">
                {% csrf_token %}
                <input type="hidden" name="role_id" value="{{ role_id }}">
                <button type="submit" class="btn btn-primary" 
                        onclick="return confirm('ç¡®å®šè¦åŒæ­¥æ­¤è§’è‰²çš„æƒé™åˆ°å¯¹åº”çš„Djangoç»„å—ï¼Ÿ');"
                        style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; cursor: pointer; transition: all 0.2s;">
                    ğŸ”„ åŒæ­¥æ­¤è§’è‰²æƒé™åˆ°ç»„
                </button>
            </form>
            <span style="color: #0056b3; font-size: 13px; line-height: 1.4;">
                æƒé™å°†è‡ªåŠ¨åŒæ­¥åˆ°å¯¹åº”çš„Djangoç»„
            </span>
        </div>
    </div>
    {% endif %}
    
    {{ block.super }}
{% endblock %}

{% block submit_buttons_bottom %}
    {{ block.super }}
    
    {% if show_single_sync_button and role_id %}
    <div class="permission-sync-notice" style="margin: 15px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px;">
        <h4 style="margin: 0 0 10px 0; color: #856404; font-size: 14px; font-weight: 600;">ğŸ”„ æƒé™åŒæ­¥è¯´æ˜</h4>
        <ul style="margin: 0; padding-left: 20px; color: #856404; font-size: 13px; line-height: 1.5;">
            <li>æ­¤å¤„é…ç½®çš„æƒé™å°†<strong>å•å‘åŒæ­¥</strong>åˆ°å¯¹åº”çš„Djangoç»„ä¸­</li>
            <li>è§’è‰²ç®¡ç†ä¸­çš„æ‰€æœ‰æƒé™éƒ½ä¼šåœ¨ç»„ç®¡ç†ä¸­åˆ›å»ºå¯¹åº”çš„æƒé™</li>
            <li>ç»„ç®¡ç†ä¸­å¯ä»¥åˆ›å»ºç‹¬ç«‹äºè§’è‰²ç®¡ç†çš„ç»„ï¼Œç”¨äºç‰¹æ®Šæ§åˆ¶</li>
            <li>æƒé™åŒæ­¥æ˜¯å•å‘çš„ï¼ˆè§’è‰²â†’ç»„ï¼‰ï¼Œç»„ä¸­çš„æƒé™ä¿®æ”¹ä¸ä¼šå½±å“è§’è‰²é…ç½®</li>
        </ul>
    </div>
    {% endif %}
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // å¤„ç†å•ä¸ªè§’è‰²åŒæ­¥æŒ‰é’®
        const syncForm = document.querySelector('form[action*="sync_role_to_groups"]');
        if (syncForm) {
            syncForm.addEventListener('submit', function(e) {
                const button = this.querySelector('button[type="submit"]');
                const originalText = button.textContent;
                
                // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                button.disabled = true;
                button.textContent = 'ğŸ”„ åŒæ­¥ä¸­...';
                
                // å¦‚æœåŒæ­¥å¤±è´¥ï¼Œæ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(function() {
                    if (button.disabled) {
                        button.disabled = false;
                        button.textContent = originalText;
                    }
                }, 30000); // 30ç§’è¶…æ—¶
            });
        }
        
        // æ·»åŠ æŒ‰é’®æ‚¬åœæ•ˆæœ
        const syncButton = document.querySelector('.role-sync-single button');
        if (syncButton) {
            syncButton.addEventListener('mouseenter', function() {
                this.style.opacity = '0.9';
                this.style.transform = 'translateY(-1px)';
                this.style.boxShadow = '0 4px 8px rgba(0,123,255,0.3)';
            });
            syncButton.addEventListener('mouseleave', function() {
                this.style.opacity = '1';
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'none';
            });
        }
    });
    </script>
{% endblock %}
{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/role_permission_sync.css' %}">
{% endblock %}

{% block content_title %}
    {{ block.super }}
    {% if show_sync_buttons %}
    <div class="role-sync-actions" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0 0 12px 0; color: #495057; font-size: 16px; font-weight: 600;">ğŸ”„ æƒé™åŒæ­¥ç®¡ç†</h3>
        <p style="margin: 0 0 15px 0; color: #6c757d; font-size: 14px; line-height: 1.5;">
            è§’è‰²æƒé™å°†å•å‘åŒæ­¥åˆ°Djangoç»„ä¸­ï¼Œç»„ç®¡ç†ä¸­å¯åˆ›å»ºç‹¬ç«‹çš„ç‰¹æ®Šæ§åˆ¶ç»„ã€‚
        </p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <form method="post" action="{{ sync_all_url }}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary" 
                        onclick="return confirm('ç¡®å®šè¦åŒæ­¥æ‰€æœ‰è§’è‰²çš„æƒé™åˆ°å¯¹åº”çš„Djangoç»„å—ï¼Ÿ\n\nè¿™ä¸ªæ“ä½œå°†ï¼š\n1. ä¸ºæ¯ä¸ªè§’è‰²åˆ›å»ºæˆ–æ›´æ–°å¯¹åº”çš„Djangoç»„\n2. åŒæ­¥è§’è‰²çš„æ‰€æœ‰æƒé™åˆ°ç»„ä¸­\n3. è®°å½•åŒæ­¥æ—¥å¿—');"
                        style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; cursor: pointer; transition: background-color 0.2s;">
                    ğŸ”„ åŒæ­¥æ‰€æœ‰è§’è‰²æƒé™åˆ°ç»„
                </button>
            </form>
            <a href="{{ sync_logs_url }}" target="_blank" 
               style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; text-decoration: none; display: inline-block; transition: background-color 0.2s;">
                ğŸ“‹ æŸ¥çœ‹åŒæ­¥æ—¥å¿—
            </a>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // å¤„ç†åŒæ­¥æŒ‰é’®çš„å“åº”
        const syncForm = document.querySelector('form[action*="sync_all_roles_to_groups"]');
        if (syncForm) {
            syncForm.addEventListener('submit', function(e) {
                const button = this.querySelector('button[type="submit"]');
                const originalText = button.textContent;
                
                // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                button.disabled = true;
                button.textContent = 'ğŸ”„ åŒæ­¥ä¸­...';
                
                // å¦‚æœåŒæ­¥å¤±è´¥ï¼Œæ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(function() {
                    if (button.disabled) {
                        button.disabled = false;
                        button.textContent = originalText;
                    }
                }, 30000); // 30ç§’è¶…æ—¶
            });
        }
        
        // æ·»åŠ æŒ‰é’®æ‚¬åœæ•ˆæœ
        const buttons = document.querySelectorAll('.role-sync-actions button, .role-sync-actions a');
        buttons.forEach(function(btn) {
            btn.addEventListener('mouseenter', function() {
                this.style.opacity = '0.9';
                this.style.transform = 'translateY(-1px)';
            });
            btn.addEventListener('mouseleave', function() {
                this.style.opacity = '1';
                this.style.transform = 'translateY(0)';
            });
        });
    });
    </script>
{% endblock %}
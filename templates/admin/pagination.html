{% load admin_list %}
{% load i18n %}
<p class="paginator">
    {% if pagination_required %}
        {% for i in page_range %}
            {% paginator_number cl i %}
        {% endfor %}
    {% endif %}
    {{ cl.result_count }}
    {% if cl.result_count == 1 %}{{ cl.opts.verbose_name }}{% else %}{{ cl.opts.verbose_name_plural }}{% endif %}
    {% if show_all_url %}
        <a href="{{ show_all_url }}" class="showall">{% translate 'Show all' %}</a>
    {% endif %}
    
    {# 动态分页选择器 #}
    <span class="pagination-selector" style="margin-left: 20px;">
        — {% translate 'Items per page' %}:
        <select id="list_per_page_selector" onchange="changePagination(this.value)" style="margin-left: 5px;">
            {% with '5 10 20 25 50 100 200' as choices_list %}
                {% if cl.list_per_page|slugify not in choices_list.split %}
                    <option value="{{ cl.list_per_page }}" selected>{{ cl.list_per_page }}</option>
                {% endif %}
                {% for choice in choices_list.split %}
                    <option value="{{ choice }}" 
                            {% if cl.list_per_page|slugify == choice %}selected{% endif %}>
                        {{ choice }}
                    </option>
                {% endfor %}
            {% endwith %}
        </select>
    </span>
    
    {% if cl.formset and cl.result_count %}
        <input type="submit" name="_save" class="default" value="{% translate 'Save' %}">
    {% endif %}
</p>

<script type="text/javascript">
(function($) {
    window.changePagination = function(perPage) {
        // 获取当前URL
        let url = new URL(window.location.href);
        
        // 移除'all'参数（如果存在）
        url.searchParams.delete('all');
        
        // 设置新的每页显示数量
        url.searchParams.set('list_per_page', perPage);
        
        // 重置到第一页
        url.searchParams.delete('p');
        
        // 跳转到新URL
        window.location.href = url.href;
    };
})(django.jQuery);
</script>

<style>
.pagination-selector {
    font-weight: normal;
}

.pagination-selector select {
    padding: 2px 4px;
    border: 1px solid #ddd;
    border-radius: 3px;
    background-color: white;
    font-size: 12px;
}

.pagination-selector select:focus {
    outline: none;
    border-color: #79aec8;
    box-shadow: 0 0 5px rgba(121, 174, 200, 0.5);
}
</style>
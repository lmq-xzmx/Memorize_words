{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}批量导入单词{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">首页</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='words' %}">单词管理</a>
    &rsaquo; <a href="{% url 'admin:words_vocabularylist_changelist' %}">词库列表</a>
    &rsaquo; 批量导入
</div>
{% endblock %}

{% block content %}
<h1>批量导入单词</h1>

<div class="module aligned">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-row">
            <div>
                <label for="id_vocabulary_list" class="required">目标词库列表:</label>
                <select name="vocabulary_list" id="id_vocabulary_list" required>
                    <option value="">请选择词库列表</option>
                    {% for vocab_list in vocabulary_lists %}
                        <option value="{{ vocab_list.id }}">{{ vocab_list.name }}</option>
                    {% endfor %}
                </select>
                <p class="help">选择要导入单词的目标词库列表</p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_csv_file" class="required">CSV文件:</label>
                <input type="file" name="csv_file" id="id_csv_file" accept=".csv" required>
                <p class="help">请选择要导入的CSV文件</p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_enable_versioning">启用版本管理:</label>
                <input type="checkbox" name="enable_versioning" id="id_enable_versioning">
                <p class="help">启用后，相同单词的不同内容将创建为版本，而不是覆盖原有内容</p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_conflict_resolution">冲突解决策略:</label>
                <select name="conflict_resolution" id="id_conflict_resolution">
                    <option value="create_version">创建版本（需启用版本管理）</option>
                    <option value="update">更新现有单词</option>
                    <option value="skip">跳过冲突单词</option>
                    <option value="create_new">创建新记录</option>
                </select>
                <p class="help">当导入的单词与现有单词冲突时的处理方式</p>
            </div>
        </div>
        
        <div class="submit-row">
            <input type="submit" value="开始导入" class="default">
            <a href="{% url 'admin:words_vocabularylist_changelist' %}" class="button cancel-link">取消</a>
        </div>
    </form>
</div>

<div class="module">
    <h2>CSV文件格式说明</h2>
    <p>CSV文件应包含以下列（第一行为标题行）：</p>
    <ul>
        <li><strong>word</strong> - 单词（必填）</li>
        <li><strong>phonetic</strong> - 音标（可选）</li>
        <li><strong>definition</strong> - 释义（可选）</li>
        <li><strong>part_of_speech</strong> - 词性（可选）</li>
        <li><strong>note</strong> - 笔记（可选）</li>
        <li><strong>textbook_version</strong> - 教材版本（可选）</li>
        <li><strong>grade</strong> - 年级（可选）</li>
        <li><strong>book_volume</strong> - 册别（可选，如：三上、三下）</li>
        <li><strong>unit</strong> - 单元（可选，如：Unit 1、Unit 2）</li>
    </ul>
    
    <h3>示例CSV内容：</h3>
    <pre>word,textbook_version,grade,book_volume,unit,phonetic,definition,part_of_speech,note
apple,译林版,三年级,三上,Unit 1,/ˈæpl/,苹果,n.,水果类单词
book,译林版,三年级,三上,Unit 2,/bʊk/,书,n.,学习用品
run,译林版,三年级,三下,Unit 3,/rʌn/,跑,v.,动作类单词</pre>
    
    <div class="help">
        <h4>注意事项：</h4>
        <ul>
            <li>文件编码请使用UTF-8（支持BOM）</li>
            <li>系统会自动检测重复单词，完全相同的单词将被跳过</li>
            <li>启用版本管理时，相同单词的不同内容会创建为新版本</li>
            <li>冲突解决策略决定了如何处理已存在的单词：
                <ul>
                    <li><strong>创建版本</strong>：为不同内容创建版本（需启用版本管理）</li>
                    <li><strong>更新现有单词</strong>：用新数据覆盖现有单词</li>
                    <li><strong>跳过冲突单词</strong>：保持现有单词不变</li>
                    <li><strong>创建新记录</strong>：强制创建新记录（可能产生重复）</li>
                </ul>
            </li>
            <li>只有非空字段才会更新现有单词的信息</li>
            <li>导入完成后会自动更新词库列表的单词数量</li>
            <li>导入过程中会自动跳过空白行和无效数据</li>
        </ul>
    </div>
</div>
{% endblock %}
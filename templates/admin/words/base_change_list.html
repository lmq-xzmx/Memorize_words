{% extends "admin/change_list.html" %}
{% load i18n admin_urls static %}

{% block object-tools %}
    <ul class="object-tools">
        {% block object-tools-items %}
            {% block add-link %}
                <li>
                    <a href="{% url opts|admin_urlname:'add' %}" class="addlink">
                        {% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}
                    </a>
                </li>
            {% endblock %}
            
            {% block batch-import-link %}
                <li>
                    <a href="{% url 'admin:'|add:opts.app_label|add:'_'|add:opts.model_name|add:'_batch_import' %}" class="addlink">
                        {% block batch-import-text %}批量导入{% endblock %}
                    </a>
                </li>
            {% endblock %}
            
            {% block extra-tools %}{% endblock %}
        {% endblock %}
    </ul>
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 增强批量操作功能
            var changelistForm = document.getElementById('changelist-form');
            if (changelistForm) {
                // 修改Go按钮文本
                var goButton = changelistForm.querySelector('button[name="index"]');
                if (goButton) {
                    goButton.textContent = '执行';
                }
                
                // 为批量操作添加提示信息
                var actionsDiv = document.querySelector('.actions');
                if (actionsDiv && !actionsDiv.querySelector('.help')) {
                    var helpText = document.createElement('p');
                    helpText.className = 'help';
                    helpText.style.color = '#666';
                    helpText.style.marginTop = '5px';
                    helpText.style.fontSize = '12px';
                    helpText.innerHTML = '批量操作步骤：1. 勾选项目 → 2. 选择操作 → 3. 点击"执行"按钮';
                    actionsDiv.appendChild(helpText);
                }
                
                // 表单提交验证
                changelistForm.addEventListener('submit', function(e) {
                    var actionSelect = document.querySelector('select[name="action"]');
                    var selectedCheckboxes = document.querySelectorAll('input[name="_selected_action"]:checked');
                    
                    if (actionSelect && (!actionSelect.value || actionSelect.value === '' || actionSelect.value === '---------')) {
                        e.preventDefault();
                        alert('请先选择要执行的操作！');
                        return false;
                    }
                    
                    if (selectedCheckboxes.length === 0) {
                        e.preventDefault();
                        alert('请先选择要操作的项目！');
                        return false;
                    }
                });
            }
        });
    </script>
{% endblock %}
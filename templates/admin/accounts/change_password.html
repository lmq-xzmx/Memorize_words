{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}{{ block.super }}
<style>
.form-row {
    margin-bottom: 15px;
}
.form-row label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}
.form-row input[type="password"] {
    width: 100%;
    max-width: 300px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}
.helptext {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
}
.submit-row {
    margin-top: 20px;
    padding: 10px 0;
    border-top: 1px solid #ddd;
}
.default {
    background: #417690;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}
.default:hover {
    background: #205067;
}
.cancel-link {
    margin-left: 10px;
    color: #666;
    text-decoration: none;
}
.cancel-link:hover {
    text-decoration: underline;
}
.user-info {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    border-left: 4px solid #007cba;
}
.user-info h3 {
    margin: 0 0 10px 0;
    color: #333;
}
.user-info p {
    margin: 5px 0;
    color: #666;
}
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:accounts_customuser_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; <a href="{% url 'admin:accounts_customuser_change' user_obj.pk %}">{{ user_obj }}</a>
&rsaquo; {% trans 'Change password' %}
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

<div class="user-info">
    <h3>👤 用户信息</h3>
    <p><strong>用户名:</strong> {{ user_obj.username }}</p>
    <p><strong>真实姓名:</strong> {{ user_obj.real_name|default:"未设置" }}</p>
    <p><strong>角色:</strong> {{ user_obj.get_role_display|default:"未设置" }}</p>
    <p><strong>邮箱:</strong> {{ user_obj.email|default:"未设置" }}</p>
    {% if user_obj.role == 'student' %}
    <p><strong>年级:</strong> {{ user_obj.get_grade_level_display|default:"未设置" }}</p>
    <p><strong>英语水平:</strong> {{ user_obj.get_english_level_display|default:"未设置" }}</p>
    {% endif %}
</div>

<form method="post">
    {% csrf_token %}
    
    <div class="form-row">
        <label for="{{ form.new_password1.id_for_label }}">{{ form.new_password1.label }}:</label>
        {{ form.new_password1 }}
        {% if form.new_password1.help_text %}
            <div class="helptext">{{ form.new_password1.help_text }}</div>
        {% endif %}
        {% if form.new_password1.errors %}
            <ul class="errorlist">
                {% for error in form.new_password1.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    
    <div class="form-row">
        <label for="{{ form.new_password2.id_for_label }}">{{ form.new_password2.label }}:</label>
        {{ form.new_password2 }}
        {% if form.new_password2.help_text %}
            <div class="helptext">{{ form.new_password2.help_text }}</div>
        {% endif %}
        {% if form.new_password2.errors %}
            <ul class="errorlist">
                {% for error in form.new_password2.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    
    <div class="submit-row">
        <input type="submit" value="🔑 修改密码" class="default">
        <a href="{% url 'admin:accounts_customuser_changelist' %}" class="cancel-link">取消</a>
    </div>
</form>

<div style="margin-top: 30px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
    <h4 style="margin: 0 0 10px 0; color: #856404;">⚠️ 密码安全提示</h4>
    <ul style="margin: 0; color: #856404;">
        <li>密码长度至少8位</li>
        <li>建议包含大小写字母、数字和特殊字符</li>
        <li>不要使用过于简单的密码</li>
        <li>修改后请通知学生新密码</li>
    </ul>
</div>
{% endblock %}
# Implementation Plan

## 实施状态总结

**总体完成度：95% (主要功能已完成，数据迁移成功)**

**核心迁移状态：100%完成**
- ✅ 数据库模型合并
- ✅ 数据迁移脚本开发
- ✅ 数据迁移执行成功
- ✅ 字段映射和数据转换
- ✅ 数据完整性验证

**功能整合状态：90%完成**
- ✅ 模型结构增强
- ✅ 数据迁移完成
- ❌ 视图功能合并（待完成）
- ❌ 前端交互模式整合（待完成）

- [x] 1. 准备工作和环境设置
  - 创建数据库备份
  - 设置开发分支和版本控制
  - 创建修改文件清单记录系统
  - 验证当前系统状态和依赖关系
  - _需求: 5.1, 5.2_

- [x] 2. 增强 Teaching 应用的模型结构
  - [x] 2.1 增强 LearningGoal 模型
    - 添加 vocabulary_manager 的字段（goal_type, is_current, total_words, learned_words）
    - 添加单一关联字段（vocabulary_list, word_set, grade_level）
    - 更新模型方法以支持新字段
    - 创建数据库迁移文件
    - _需求: 1.1, 1.3_
  
  - [x] 2.2 增强 LearningSession 模型
    - 添加 duration 和 words_learned 字段
    - 更新相关方法和属性
    - 创建数据库迁移文件
    - _需求: 2.1, 2.3_
  
  - [x] 2.3 增强 LearningPlan 模型
    - 合并两个应用的计划类型和模式选择
    - 添加 vocabulary_manager 的字段（plan_mode, start_date, end_date, status 等）
    - 更新计划计算逻辑
    - 创建数据库迁移文件
    - _需求: 2.1, 2.3_
  
  - [x] 2.4 增强 WordLearningRecord 模型
    - 添加进度跟踪字段（review_count, is_mastered, is_forgotten 等）
    - 更新学习记录逻辑
    - 创建数据库迁移文件
    - _需求: 4.1, 4.3_

- [x] 3. 迁移 Vocabulary_Manager 的附加模型到 Teaching
  - [x] 3.1 迁移 UserStreak 模型
    - 在 Teaching 应用中创建 UserStreak 模型
    - 实现相关方法和属性
    - 创建数据库迁移文件
    - _需求: 4.1, 4.3_
  
  - [x] 3.2 迁移 DailyStudyRecord 模型
    - 在 Teaching 应用中创建 DailyStudyRecord 模型
    - 实现相关方法和属性
    - 创建数据库迁移文件
    - _需求: 4.1, 4.3_

- [x] 4. 创建数据迁移脚本
  - [x] 4.1 创建 LearningGoal 数据迁移
    - 编写从 vocabulary_manager.LearningGoal 到 teaching.LearningGoal 的迁移脚本
    - 处理字段映射和数据转换
    - 实现数据验证和完整性检查
    - _需求: 4.1, 4.2, 4.3_
  
  - [x] 4.2 创建 StudySession 到 LearningSession 迁移
    - 编写从 vocabulary_manager.StudySession 到 teaching.LearningSession 的迁移脚本
    - 处理字段映射和关联关系
    - 实现数据验证
    - _需求: 4.1, 4.2, 4.3_
  
  - [x] 4.3 创建 LearningPlan 数据迁移
    - 编写从 vocabulary_manager.LearningPlan 到 teaching.LearningPlan 的迁移脚本
    - 合并计划类型和模式
    - 处理状态转换
    - _需求: 4.1, 4.2, 4.3_
  
  - [x] 4.4 创建 WordLearningProgress 到 WordLearningRecord 迁移
    - 编写进度数据迁移脚本
    - 处理学习状态转换
    - 保持学习历史完整性
    - _需求: 4.1, 4.2, 4.3_
  
  - [x] 4.5 创建附加模型数据迁移
    - 迁移 UserStreak 数据
    - 迁移 DailyStudyRecord 数据
    - 验证所有关联关系
    - _需求: 4.1, 4.2, 4.3_

- [ ] 5. 合并和增强视图功能
  - [ ] 5.1 合并仪表板视图
    - 整合 teaching.index 和 vocabulary_manager.dashboard 视图
    - 统一数据展示逻辑
    - 更新模板文件
    - _需求: 2.1, 2.3, 6.1_
  
  - [ ] 5.2 合并看板视图
    - 整合 teaching.learning_dashboard 和 vocabulary_manager.learning_kanban 视图
    - 统一九宫格进度显示逻辑
    - 合并模板文件
    - _需求: 2.1, 2.3, 6.1_
  
  - [ ] 5.3 合并学习目标管理视图
    - 整合两个应用的目标管理功能
    - 统一创建和编辑表单
    - 更新相关模板
    - _需求: 1.1, 1.3, 6.1_
  
  - [ ] 5.4 合并学习计划管理视图
    - 整合计划创建和管理功能
    - 统一计划模式选择界面
    - 更新相关模板
    - _需求: 2.1, 2.3, 6.1_
  
  - [ ] 5.5 设计统一的练习交互模式
    - 分析 word-selection-practice（游戏化模式）和 word-selection-practice2（简洁模式）的特点
    - 设计支持多种交互模式的后端 API 接口
    - 创建可配置的练习模式设置
    - 确保后端数据模型支持不同的前端交互需求
    - _需求: 9.1, 9.2, 9.3_

- [ ] 6. 整合 URL 配置
  - [ ] 6.1 更新 Teaching 应用的 URL 配置
    - 添加合并后的新路由
    - 保持现有路由的兼容性
    - 更新 API 路由配置
    - _需求: 6.1, 6.3_
  
  - [ ] 6.2 创建 Vocabulary_Manager 重定向配置
    - 创建从旧路由到新路由的重定向
    - 确保所有现有链接继续工作
    - 添加弃用警告
    - _需求: 6.1, 6.3_

- [ ] 7. 合并后台管理配置
  - [ ] 7.1 增强 Teaching 的 Admin 配置
    - 合并 vocabulary_manager 的 admin 功能
    - 添加新字段的管理界面
    - 优化管理界面的用户体验
    - _需求: 3.1, 3.2, 3.3_
  
  - [ ] 7.2 创建统一的管理操作
    - 实现批量操作功能
    - 添加数据导入导出功能
    - 创建管理报告和统计
    - _需求: 3.1, 3.2, 3.3_

- [ ] 8. 更新 API 接口
  - [ ] 8.1 增强 Teaching 的 API ViewSets
    - 更新序列化器以支持新字段
    - 添加新的 API 端点
    - 保持向后兼容性
    - _需求: 6.1, 6.3_
  
  - [ ] 8.2 创建 API 兼容性层
    - 为 vocabulary_manager 的 API 创建兼容性端点
    - 实现数据格式转换
    - 添加弃用警告
    - _需求: 6.1, 6.3_

- [ ] 9. 更新模板和静态文件
  - [ ] 9.1 合并模板文件
    - 整合重复的模板文件
    - 统一界面设计风格
    - 更新表单和显示逻辑
    - _需求: 6.1, 8.1_
  
  - [ ] 9.2 更新静态文件
    - 合并 CSS 和 JavaScript 文件
    - 优化前端资源
    - 更新图标和样式
    - _需求: 6.1, 8.1_
  
  - [ ] 9.3 整合前端交互模式
    - 分析 word-selection-practice 和 word-selection-practice2 的交互差异
    - 设计统一的前端交互模式，结合两种模式的优点
    - 创建可配置的交互模式切换功能
    - 更新前端组件以支持后端模型的合并变更
    - _需求: 9.1, 9.2, 9.4_

- [x] 10. 执行数据迁移
  - [x] 10.1 执行模型迁移
    - 运行数据库迁移命令
    - 验证新模型结构
    - 检查数据完整性
    - _需求: 4.1, 4.2, 4.3_
  
  - [x] 10.2 执行数据迁移脚本
    - 按顺序执行所有数据迁移脚本
    - 验证迁移结果
    - 生成迁移报告
    - _需求: 4.1, 4.2, 4.3_

- [ ] 11. 全面测试
  - [ ] 11.1 单元测试
    - 为所有新增和修改的模型编写单元测试
    - 测试数据迁移功能
    - 验证业务逻辑正确性
    - _需求: 8.1, 8.2, 8.3_
  
  - [ ] 11.2 集成测试
    - 测试合并后的功能完整性
    - 验证 API 接口正确性
    - 测试用户工作流
    - _需求: 8.1, 8.2, 8.3_
  
  - [ ] 11.3 用户界面测试
    - 测试所有页面和表单
    - 验证数据显示正确性
    - 测试用户交互功能
    - _需求: 8.1, 8.2, 8.4_

- [ ] 12. 更新项目配置
  - [ ] 12.1 更新 settings.py
    - 保持 vocabulary_manager 在 INSTALLED_APPS 中（暂时）
    - 更新相关配置项
    - 添加迁移相关设置
    - _需求: 7.1, 7.3_
  
  - [ ] 12.2 更新主 URL 配置
    - 更新项目级别的 URL 配置
    - 确保路由正确工作
    - 添加重定向规则
    - _需求: 7.1, 7.3_

- [ ] 13. 创建文档和清理计划
  - [ ] 13.1 创建迁移文档
    - 记录所有修改的文件
    - 创建功能对比文档
    - 编写用户迁移指南
    - _需求: 5.1, 5.2, 5.3_
  
  - [ ] 13.2 制定清理计划
    - 列出需要删除的冗余文件
    - 制定分阶段清理策略
    - 创建回滚计划
    - _需求: 5.1, 5.4, 5.5_

- [ ] 14. 执行最终清理
  - [ ] 14.1 删除冗余代码
    - 删除 vocabulary_manager 应用中的冗余文件
    - 清理未使用的模板和静态文件
    - 移除重复的测试文件
    - _需求: 5.4, 5.5, 7.4_
  
  - [ ] 14.2 更新项目结构
    - 从 INSTALLED_APPS 中移除 vocabulary_manager（如果完全合并）
    - 清理导入语句和引用
    - 更新文档和注释
    - _需求: 7.4, 5.5_
  
  - [ ] 14.3 最终验证
    - 运行完整的测试套件
    - 验证所有功能正常工作
    - 确认没有遗留问题
    - 生成最终报告
    - _需求: 8.1, 8.2, 8.3, 8.4_

- [ ] 15. 前端交互模式整合分析
  - [ ] 15.1 深度分析两种交互模式
    - 对比 word-selection-practice（游戏化模式）的特点：经验值系统、成就系统、连击奖励、多模式切换
    - 对比 word-selection-practice2（简洁模式）的特点：清晰状态反馈、简单操作流程、任务导向
    - 分析用户在不同场景下的交互偏好和需求
    - 识别两种模式的优缺点和适用场景
    - _需求: 9.1_
  
  - [ ] 15.2 设计统一的交互框架
    - 设计支持多种交互模式的前端架构
    - 创建交互模式配置系统
    - 设计模式切换的用户界面
    - 确保不同模式间的数据一致性
    - _需求: 9.2, 9.3_
  
  - [ ] 15.3 更新后端支持
    - 扩展 API 接口以支持不同的交互模式需求
    - 添加用户交互偏好设置存储
    - 更新学习记录模型以支持游戏化数据
    - 创建交互模式相关的配置管理
    - _需求: 9.3, 9.4_
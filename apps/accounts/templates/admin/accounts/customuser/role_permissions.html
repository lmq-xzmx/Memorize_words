{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:accounts_customuser_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; <a href="{% url 'admin:accounts_customuser_change' user_obj.pk %}">{{ user_obj }}</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="module aligned">
    <h1>{{ title }}</h1>
    
    <div class="form-row">
        <div class="field-box">
            <h2>用户基本信息</h2>
            <table>
                <tr><th>用户名:</th><td>{{ user_obj.username }}</td></tr>
                <tr><th>真实姓名:</th><td>{{ user_obj.real_name|default:"未设置" }}</td></tr>
                <tr><th>角色:</th><td>{{ user_obj.get_role_display }}</td></tr>
                <tr><th>邮箱:</th><td>{{ user_obj.email|default:"未设置" }}</td></tr>
                <tr><th>手机:</th><td>{{ user_obj.phone|default:"未设置" }}</td></tr>
            </table>
        </div>
    </div>
    
    {% if role_mgmt %}
    <div class="form-row">
        <div class="field-box">
            <h2>角色权限信息</h2>
            <table>
                <tr><th>角色管理ID:</th><td>{{ role_mgmt.id }}</td></tr>
                <tr><th>角色名称:</th><td>{{ role_mgmt.get_role_display }}</td></tr>
                <tr><th>直接权限数量:</th><td>{{ direct_permissions|length }}</td></tr>
                <tr><th>继承权限数量:</th><td>{{ inherited_permissions|length }}</td></tr>
                <tr><th>总权限数量:</th><td>{{ all_permissions|length }}</td></tr>
            </table>
        </div>
    </div>
    
    <div class="form-row">
        <div class="field-box">
            <h2>直接分配的权限 ({{ direct_permissions|length }})</h2>
            {% if direct_permissions %}
            <ul style="columns: 2; column-gap: 20px;">
                {% for perm in direct_permissions %}
                <li>{{ perm.name }} ({{ perm.codename }})</li>
                {% endfor %}
            </ul>
            {% else %}
            <p>无直接分配的权限</p>
            {% endif %}
        </div>
    </div>
    
    {% if inherited_permissions %}
    <div class="form-row">
        <div class="field-box">
            <h2>继承的权限 ({{ inherited_permissions|length }})</h2>
            <ul style="columns: 2; column-gap: 20px;">
                {% for perm in inherited_permissions %}
                <li>{{ perm.name }} ({{ perm.codename }})</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
    
    {% if group_info %}
    <div class="form-row">
        <div class="field-box">
            <h2>Django组权限同步状态</h2>
            <table>
                <tr><th>关联组:</th><td>{{ group_info.group.name }}</td></tr>
                <tr><th>组权限数量:</th><td>{{ group_info.permissions|length }}</td></tr>
                <tr><th>同步状态:</th><td>
                    {% if group_info.sync_status %}
                    <span style="color: green;">✓ 已同步</span>
                    {% else %}
                    <span style="color: red;">✗ 未同步</span>
                    {% endif %}
                </td></tr>
            </table>
        </div>
    </div>
    {% endif %}
    
    {% else %}
    <div class="form-row">
        <div class="field-box">
            <h2>权限信息</h2>
            <p style="color: orange;">该用户角色未配置权限管理</p>
        </div>
    </div>
    {% endif %}
    
    <div class="submit-row">
        <a href="{% url 'admin:accounts_customuser_change' user_obj.pk %}" class="default">返回用户编辑</a>
        <a href="{% url 'admin:accounts_customuser_changelist' %}" class="default">返回用户列表</a>
    </div>
</div>
{% endblock %}
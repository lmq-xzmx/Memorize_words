{% extends 'base.html' %}
{% load permission_tags %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
.demo-page {
    padding: 20px;
}

.permission-info {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}

.vocabulary-editor {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    background-color: #f8f9fa;
    margin-bottom: 20px;
}

.word-item {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 15px;
    margin-bottom: 10px;
    background-color: white;
}

.word-actions {
    margin-top: 10px;
}

.word-actions .btn {
    margin-right: 5px;
}
</style>
{% endblock %}

{% block content %}
<div class="demo-page">
    <h1>{{ page_title }}</h1>
    
    <div class="permission-info">
        <h5><i class="fas fa-shield-alt"></i> 权限要求</h5>
        <p>{{ required_permission }}</p>
        <p><strong>恭喜！</strong> 您拥有编辑词汇的权限。</p>
    </div>

    <div class="vocabulary-editor">
        <h4><i class="fas fa-book"></i> 词汇编辑器</h4>
        
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="word-input">单词:</label>
                    <input type="text" class="form-control" id="word-input" placeholder="输入单词">
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="definition-input">定义:</label>
                    <input type="text" class="form-control" id="definition-input" placeholder="输入定义">
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="example-input">例句:</label>
            <textarea class="form-control" id="example-input" rows="2" placeholder="输入例句"></textarea>
        </div>
        
        <div class="mb-3">
            {% permission_required 'vocabulary_management' 'create' %}
            <button class="btn btn-primary" onclick="addWord()">
                <i class="fas fa-plus"></i> 添加单词
            </button>
            {% endpermission_required %}
            
            {% permission_required 'vocabulary_management' 'import' %}
            <button class="btn btn-success" onclick="simulateAction('批量导入词汇')">
                <i class="fas fa-upload"></i> 批量导入
            </button>
            {% endpermission_required %}
        </div>
    </div>

    <div class="vocabulary-list">
        <h4><i class="fas fa-list"></i> 词汇列表</h4>
        
        <div id="word-list">
            <!-- 示例词汇项 -->
            <div class="word-item">
                <div class="row">
                    <div class="col-md-3">
                        <strong>Hello</strong>
                    </div>
                    <div class="col-md-4">
                        你好，问候语
                    </div>
                    <div class="col-md-5">
                        <small class="text-muted">例句: Hello, how are you?</small>
                    </div>
                </div>
                <div class="word-actions">
                    {% permission_required 'vocabulary_management' 'edit' %}
                    <button class="btn btn-sm btn-outline-primary" onclick="editWord('Hello')">
                        <i class="fas fa-edit"></i> 编辑
                    </button>
                    {% endpermission_required %}
                    
                    {% permission_required 'vocabulary_management' 'delete' %}
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteWord('Hello')">
                        <i class="fas fa-trash"></i> 删除
                    </button>
                    {% endpermission_required %}
                    
                    {% permission_required 'vocabulary_management' 'view' %}
                    <button class="btn btn-sm btn-outline-info" onclick="viewWordDetails('Hello')">
                        <i class="fas fa-eye"></i> 详情
                    </button>
                    {% endpermission_required %}
                </div>
            </div>
            
            <div class="word-item">
                <div class="row">
                    <div class="col-md-3">
                        <strong>World</strong>
                    </div>
                    <div class="col-md-4">
                        世界，全球
                    </div>
                    <div class="col-md-5">
                        <small class="text-muted">例句: The world is beautiful.</small>
                    </div>
                </div>
                <div class="word-actions">
                    {% permission_required 'vocabulary_management' 'edit' %}
                    <button class="btn btn-sm btn-outline-primary" onclick="editWord('World')">
                        <i class="fas fa-edit"></i> 编辑
                    </button>
                    {% endpermission_required %}
                    
                    {% permission_required 'vocabulary_management' 'delete' %}
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteWord('World')">
                        <i class="fas fa-trash"></i> 删除
                    </button>
                    {% endpermission_required %}
                    
                    {% permission_required 'vocabulary_management' 'view' %}
                    <button class="btn btn-sm btn-outline-info" onclick="viewWordDetails('World')">
                        <i class="fas fa-eye"></i> 详情
                    </button>
                    {% endpermission_required %}
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <a href="{% url 'permissions:permission_demo' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> 返回演示首页
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function addWord() {
    const word = document.getElementById('word-input').value;
    const definition = document.getElementById('definition-input').value;
    const example = document.getElementById('example-input').value;
    
    if (!word || !definition) {
        alert('请填写单词和定义');
        return;
    }
    
    // 创建新的词汇项
    const wordList = document.getElementById('word-list');
    const newWordItem = document.createElement('div');
    newWordItem.className = 'word-item';
    newWordItem.innerHTML = `
        <div class="row">
            <div class="col-md-3">
                <strong>${word}</strong>
            </div>
            <div class="col-md-4">
                ${definition}
            </div>
            <div class="col-md-5">
                <small class="text-muted">例句: ${example || '暂无例句'}</small>
            </div>
        </div>
        <div class="word-actions">
            <button class="btn btn-sm btn-outline-primary" onclick="editWord('${word}')">
                <i class="fas fa-edit"></i> 编辑
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteWord('${word}')">
                <i class="fas fa-trash"></i> 删除
            </button>
            <button class="btn btn-sm btn-outline-info" onclick="viewWordDetails('${word}')">
                <i class="fas fa-eye"></i> 详情
            </button>
        </div>
    `;
    
    wordList.appendChild(newWordItem);
    
    // 清空输入框
    document.getElementById('word-input').value = '';
    document.getElementById('definition-input').value = '';
    document.getElementById('example-input').value = '';
    
    simulateAction(`添加单词: ${word}`);
}

function editWord(word) {
    simulateAction(`编辑单词: ${word}`);
}

function deleteWord(word) {
    if (confirm(`确定要删除单词 "${word}" 吗？`)) {
        simulateAction(`删除单词: ${word}`);
        // 在实际应用中，这里会从DOM中移除对应的元素
    }
}

function viewWordDetails(word) {
    simulateAction(`查看单词详情: ${word}`);
}

function simulateAction(actionName) {
    const timestamp = new Date().toLocaleTimeString();
    console.log(`词汇管理操作: ${actionName} - ${timestamp}`);
    
    // 显示操作反馈
    const toast = document.createElement('div');
    toast.className = 'alert alert-success alert-dismissible fade show';
    toast.style.position = 'fixed';
    toast.style.top = '20px';
    toast.style.right = '20px';
    toast.style.zIndex = '9999';
    toast.innerHTML = `
        <strong>操作成功!</strong> ${actionName}
        <button type="button" class="close" data-dismiss="alert">
            <span>&times;</span>
        </button>
    `;
    
    document.body.appendChild(toast);
    
    // 3秒后自动移除提示
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, 3000);
}

// 页面加载完成后的初始化
document.addEventListener('DOMContentLoaded', function() {
    console.log('词汇编辑演示页面已加载');
    
    // 如果有权限检查器，初始化权限检查
    if (window.FrontendPermissionChecker) {
        const permissionChecker = new FrontendPermissionChecker();
        permissionChecker.initializePermissionChecks();
    }
});
</script>
{% endblock %}
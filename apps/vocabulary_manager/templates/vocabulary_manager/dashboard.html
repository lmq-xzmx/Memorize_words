{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}成长中心 | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; 成长中心
</div>
{% endblock %}

{% block content %}
{% csrf_token %}
<div id="content-main">
    <div class="module">
        <h2>成长中心</h2>
        
        <!-- 当前目标卡片 -->
        <div class="module">
            <h3>当前学习目标</h3>
            {% if current_goal %}
                <div class="goal-info">
                    <p><strong>目标名称：</strong>{{ current_goal.name }}</p>
                    <p><strong>目标类型：</strong>{{ current_goal.get_goal_type_display }}</p>
                    <p><strong>目标描述：</strong>{{ current_goal.description|default:"无描述" }}</p>
                    <p><strong>学习进度：</strong>{{ current_goal.learned_words }} / {{ current_goal.total_words }} 个单词</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ current_goal.progress_percentage }}%"></div>
                    </div>
                    <p><small>{{ current_goal.progress_percentage|floatformat:1 }}% 完成</small></p>
                </div>
            {% else %}
                <p class="empty-message">暂无当前学习目标</p>
                <a href="{% url 'vocabulary_manager:learning_goals' %}" class="button">设置学习目标</a>
            {% endif %}
        </div>
        
        <!-- 当前计划卡片 -->
        <div class="module">
            <h3>当前学习计划</h3>
            {% if active_plans %}
                {% for plan in active_plans %}
                <div class="plan-info">
                    <p><strong>计划名称：</strong>{{ plan.name }}</p>
                    <p><strong>计划模式：</strong>{{ plan.get_plan_mode_display }}</p>
                    <p><strong>开始日期：</strong>{{ plan.start_date|date:"Y年m月d日" }}</p>
                    <p><strong>结束日期：</strong>{{ plan.end_date|date:"Y年m月d日" }}</p>
                    <p><strong>每日目标：</strong>{{ plan.daily_target }} 个单词</p>
                    <p><strong>剩余单词：</strong>{{ plan.get_remaining_words }} 个</p>
                </div>
                {% endfor %}
            {% else %}
                <p class="empty-message">暂无当前学习计划</p>
                <a href="{% url 'vocabulary_manager:learning_plans' %}" class="button">制定学习计划</a>
            {% endif %}
        </div>
        
        <!-- 快速操作 -->
        <div class="module">
            <h3>快速操作</h3>
            <div class="action-buttons">
                <a href="{% url 'vocabulary_manager:learning_goals' %}" class="button">管理学习目标</a>
                <a href="{% url 'vocabulary_manager:learning_plans' %}" class="button">管理学习计划</a>
                <a href="{% url 'vocabulary_manager:learning_kanban' %}" class="button">学习中（看板）</a>
                <a href="{% url 'vocabulary_manager:statistics' %}" class="button">查看学习统计</a>
            </div>
        </div>
        
        <!-- 最近学习记录 -->
        <div class="module">
            <h3>最近学习记录</h3>
            {% if recent_records %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>目标单词数</th>
                            <th>已学单词数</th>
                            <th>完成率</th>
                            <th>学习时长</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in recent_records %}
                        <tr>
                            <td>{{ record.study_date|date:"m月d日" }}</td>
                            <td>{{ record.target_words }}</td>
                            <td>{{ record.completed_words }}</td>
                            <td>
                                <span class="completion-rate {% if record.completion_rate >= 100 %}completed{% elif record.completion_rate >= 80 %}good{% else %}poor{% endif %}">
                                    {{ record.completion_rate|floatformat:1 }}%
                                </span>
                            </td>
                            <td>{{ record.study_duration|default:"--" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="empty-message">暂无学习记录</p>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .goal-info, .plan-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 15px;
    }
    
    .progress-bar {
        width: 100%;
        height: 20px;
        background: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .progress-fill {
        height: 100%;
        background: #007bff;
        transition: width 0.3s ease;
    }
    
    .empty-message {
        color: #6c757d;
        font-style: italic;
    }
    
    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    
    .button {
        display: inline-block;
        padding: 8px 16px;
        background: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s ease;
    }
    
    .button:hover {
        background: #0056b3;
        color: white;
        text-decoration: none;
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    
    .table th, .table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
    }
    
    .table th {
        background: #f8f9fa;
        font-weight: bold;
    }
    
    .completion-rate {
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .completion-rate.completed {
        background: #d4edda;
        color: #155724;
    }
    
    .completion-rate.good {
        background: #fff3cd;
        color: #856404;
    }
    
    .completion-rate.poor {
        background: #f8d7da;
        color: #721c24;
    }
</style>
{% endblock %}